<h1>Резервное копирование и восстановление Comindware Platform. Краткое руководство для ОС Windows</h1><div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="4644">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#введение">
<span class="md-ellipsis">
      Введение
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#подготовка-к-резервному-копированию-и-восстановлению-данных">
<span class="md-ellipsis">
      Подготовка к резервному копированию и восстановлению данных
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#порядок-резервного-копирования-данных-экземпляра-продукта">
<span class="md-ellipsis">
      Порядок резервного копирования данных экземпляра продукта
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#выполнение-резервного-копирования">
<span class="md-ellipsis">
      Выполнение резервного копирования
    </span>
</a>
<nav aria-label="Выполнение резервного копирования" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#регистрация-репозитория-и-создание-снимка-elasticsearch">
<span class="md-ellipsis">
      Регистрация репозитория и создание снимка Elasticsearch
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#сохранение-резервной-копии-базы-данных-экземпляра-продукта">
<span class="md-ellipsis">
      Сохранение резервной копии базы данных экземпляра продукта
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#порядок-восстановления-данных-экземпляра-продукта">
<span class="md-ellipsis">
      Порядок восстановления данных экземпляра продукта
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#выполнение-восстановления">
<span class="md-ellipsis">
      Выполнение восстановления
    </span>
</a>
<nav aria-label="Выполнение восстановления" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#восстановление-снимка-elasticsearch">
<span class="md-ellipsis">
      Восстановление снимка Elasticsearch
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#восстановление-базы-данных-экземпляра-продукта">
<span class="md-ellipsis">
      Восстановление базы данных экземпляра продукта
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#проверка-конфигурации-экземпляра-по">
<span class="md-ellipsis">
      Проверка конфигурации экземпляра ПО
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="введение">Введение</h2>
<p>Здесь представлены инструкции по резервному копированию и восстановлению данных <strong>Comindware Platform</strong> в ОС Windows.</p>
<div class="notice notice-success">
<p class="admonition-title">Определения</p>
<p><strong>Elasticsearch (OpenSearch)</strong> — система журналирования в составе <strong>Comindware Platform</strong>.</p>
<p><strong>Снимок</strong> — набор данных, сохранённый на определённый момент времени.</p>
</div>
<h2 id="подготовка-к-резервному-копированию-и-восстановлению-данных">Подготовка к резервному копированию и восстановлению данных</h2>
<p>Для создания резервных копий и восстановления из них данных Comindware Platform необходимо подготовить конфигурацию резервного копирования, как указано ниже.</p>
<ol class="colored_numbers_list">
<li>
<p><a class="mkdocs_imported_link" id="P1.1"></a>Подготовьте следующие данные о конфигурации экземпляра продукта:</p>
<ul>
<li>Название экземпляра продукта — <code>&lt;InstanceName&gt;</code>(например, <code>CBAP4.2</code>).</li>
<li>Путь к папке с базой данных экземпляра продукта, например <code>DatabasePath</code> (по умолчанию: <code>C:\\ProgramData\\Comindware\\Instances\\&lt;InstanceName&gt;\\Data</code>).</li>
<li>Путь к папке резервных копий базы данных — <code>DatabaseBackupPath</code> (например, <code>С:\\DatabaseBackups</code>).</li>
<li>Имя репозитория снимков Elasticsearch — <em><code>repository_name</code></em> (например, <code>elastic_backup</code>).</li>
<li>Путь к репозиторию снимков Elasticsearch — <code>elastic_backup_path</code>(например, <code>e:\\elastic_backup</code>).</li>
<li>Имя снимка Elasticsearch — <code>snapshot_name</code> (например, <code>&lt;InstanceName&gt;01022022080800</code> — в формате <code>&lt;&lt;InstanceName&gt;&gt;&lt;Date&gt;&lt;Time&gt;</code>). См. инструкции Elasticsearch по формированию имён снимков с использованием текущей даты  (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#api-date-math-index-names">https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#api-date-math-index-names</a>.</li>
</ul>
</li>
<li>
<p>Настройте конфигурацию репозитория снимков сервера Elasticseach.</p>
<ol class="colored_numbers_list">
<li>
<p>Откройте файл <code>elasticsearch.yml</code> в папке с данными конфигурации Elasticseach (например: <code>C:\\ElasticsearchData</code>)</p>
</li>
<li>
<p><a class="mkdocs_imported_link" id="P1.2.2"></a>В файле <code>elasticsearch.yml</code> и добавьте директиву <code>path.repo</code> и через двоеточие укажите путь к репозиторию снимков (папке с резервными копиями), например:</p>
</li>
</ol>
<div class="highlight"><code><pre><span></span><code>path.repo: elastic_backup_path</code> <br/></pre></code></div>
</li>
</ol>
<h2 id="порядок-резервного-копирования-данных-экземпляра-продукта">Порядок резервного копирования данных экземпляра продукта</h2>
<p>Данные экземпляра продукта хранятся в двух независимых друг от друга хранилищах: на сервере Elasticsearch и в папке с базой данных экземпляра продукта — <code>DatabasePath</code>. Cм. <em>«<a class="mkdocs_imported_link" href="#подготовка-к-резервному-копированию-и-восстановлению-данных">Подготовка к резервному копированию и восстановлению данных</a>»</em>.</p>
<p>Так как осуществить одновременное резервное копирование двух хранилищ не представляется возможным, резервное копирование данных из каждого хранилища выполняется отдельно в два этапа и в отдельные папки:</p>
<ol class="colored_numbers_list">
<li><a class="mkdocs_imported_link" href="#регистрация-репозитория-и-создание-снимка-elasticsearch">Создание снимка сервера Elasticsearch</a> — данные истории и мониторинга копируются в отдельную папку.</li>
<li><a class="mkdocs_imported_link" href="#сохранение-резервной-копии-базы-данных-экземпляра-продукта">Сохранение резервной копии базы данных экземпляра продукта</a> в папку <code>DatabaseBackupPath</code>.</li>
</ol>
<h2 id="выполнение-резервного-копирования">Выполнение резервного копирования</h2>
<h3 id="регистрация-репозитория-и-создание-снимка-elasticsearch">Регистрация репозитория и создание снимка Elasticsearch</h3>
<ol class="colored_numbers_list">
<li>
<p>Чтобы зарегистрировать репозиторий, выполните следующую команду, указав в URL имя репозитория <code>repository_name</code> (см. <em>«<a class="mkdocs_imported_link" href="#подготовка-к-резервному-копированию-и-восстановлению-данных">Подготовка к резервному копированию и восстановлению данных</a>»</em>), а в параметре <code>location</code> — путь к репозиторию из директивы <code>path.repo</code> в файле конфигурации сервера Elasticsearch:</p>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">"localhost:9200/_snapshot/repository_name?pretty"</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span>-d<span class="s1">' {"type": "fs", "settings": {"location": "elastic_backup_path"}}'</span></code> <br/></pre></code></div>
<p>Подробные сведения о регистрации репозитория Elasticsearch см. в официальной документации (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-register-repository.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-register-repository.html</a></p>
</li>
<li>
<p>Чтобы создать снимок Elasticsearch, выполните следующую команду, указав имя снимка <code>snapshot_name</code>, а в параметре <code>indices</code> — индексы, которые требуется включить в снимок (индексы Comindware Platform имеют префикс, например, <code>cmw_&lt;&lt;InstanceName&gt;&gt;_</code>):</p>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">"localhost:9200/_snapshot/repository_name/snapshot_name?wait_for_completion=true&amp;pretty"</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span>-d<span class="s1">' {"indices": "cmw_&lt;&lt;InstanceName&gt;&gt;_*", "ignore_unavailable": true, "include_global_state": false}'</span></code> <br/></pre></code></div>
<p>Подробные сведения о создании снимка Elasticsearch см. в официальной документации (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-take-snapshot.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-take-snapshot.html</a></p>
</li>
</ol>
<h3 id="сохранение-резервной-копии-базы-данных-экземпляра-продукта">Сохранение резервной копии базы данных экземпляра продукта</h3>
<ol class="colored_numbers_list">
<li>В экземпляре продукта откройте раздел «<strong>Администрирование</strong>» — «<strong>Инфраструктура</strong>» — «<strong>Резервное копирование</strong>».</li>
<li>
<p>Нажмите кнопку «<strong>Создать</strong>» в списке конфигураций резервного копирования.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Создание новой конфигурации резервного копирования" src="https://kb.comindware.ru/assets/img_6321d80a2b32d.png"/><figcaption class="caption">Создание новой конфигурации резервного копирования</figcaption></figure></p>
</li>
<li>
<p><a class="mkdocs_imported_link" id="P3.2.3"></a>В окне «<strong>Новая конфигурация резервного копирования</strong>»:</p>
<ol class="colored_numbers_list">
<li>В поле «<strong>Название</strong>» укажите наглядное название конфигурации (например, «<code>Резервная копия &lt;InstanceName&gt;</code>»).</li>
<li>В поле «<strong>Путь к файлу</strong>» укажите путь к файлу резервной копии в папке <code>DatabaseBackupPath</code> на сервере. См. <em>«<a class="mkdocs_imported_link" href="#подготовка-к-резервному-копированию-и-восстановлению-данных">Подготовка к резервному копированию и восстановлению данных</a>»</em>.</li>
<li>В поле «<strong>Имя файла</strong>» укажите имя файла резервной копии (например, <code>Backup</code>).</li>
<li>Установите флажки «<strong>С файлами</strong>» и «<strong>Со скриптами</strong>».</li>
<li>Нажмите кнопку «<strong>Сохранить</strong>».</li>
</ol>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка новой конфигурации резервного копирования" src="https://kb.comindware.ru/assets/img_6321d7573245a.png"/><figcaption class="caption">Настройка новой конфигурации резервного копирования</figcaption></figure></p>
</li>
<li>
<p>Запустите резервное копирование:</p>
<ol class="colored_numbers_list">
<li>В списке конфигураций резервного копирования с помощью флажка выбора выберите созданную на <a class="mkdocs_imported_link" href="#P3.2.3">шаге 3</a> конфигурацию.</li>
<li>Нажмите кнопку «<strong>Запустить копирование</strong>».</li>
</ol>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Запуск резервного копирования" src="https://kb.comindware.ru/assets/img_6321d902288c2.png"/><figcaption class="caption">Запуск резервного копирования</figcaption></figure></p>
</li>
<li>
<p>В фоновом режиме начнется процесс резервного копирования.</p>
</li>
<li>Прогресс и результат резервного копирования можно просмотреть в журнале резервного копирования, выбрав вкладку «<strong>Журнал</strong>» над списком конфигураций резервного копирования.</li>
<li>
<p>В процессе резервного копирования к имени файла, указанному <a class="mkdocs_imported_link" href="#P3.2.3">на шаге 3</a> будут добавлена метка времени в формате <code>ГГГГММДДЧЧММ</code> и расширение <code>CDBBZ</code>, например для имени файла <code>Backup</code>: <code>Backup``.202202161625.cdbbz</code></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к журналу резервного копирования" src="https://kb.comindware.ru/assets/img_6321dbd1da164.png"/><figcaption class="caption">Переход к журналу резервного копирования</figcaption></figure></p>
</li>
</ol>
<h2 id="порядок-восстановления-данных-экземпляра-продукта">Порядок восстановления данных экземпляра продукта</h2>
<p>Данные экземпляра продукта хранятся в трех независимых друг от друга хранилищах:  сервере Apache Ignite, сервере Elasticsearch и папке <code>DatabaseBackupPath</code> (см. <em>«<a class="mkdocs_imported_link" href="#подготовка-к-резервному-копированию-и-восстановлению-данных">Подготовка к резервному копированию и восстановлению данных</a>»</em>). Поэтому восстановление осуществляется последовательно для каждого хранилища.</p>
<div class="notice notice-warning">
<p class="admonition-title">Внимание!</p>
<p>Восстановление следует выполнять при остановленном экземпляре продукта.</p>
</div>
<p>Восстановление данных из резервных копий выполняется в два этапа:</p>
<ol class="colored_numbers_list">
<li><a class="mkdocs_imported_link" href="#восстановление-снимка-elasticsearch">Восстановление снимка сервера Elasticsearch</a>.</li>
<li><a class="mkdocs_imported_link" href="#восстановление-базы-данных-экземпляра-продукта">Восстановление базы данных экземпляра продукта</a> из папки <code>DatabaseBackupPath</code>.</li>
</ol>
<h2 id="выполнение-восстановления">Выполнение восстановления</h2>
<h3 id="восстановление-снимка-elasticsearch">Восстановление снимка Elasticsearch</h3>
<ol class="colored_numbers_list">
<li>Выполните следующую команду, указав имя репозитораия <code>repository_name</code> и имя снимка <code>snapshot_name</code> (см. <em>«<a class="mkdocs_imported_link" href="#подготовка-к-резервному-копированию-и-восстановлению-данных">Подготовка к резервному копированию и восстановлению данных</a>»</em>):</li>
</ol>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">"localhost:9200/_snapshot/repository_name/snapshot_name/_restore?pretty"</span></code> <br/></pre></code></div>
<p>Подробные сведения о восстановлении снимков Elasticsearch см. в официальной документации (на английском языке): <a class="mkdocs_imported_link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html</a></p>
<h3 id="восстановление-базы-данных-экземпляра-продукта">Восстановление базы данных экземпляра продукта</h3>
<ol class="colored_numbers_list">
<li>Восстановите базу данных экземпляра продукта согласно инструкциям в статье «<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4639">Восстановление экземпляра продукта из резервной копии</a>».</li>
</ol>
<h2 id="проверка-конфигурации-экземпляра-по">Проверка конфигурации экземпляра ПО</h2>
<ol class="colored_numbers_list">
<li>Запустите экземпляр ПО.</li>
<li>При необходимости откроется страница настройки подключения к службе Elasticsearch.</li>
<li>В поле «URI» введите адрес автоматически своего сервера Elasticsearch.</li>
<li>Введите <strong>префикс индекса</strong>, <strong>имя пользователя</strong> и <strong>пароль сервера Elasticsearch</strong>. .</li>
<li>
<p>Нажмите кнопку «<strong>Далее</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка подключения к Elasticsearch" src="https://kb.comindware.ru/assets/Picture16.png"/><figcaption class="caption">Настройка подключения к Elasticsearch</figcaption></figure></p>
</li>
<li>
<p>При необходимости откроется страница инициализации данных в Elasticsearch.</p>
</li>
<li>
<p>Нажмите кнопку «<strong>Обновить</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Страница инициализации данных в Elasticsearch" src="https://kb.comindware.ru/assets/Picture17.png"/><figcaption class="caption">Страница инициализации данных в Elasticsearch</figcaption></figure></p>
</li>
<li>
<p>Дождитесь открытия начальной страницы <strong>Comindware Platform</strong>.</p>
</li>
<li>
<p>Откройте страницу «<strong>Администрирование</strong>» — «<strong>Подключения</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к свойства подключения к Elasticsearch" src="https://kb.comindware.ru/assets/img_64d09fd6ec3ba.png"/><figcaption class="caption">Переход к свойства подключения к Elasticsearch</figcaption></figure></p>
</li>
<li>
<p>Откройте подключение к серверу Elasticsearch.</p>
</li>
<li>
<p>Удостоверьтесь, что корректно указаны <strong>префикс индекса</strong> и <strong>URL подключения</strong> к серверу Elasticsearch.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Свойства подключения к серверу Elasticsearch" src="https://kb.comindware.ru/assets/img_64d0a41fc5e0b.png"/><figcaption class="caption">Свойства подключения к серверу Elasticsearch</figcaption></figure></p>
</li>
<li>
<p>Откройте страницу «<strong>Администрирование</strong>» — «<strong>Глобальная конфигурация</strong>».</p>
</li>
<li>
<p>Удостоверьтесь, что указан корректный <strong>URL-адрес сервера</strong>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="URL-адрес сервера в глобальной конфигурации" src="https://kb.comindware.ru/assets/img_64d0a4feebc80.png"/><figcaption class="caption">URL-адрес сервера в глобальной конфигурации</figcaption></figure></p>
</li>
<li>
<p>Откройте страницу «<strong>Администрирование</strong>» — «<strong>Резервное копирование</strong>».</p>
</li>
<li>
<p>Удостоверьтесь, что в конфигурациях резервного копирования правильно указаны пути для сохранения резервных копий.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Путь к папке резервных копий в конфигурации резервного копирования" src="https://kb.comindware.ru/assets/img_64d0a5817d06a.png"/><figcaption class="caption">Путь к папке резервных копий в конфигурации резервного копирования</figcaption></figure></p>
</li>
<li>
<p>При необходимости измените конфигурации резервного копирования, указав корректные пути к файлам.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка пути к файлам резервной копии" src="https://kb.comindware.ru/assets/img_64d0a5f075838.png"/><figcaption class="caption">Настройка пути к файлам резервной копии</figcaption></figure></p>
</li>
</ol>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">‌<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>