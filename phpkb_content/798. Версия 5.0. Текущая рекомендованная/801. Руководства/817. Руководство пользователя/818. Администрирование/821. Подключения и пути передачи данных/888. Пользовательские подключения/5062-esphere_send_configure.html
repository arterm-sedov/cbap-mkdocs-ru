<h1>Отправка запросов данных в «СФЕРА Курьер». Настройка подключения, пути передачи данных и сценария</h1><div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="5062">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#введение">
<span class="md-ellipsis">
      Введение
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#прикладная-задача">
<span class="md-ellipsis">
      Прикладная задача
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#порядок-настройки">
<span class="md-ellipsis">
      Порядок настройки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#configure_connection_send_request">
<span class="md-ellipsis">
      Настройка подключения
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-пути-передачи-данных">
<span class="md-ellipsis">
      Настройка пути передачи данных
    </span>
</a>
<nav aria-label="Настройка пути передачи данных" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#configure_communication_route_send_request_main_properties">
<span class="md-ellipsis">
      Основные свойства
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#configure_communication_route_send_request_message_attributes">
<span class="md-ellipsis">
      Атрибуты сообщений
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-шаблона-записи">
<span class="md-ellipsis">
      Настройка шаблона записи
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-сценария">
<span class="md-ellipsis">
      Настройка сценария
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#тестирование">
<span class="md-ellipsis">
      Тестирование
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#связанные-статьи">
<span class="md-ellipsis">
      Связанные статьи
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="введение">Введение</h2>
<p>В <strong>Comindware Platform</strong> можно настроить подключение к системе электронного документооборота «СФЕРА Курьер». Интеграция с этой системой позволяет:</p>
<ul>
<li>осуществлять поиск контрагентов по реквизитам и проверять корректность реквизитов;</li>
<li>осуществлять обмен документами с контрагентами;</li>
<li>производить с документами и квитанциями различные действия:<ul>
<li>создавать,</li>
<li>отправлять,</li>
<li>подписывать,</li>
<li>принимать,</li>
<li>отзывать,</li>
<li>аннулировать,</li>
<li>отклонять;</li>
</ul>
</li>
<li>подписывать документы квалифицированной электронной подписью;</li>
<li>контролировать сроки подписания документов.</li>
</ul>
<h2 id="прикладная-задача">Прикладная задача</h2>
<p>Здесь приведён пример настройки подключения, пути передачи данных, шаблона и сценария для синхронизации данных о контрагентах с системой «СФЕРА Курьер».</p>
<p>Имеется шаблон <em>«Реестр контрагентов»</em>, в котором хранятся сведения о контрагентах.</p>
<p>Требуется настроить кнопку для синхронизации данных контрагентов с «СФЕРА Курьер».</p>
<h2 id="порядок-настройки">Порядок настройки</h2>
<ol class="colored_numbers_list">
<li>Настройте <a class="mkdocs_imported_link" href="#configure_connection_send_request">подключение</a> типа «<strong>Отправка сообщений в систему «СФЕРА Курьер</strong>».</li>
<li>Настройте <a class="mkdocs_imported_link" href="#настройка-пути-передачи-данных">путь передачи данных</a> «<strong>Отправка сообщений в «СФЕРА Курьер</strong>», использующий созданное подключение.</li>
<li>Настройте <a class="mkdocs_imported_link" href="#настройка-шаблона-записи">шаблон записи</a> для хранения данных контрагентов.</li>
<li>Настройте <a class="mkdocs_imported_link" href="#настройка-сценария">сценарий</a> для получения данных о контрагенте из «СФЕРА Курьер».</li>
</ol>
<h2 id="configure_connection_send_request">Настройка подключения</h2>
<ol class="colored_numbers_list">
<li>Откройте страницу «<strong>Администрирование</strong>» — «<strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4675">Подключения</a></strong>».</li>
<li>В списке подключений откройте или создайте подключение типа «<strong>Пользовательские подключения</strong>» — «<strong>Отправка сообщений в систему «СФЕРА Курьер</strong>».</li>
<li>
<p>Настройте свойства подключения:</p>
<ul>
<li><strong>Системное имя</strong> — введите уникальное имя подключения.</li>
<li><strong>Отключить</strong> — установите этот флажок, если требуется временно деактивировать данное подключение.</li>
<li><strong>Описание</strong> — введите наглядное описание подключения.</li>
<li><strong>Запись в файловые журналы</strong> — выберите, какие события следует записывать в журналы:<ul>
<li><strong>Полные сведения об обработке сообщения</strong>;</li>
<li><strong>Только ошибки</strong>;</li>
<li><strong>Отключить</strong> — не регистрировать в журнале события отправки сообщений.</li>
</ul>
</li>
<li><strong>Тестовый сервер</strong> — установите этот флажок, чтобы настроить подключение к тестовому серверу.</li>
<li><strong>Интервал запроса данных, в минутах</strong> — укажите интервал запроса к серверу.</li>
<li><strong>ApiKey</strong> — введите ключ API для подключения к «СФЕРА Курьер».</li>
<li><strong>Имя пользователя</strong> — укажите учётную запись для подключения к «СФЕРА Курьер».</li>
<li><strong>Пароль</strong> — введите пароль для подключения к «СФЕРА Курьер».</li>
<li><strong>Идентификатор участника ЭДО получателя документа</strong> — укажите идентификатор, присвоенный участнику «СФЕРА Курьер».</li>
</ul>
</li>
<li>
<p>Нажмите кнопку «<strong>Проверить соединение</strong>» и удостоверьтесь, что соединение установлено.</p>
</li>
<li>Чтобы просмотреть журнал событий отправки сообщений, нажмите кнопку «<strong>Скачать журнал</strong>».</li>
<li>Сохраните подключение.</li>
</ol>
<h2 id="настройка-пути-передачи-данных">Настройка пути передачи данных</h2>
<ol class="colored_numbers_list">
<li>Откройте страницу «<strong>Администрирование</strong>» — «<strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4676">Пути передачи данных</a></strong>».</li>
<li>Откройте двойным нажатием в списке или путь передачи данных типа «<strong>Пользовательские подключения</strong>» — «<strong>Отправка сообщений в «СФЕРА Курьер</strong>» типа «<strong>Зачитывает данные об организации</strong>.</li>
<li>
<p>Настройте свойства пути передачи данных на следующих вкладках:</p>
<ul>
<li><a class="mkdocs_imported_link" href="#configure_communication_route_send_request_main_properties"><strong>Основные свойства</strong></a></li>
<li><a class="mkdocs_imported_link" href="#configure_communication_route_send_request_message_attributes"><strong>Атрибуты сообщения</strong></a></li>
</ul>
</li>
<li>
<p>Сохраните путь передачи данных.</p>
</li>
</ol>
<h3 id="configure_communication_route_send_request_main_properties">Основные свойства</h3>
<p>На вкладке «<strong>Основные свойства</strong>» настройте параметры использования пути передачи данных.</p>
<ul>
<li><strong>Подключение</strong> — выберите <a class="mkdocs_imported_link" href="#configure_connection_send_request">подключение для отправки сообщений в систему «СФЕРА Курьер»</a>.</li>
<li><strong>Системное имя</strong> — введите уникальное имя пути передачи данных.</li>
<li><strong>Отключить</strong> — установите этот флажок, если требуется временно деактивировать данный путь передачи данных.</li>
<li><strong>Описание</strong> — введите наглядное описание пути передачи данных.</li>
<li><strong>Номер шины данных</strong> — выберите номер от 0 до 3, если требуется распределить потоки данных нескольких путей для повышения производительности.</li>
</ul>
<h3 id="configure_communication_route_send_request_message_attributes">Атрибуты сообщений</h3>
<p>На вкладке «<strong>Атрибуты сообщения</strong>» настройте атрибуты, значения которых будут подставляться в содержимое сообщений в зависимости от его типа.</p>
<ol class="colored_numbers_list">
<li>
<p>Выберите <strong>тип сообщения</strong> «<strong>Зачитывает данные об организации</strong>». Предусмотрены следующие типы сообщений:</p>
<ul>
<li><strong>Добавить новый документ</strong>;</li>
<li><strong>Отправить подпись для документа</strong>;</li>
<li><strong>Получить документ</strong>;</li>
<li><strong>Найти документы</strong>;</li>
<li><strong>Изменить стадии документооборота</strong>;</li>
<li><strong>Отклонить документ</strong>;</li>
<li><strong>Зачитывает данные об организации</strong>.</li>
</ul>
</li>
<li>
<p>В таблицах «<strong>Запрос</strong>», «<strong>Ответ</strong>» и «<strong>Ответ с ошибкой</strong>» отобразятся готовые атрибуты, соответствующие выбранному <strong>типу сообщения</strong>.</p>
</li>
</ol>
<p>Подробные сведения об атрибутах, которые используются при обмене сообщениями с системой «СФЕРА Курьер», см. в <em><a class="mkdocs_imported_link" href="https://www.esphere.ru/assets/download/integration/ws-courier.pdf">Справочном руководстве API СФЕРА Курьер</a></em>.</p>
<h2 id="настройка-шаблона-записи">Настройка шаблона записи</h2>
<ol class="colored_numbers_list">
<li>Создайте шаблон записи <em>«Реестр контрагентов»</em>.</li>
<li>
<p>Создайте следующие атрибуты типа «<strong>Текст</strong>»:</p>
<ul>
<li><em>Код участника ЭДО</em></li>
<li><em>ИНН</em></li>
<li><em>КПП</em></li>
</ul>
</li>
<li>
<p>Создайте кнопку <em>«Синхронизировать данные контрагента»</em> со следующими свойствами:</p>
<ul>
<li><strong>Контекст операции: запись</strong></li>
<li><strong>Операция: вызвать событие «Нажата кнопка»</strong></li>
<li><strong>Результат выполнения: обновить данные</strong></li>
</ul>
</li>
<li>
<p>Поместите атрибуты <em>«Код участника ЭДО»</em>, <em>«ИНН»</em>, <em>«КПП»</em> на <strong>основную форму</strong>.</p>
</li>
<li>Поместите кнопку <em>«Синхронизировать данные контрагента»</em> на <strong>основную форму</strong>.</li>
</ol>
<h2 id="настройка-сценария">Настройка сценария</h2>
<ol class="colored_numbers_list">
<li>
<p>Создайте сценарий:</p>
<ul>
<li><strong>Название:</strong> <em>Синхронизация контрагента со «СФЕРА Курьер»</em></li>
<li><strong>Контекст выполнения: от инициатора</strong></li>
</ul>
</li>
<li>
<p>Отобразится конструктор сценария.</p>
</li>
<li>
<p>Настройте событие «<strong>Нажата кнопка</strong>»:</p>
<ul>
<li><strong>Контекстный шаблон:</strong> <em>Реестр контрагентов</em></li>
<li><strong>Кнопка:</strong> <em>Синхронизировать данные контрагента</em></li>
</ul>
</li>
<li>
<p>Создайте и настройте действие «<strong>Изменить значение переменных</strong>»:</p>
<ul>
<li><strong>Операция со значениями переменных: добавить</strong></li>
<li><strong>Набор переменных:</strong> <em>Request</em></li>
<li>Добавьте переменную:<ul>
<li><strong>Имя переменной:</strong> <em>CompanyCode</em></li>
<li><strong>Значение: атрибут</strong> <em>Код участника ЭДО</em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Добавьте действие «<strong>Отправить сообщение</strong>» со следующими свойствами:</p>
<ul>
<li><strong>Подключение:</strong> выберите <a class="mkdocs_imported_link" href="#configure_connection_send_request">подключение для отправки сообщений в систему «СФЕРА Курьер»</a></li>
<li><strong>Путь передачи данных:</strong> выберите <a class="mkdocs_imported_link" href="#настройка-пути-передачи-данных">путь передачи данных для отправки сообщений в «СФЕРА Курьер»</a></li>
<li><strong>Переменная с сообщением:</strong> <em>Request</em></li>
<li><strong>Переменная для успешного ответа:</strong> <em>Response</em></li>
<li><strong>Переменная для ответа с ошибкой:</strong> <em>Error</em></li>
</ul>
</li>
<li>
<p>Добавьте действие «<strong>Изменить значение атрибутов</strong>» со следующими свойствами:</p>
<table style="width: 100%;">
<thead>
<tr>
<th>Атрибут</th>
<th>Операция со значениями</th>
<th>Значение</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>ИНН</em></td>
<td><strong>Заменить</strong></td>
<td><strong>Формула:</strong> <code>$$Response-&gt;Inn</code></td>
</tr>
<tr>
<td><em>КПП</em></td>
<td><strong>Заменить</strong></td>
<td><strong>Формула:</strong> <code>$$Response-&gt;Kpp</code></td>
</tr>
</tbody>
</table>
</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Сценарий отправки запроса в «СФЕРА Курьер» для синхронизации данных контрагента" src="/platform/v5.0/administration/connections_communication_routes/custom_connections/img/esphere_send_configure_scenario.png"/><figcaption class="caption">Сценарий отправки запроса в «СФЕРА Курьер» для синхронизации данных контрагента</figcaption></p>
</figure>
<h2 id="тестирование">Тестирование</h2>
<ol class="colored_numbers_list">
<li>Создайте новую запись в шаблоне <em>«Реестр контрагентов»</em>.</li>
<li>Введите в поле <em>«Код участника ЭДО»</em> действительный код контрагента.</li>
<li>Нажмите кнопку <em>«Синхронизировать данные контрагента»</em>.</li>
<li>В полях <em>«ИНН»</em> и <em>«КПП»</em> должны отобразиться данные контрагента.</li>
</ol>
<h2 id="связанные-статьи">Связанные статьи</h2>
<ul>
<li><em><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=5061">Получение документов через «СФЕРА Курьер»</a></em></li>
<li><em><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4675">Подключения. Определения, типы, создание, настройка, удаление</a></em></li>
<li><em><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4676">Пути передачи данных</a></em></li>
</ul>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">‌<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>