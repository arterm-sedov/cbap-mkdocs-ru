<h1>Правила для формы. Определения, логика работы и настройка</h1><div class="md-container" data-md-component="container">
<div class="md-main__inner md-grid"><nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#definitions"> <span class="md-ellipsis"> Определения </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#переход-к-конструктору-правил-для-формы"> <span class="md-ellipsis"> Переход к конструктору правил для формы </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#настройка-правила"> <span class="md-ellipsis"> Настройка правила </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#настройка-действия"> <span class="md-ellipsis"> Настройка действия </span> </a><nav aria-label="Настройка действия" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#типы-и-свойства-действий"> <span class="md-ellipsis"> Типы и свойства действий </span> </a><nav aria-label="Типы и свойства действий" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#доступные-действия-для-различных-элементов-формы"> <span class="md-ellipsis"> Доступные действия для различных элементов формы </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#общие-свойства-действий"> <span class="md-ellipsis"> Общие свойства действий </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#свойства-действия-изменить-доступ"> <span class="md-ellipsis"> Свойства действия «Изменить доступ» </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#свойства-действия-установить-значение"> <span class="md-ellipsis"> Свойства действия «Установить значение» </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#свойства-действия-показать-ошибку"> <span class="md-ellipsis"> Свойства действия «Показать ошибку» </span> </a></li>
</ul>
</nav></li>
</ul>
</nav></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#удаление-правил-и-действий"> <span class="md-ellipsis"> Удаление правил и действий </span> </a></li>
<li class="md-nav__item"><a class="md-nav__link mkdocs_imported_link" href="#связанные-статьи"> <span class="md-ellipsis"> Связанные статьи </span> </a></li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<div class="notice notice-success">
<h2 class="admonition-title" id="definitions">Определения</h2>
<ul>
<li><strong>Правила для формы</strong> предназначены для реализации трех сценариев работы конечного пользователя:
<ul>
<li>автоматическое условное и безусловное заполнение данными полей формы (значения по умолчанию, зависимости полей и т.д.);</li>
<li>динамическое изменение внешнего вида формы (изменение доступности и видимости полей и областей);</li>
<li>проверка значений, введенных в поля формы.</li>
</ul>
</li>
<li>Каждое <a class="mkdocs_imported_link" href="#настройка-правила">правило</a> состоит из одного или нескольких действий над <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4786">элементами формы</a> и задаёт условие их выполнения.</li>
<li>Каждое <a class="mkdocs_imported_link" href="#настройка-действия">действие</a> выполняется над одним элементом формы.</li>
<li>Действие входит в состав правила.</li>
<li>Для каждого действия можно задать отдельное условие выполнения.</li>
<li>Правила и действия выполняются независимо друг от друга и последовательно, сверху вниз по порядку их расположения в конструкторе.</li>
</ul>
</div>
<h2 id="переход-к-конструктору-правил-для-формы">Переход к конструктору правил для формы</h2>
<p>Настроить правила для формы можно с помощью визуального конструктора следующим образом.</p>
<ol class="colored_numbers_list">
<li>Откройте <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4786">конструктор формы</a>.</li>
<li>Нажмите значок <em class="fa-light fa-arrow-down">‌<!--icon--></em> рядом с заголовком формы в конструкторе.</li>
<li>В раскрывающемся меню выберите пункт «<strong>Правила для формы</strong>».</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Переход к конструктору правил для формы" src="https://kb.comindware.ru/assets/form_rules_menu.png"/></p>
<figcaption class="caption">Переход к конструктору правил для формы</figcaption>
</figure>
<ol class="colored_numbers_list" start="4">
<li>
<p>Отобразится конструктор правил для формы, состоящий из следующих областей:</p>
<p><strong>(1) Панель элементов</strong> — содержит элементы, которые можно перетащить в рабочую область.</p>
<ul>
<li><a class="mkdocs_imported_link" href="#настройка-правила"><strong>Правило</strong></a> — набор действий, выполняющихся последовательно при соблюдении заданного условия.</li>
<li><a class="mkdocs_imported_link" href="#настройка-действия"><strong>Действие</strong></a> — действие над <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4786">элементом формы</a>, которое будет выполняться при соблюдении условий, заданных в правиле и действии.</li>
</ul>
<p><strong>(2) Рабочая область</strong> — содержит правила и действия для формы.</p>
<p><strong>(3) Панель свойств</strong> — позволяет настроить правила и действия для формы.</p>
<p><strong>(4) Кнопки:</strong></p>
<ul>
<li><strong>Сохранить</strong> — сохранение правил для формы.</li>
<li><strong>Очистить</strong> — удаление всех правил для формы.</li>
<li><strong>Настроить шаблон</strong> <em class="fa-l fa-pen-square">‌<!--icon--></em> — переход к странице «<strong>Свойства</strong>» шаблона.</li>
</ul>
</li>
<li>
<p>Перетащите правила и действия с панели элементов на рабочую область конструктора правил для формы.</p>
</li>
<li>Настройте <a class="mkdocs_imported_link" href="#настройка-правила">правила</a> и <a class="mkdocs_imported_link" href="#настройка-действия">действия</a> с помощью панели свойств.</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Конструктор правил для формы" src="https://kb.comindware.ru/assets/form_rules_designer.png"/></p>
<figcaption class="caption">Конструктор правил для формы</figcaption>
</figure>
<h2 id="настройка-правила">Настройка правила</h2>
<p><strong>Правило</strong> является контейнером для действий и задаёт базовое условие их выполнения.</p>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы правил</p>
<p>Правила выполняются независимо друг от друга, последовательно по порядку следования в конструкторе — сверху вниз.</p>
<p>Это важно понимать, так как если в разных правилах есть действия, выполняющие действия над одним и тем же элементом формы и при этом условия выполнения этих правил вернули <code>true</code>, в итоге над этим элементом формы будут выполнены действия из правила, которое находится ниже в конструкторе, т. е. выполнится последним.</p>
</div>
<ol class="colored_numbers_list">
<li>Перетащите правило из панели элементов на рабочую область или выберите имеющееся правило.</li>
<li>Чтобы изменить порядок выполнения правил, перетаскивайте их в рабочей области.</li>
<li>
<p>Настройте правило с помощью панели «<strong>Свойства правила</strong>»:</p>
<ul>
<li><strong>Название</strong> — наглядное наименование правила.</li>
<li><strong>Условие выполнения</strong>— формула или выражение на языке N3, которое должно возвращать <code>true</code> или <code>false</code>.
<ul>
<li>Если выражение вернёт <code>true</code>, то будут последовательно выполнены действия внутри правила (сверху вниз по порядку их расположения в конструкторе).</li>
<li>Если выражение вернёт <code>false</code> или пустое значение, действия внутри правила не будут выполняться.</li>
<li>Проверка условий выполнения правил происходит после внесения изменений в любое поле на форме, а также при открытии формы.</li>
</ul>
</li>
</ul>
<div class="notice notice-success">
<p class="admonition-title">Контекст условия выполнения правила</p>
<ul>
<li>Условие выполнения правила для формы вычисляется в контексте записи, для которой открыта форма.</li>
<li>Если форма с правилами вложена в другую форму, то контекстом для условий выполнения правил вложенной формы является запись, которая выводится о вложенной форме:
<ul>
<li>если вложенная форма относится к текущей записи, то контекстом является текущая запись;</li>
<li>если вложенная форма относится к шаблону, связанному с <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4780">атрибутом типа «<strong>Запись</strong>»</a>, то контекстом является запись, указанная в этом атрибуте.</li>
</ul>
</li>
</ul>
</div>
</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Настройка правила" src="https://kb.comindware.ru/assets/form_rules_properties.png"/></p>
<figcaption class="caption">Настройка правила</figcaption>
</figure>
<h2 id="настройка-действия">Настройка действия</h2>
<p><strong>Действие</strong> определяет изменение, которое необходимо произвести с элементом формы или данными в поле при соблюдении условия выполнения действия и его родительского правила.</p>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы действий</p>
<p>Действия выполняются независимо друг от друга, последовательно по порядку следования в правиле — сверху вниз.</p>
<p>Если в правиле есть действия над одним и тем же элементом формы, будут последовательно выполнены все эти действия с учётом их условий выполнения.</p>
</div>
<ol class="colored_numbers_list">
<li>Перетащите действие из панели элементов в правило или выберите имеющееся действие.</li>
<li>Настройте <a class="mkdocs_imported_link" href="#типы-и-свойства-действий">свойства действия</a> с помощью панели «<strong>Свойства действия</strong>».</li>
<li>Чтобы изменить порядок выполнения действий, перетаскивайте их в правилах.</li>
</ol>
<h3 id="типы-и-свойства-действий">Типы и свойства действий</h3>
<p>Предусмотрены действия следующих типов, применимые к различным элементам формы:</p>
<ul>
<li><a class="mkdocs_imported_link" href="#свойства-действия-изменить-доступ"><strong>Изменить доступ</strong></a> — позволяет определить доступность элемента формы для конечного пользователя;</li>
<li><a class="mkdocs_imported_link" href="#свойства-действия-установить-значение"><strong>Установить значение</strong></a> — позволяет задать новое значение полей атрибутов;</li>
<li><a class="mkdocs_imported_link" href="#свойства-действия-показать-ошибку"><strong>Показать ошибку</strong></a> — позволяет вывести на форме сообщение, привязанное к указанному элементу.</li>
</ul>
<h4 id="доступные-действия-для-различных-элементов-формы">Доступные действия для различных элементов формы</h4>
<table style="width: 100%;">
<thead>
<tr>
<th>Тип элемента формы</th>
<th style="text-align: center;">Изменить доступ</th>
<th style="text-align: center;">Установить значение</th>
<th style="text-align: center;">Показать ошибку</th>
</tr>
</thead>
<tbody>
<tr>
<td>Статические элементы</td>
<td style="text-align: center;"><strong>+</strong></td>
<td style="text-align: center;"><strong>−</strong></td>
<td style="text-align: center;"><strong>−</strong></td>
</tr>
<tr>
<td>Поля атрибутов</td>
<td style="text-align: center;"><strong>+</strong></td>
<td style="text-align: center;"><strong>+</strong></td>
<td style="text-align: center;"><strong>+</strong></td>
</tr>
<tr>
<td>Столбцы таблиц</td>
<td style="text-align: center;"><strong>+</strong></td>
<td style="text-align: center;"><strong>+</strong></td>
<td style="text-align: center;"><strong>+</strong></td>
</tr>
<tr>
<td>Вложенные формы</td>
<td style="text-align: center;"><strong>+</strong></td>
<td style="text-align: center;"><strong>−</strong></td>
<td style="text-align: center;"><strong>−</strong></td>
</tr>
</tbody>
</table>
<h4 id="общие-свойства-действий">Общие свойства действий</h4>
<p>У действий всех типов предусмотрены перечисленные ниже свойства.</p>
<ul>
<li><strong>Элемент формы</strong> — элемент, над которым необходимо выполнить действие: статический элемент, поле, столбец таблицы или вложенная форма.</li>
<li><strong>Действие</strong> — <a class="mkdocs_imported_link" href="#типы-и-свойства-действий">тип действия</a>, которое необходимо выполнить над выбранным элементом. Появляется после выбора элемента формы.</li>
<li><strong>Условие выполнения</strong> — условие, которое применяется дополнительно к <a class="mkdocs_imported_link" href="#настройка-правила">условию выполнения правила</a>.
<ul>
<li>Действие «<a class="mkdocs_imported_link" href="#свойства-действия-изменить-доступ"><strong>Изменить доступ</strong></a>» или «<a class="mkdocs_imported_link" href="#свойства-действия-установить-значение"><strong>Установить значение</strong></a>» будет выполнено, если выражение вернёт <code>true</code>.</li>
<li>Действие «<a class="mkdocs_imported_link" href="#свойства-действия-показать-ошибку"><strong>Показать ошибку</strong></a>» будет выполнено, если выражение вернёт <code>false</code> или пустое значение.</li>
<li>Проверка условий выполнения и выполнение действий происходят после внесения изменений в любое поле на форме, а также при открытии формы.</li>
</ul>
</li>
</ul>
<div class="notice notice-success">
<p class="admonition-title">Контекст условия выполнения действия</p>
<p>Контекст вычисления условия выполнения действия зависит от того, к какому элементу формы применяется действие:</p>
<ul>
<li>если элемент не является столбцом таблицы, то контекстом является текущая запись, для которой открыта форма;</li>
<li>если элемент является столбцом таблицы, то контекстом является запись, которая относится к строке таблицы атрибута типа «<strong>Запись</strong>».</li>
</ul>
</div>
<figure class="screenshot_with_caption">
<p><img alt="Настройка действия" src="https://kb.comindware.ru/assets/form_rules_properties_action.png"/></p>
<figcaption class="caption">Настройка действия</figcaption>
</figure>
<p>Свойства действий каждого типа представлены в ниже.</p>
<h4 id="свойства-действия-изменить-доступ">Свойства действия «Изменить доступ»</h4>
<p>Это действие предназначено для смены режима доступа и видимости элемента на форме.</p>
<p>Действие «<strong>Изменить доступ</strong>» выполняется при открытии формы и после внесения изменений в любое поле формы, если условия выполнения правила и действия возвращают <code>true</code>.</p>
<p>Помимо <a class="mkdocs_imported_link" href="#общие-свойства-действий">общих свойств</a> у этого действия предусмотрено свойство «<strong>Новое значение</strong>».</p>
<p>В этом поле следует выбрать режим доступа для указанного элемента формы:</p>
<ul>
<li><strong>Требовать ввод</strong>— значение поля должно быть обязательно заполнено на момент сохранения формы;</li>
<li><strong>Разрешить ввод</strong> — в поля внутри выбранного элемента можно вводить значения;</li>
<li><strong>Только чтение</strong> — элемент отображается, но поля внутри него нельзя вводить значения;</li>
<li><strong>Скрыть</strong> — элемент не отображается на форме.</li>
</ul>
<p>Логика работы действия «Изменить доступ»</p>
<p>Изменение режима доступа к элементу формы применяется только до следующего изменения данных на форме:</p>
<ul>
<li>При изменении данных на форме для элемента устанавливается исходный режим доступа, заданный в конструкторе формы.</li>
<li>Все правила и действия выполняются заново.</li>
<li>Если для новых данных условия выполнения правил и действий больше не выполняются, устанавливается исходный режим доступа, заданный в конструкторе формы.</li>
</ul>
<p><strong>Доступные режимы доступа для элементов формы различных типов</strong></p>
<table style="width: 100%;">
<thead>
<tr>
<th>Тип элемента формы</th>
<th>Требовать ввод</th>
<th>Разрешить ввод</th>
<th>Только чтение</th>
<th>Скрыть</th>
</tr>
</thead>
<tbody>
<tr>
<td>Статические элементы</td>
<td><strong>−</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Поля атрибутов</td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Столбцы таблиц</td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Поля вычисляемых атрибутов</td>
<td><strong>−</strong></td>
<td><strong>−</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
<tr>
<td>Вложенные формы</td>
<td><strong>−</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
<td><strong>+</strong></td>
</tr>
</tbody>
</table>
<h4 id="свойства-действия-установить-значение">Свойства действия «Установить значение»</h4>
<p>Это действие предназначено для изменения данных в полях атрибутов и столбцов таблиц на форме.</p>
<p>Действие «<strong>Установить значения</strong>» выполняется при открытии формы и после внесения изменений в любое поле формы, если условия выполнения правила и действия возвращают <code>true</code>.</p>
<p>Помимо <a class="mkdocs_imported_link" href="#общие-свойства-действий">общих свойств</a> у этого действия предусмотрено свойство «<strong>Новое значение</strong>».</p>
<p>В это поле следует вести <strong>формулу</strong>, выражение на языке <strong>N3</strong> или <strong>значение.</strong></p>
<p>Тип <strong>нового значения</strong> должен соответствовать типу данных атрибута, с которым связано поле на форме:</p>
<ul>
<li><strong>Аккаунт</strong> — один или несколько идентификаторов аккаунтов;</li>
<li><strong>Гиперссылка</strong> — строка с URL-адресом;</li>
<li><strong>Дата и время</strong>— <code>DATE()</code>;</li>
<li><strong>Длительность</strong> — <code>DURATION()</code>;</li>
<li><strong>Документ</strong> — один или несколько идентификаторов документов;</li>
<li><strong>Запись</strong> — один или несколько идентификаторов записей из связанного шаблона.</li>
<li><strong>Изображение</strong> — один или несколько идентификаторов изображений;</li>
<li><strong>Логический</strong> — <code>true</code> или <code>false</code>;</li>
<li><strong>Организационная единица</strong> — один или несколько идентификаторов оргединиц;</li>
<li><strong>Роль</strong> — один или несколько идентификаторов ролей;</li>
<li><strong>Список значений</strong> — идентификатор значения из списка;</li>
<li><strong>Текст</strong> — строковое значение;</li>
<li><strong>Чертёж</strong> — идентификаторы записей, привязанных к чертежу;</li>
<li><strong>Число</strong> — <code>DECIMAL()</code>;</li>
<li><strong>Штрихкод</strong> — строка, которая будет закодирована в штрихкоде.</li>
</ul>
<div class="notice notice-success">
<p class="admonition-title">Контекст вычисления нового значения</p>
<p>Контекст вычисления <strong>нового значения</strong> поля зависит от того, к какому элементу формы применяется действие:</p>
<ul>
<li>если элемент не является столбцом таблицы, то контекстом является текущая запись, для которой открыта форма;</li>
<li>если элемент является столбцом таблицы, то контекстом является запись, которая относится к строке таблицы атрибута типа «<strong>Запись</strong>».</li>
</ul>
</div>
<p>Если <strong>новое значение</strong> будет пустым, то при выполнении действия поле на форме будет очищено.</p>
<p>Значение поля на форме может изменить другое действие или конечный пользователь.</p>
<h4 id="свойства-действия-показать-ошибку">Свойства действия «Показать ошибку»</h4>
<p>Это действие предназначено для проверки значений полей атрибутов и столбцов таблиц и вывода сообщения у поля на форме.</p>
<p>Действие «<strong>Показать ошибку</strong>» выполняется только при попытке сохранения экранной формы, если условие выполнения правила возвращает <code>true</code> и условие выполнения действия возвращает <code>false</code>.</p>
<p>Помимо <a class="mkdocs_imported_link" href="#общие-свойства-действий">общих свойств</a> у этого действия предусмотрены перечисленные ниже свойства.</p>
<ul>
<li><strong>Тип сообщения</strong>:
<ul>
<li><strong>Предупреждение</strong> — при сохранении формы выводит предупреждение на указанном поле формы, при этом данные на форме будут сохранены.</li>
<li><strong>Ошибка</strong> — при сохранении формы выводит ошибку на указанном поле формы, при этом данные на форме нельзя будет сохранить, пока ошибка не будет устранена.</li>
</ul>
</li>
<li><strong>Сообщение</strong> — введите строковое <strong>значение</strong> с текстом сообщения либо <strong>формулу</strong> или выражение на языке <strong>N3</strong>, возвращающие текст сообщения.</li>
</ul>
<figure class="screenshot_with_caption">
<p><img alt="Внешний вид сообщения об ошибке на поле" src="https://kb.comindware.ru/assets/form_rules_show_error.png"/></p>
<figcaption class="caption">Внешний вид сообщения об ошибке на поле</figcaption>
</figure>
<h2 id="удаление-правил-и-действий">Удаление правил и действий</h2>
<ol class="colored_numbers_list">
<li>Откройте <a class="mkdocs_imported_link" href="#переход-к-конструктору-правил-для-формы">конструктор правил для формы</a>.</li>
<li>Выберите правило или действие и перетащите его на панель элементов.</li>
<li>Подтвердите удаление удаления правила или действия.</li>
<li>Для очистки всех настроенных правил и действий можно нажать кнопку «<strong>Очистить</strong>».</li>
<li>Чтобы сохранить изменения, нажмите кнопку «Сохранить».</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Удаление правила для формы" src="https://kb.comindware.ru/assets/form_rules_delete.png"/></p>
<figcaption class="caption">Удаление правила для формы</figcaption>
</figure>
<p>Удаление правил для формы</p>
<h2 id="связанные-статьи">Связанные статьи</h2>
<p><strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4786">Формы. Определения, редактирование, удаление</a></strong></p>
<p><strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4785">Динамические элементы формы: поля атрибутов и вложенные формы. Настройка представления</a></strong></p>
<p><strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4787">Статические элементы формы: области, вкладки, колонки, статичный текст. Настройка представления</a></strong></p>
<p><strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4772">Атрибуты. Определения, типы, настройка, архивирование, удаление</a></strong></p>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#"> <em class="fa-light fa-arrow-up">‌<!--icon--></em> К началу </a></div>