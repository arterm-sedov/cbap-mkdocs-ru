<h1>Введение в API</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1h7csek432">Введение</a>
<ul>
<li><a href="#mcetoc_1hrgqoepi4">Определения</a></li>
</ul>
</li>
<li><a href="#mcetoc_1h7csd8su1">Доступ к API</a>
<ul>
<li><a href="#mcetoc_1hrh1s2k61">Методы API</a></li>
<li><a href="#mcetoc_1ho6umt4r1">Инициация запроса из внешней системы</a></li>
<li><a href="#mcetoc_1hrj96bl91">Аутентификация внешних систем при доступе к API</a></li>
<li><a href="#mcetoc_1ho6umbsb0">Инициация запроса к внешней системе</a></li>
<li><a href="#mcetoc_1hrj95ij20">Аутентификация при доступе к API внешних систем</a></li>
</ul>
</li>
<li><a href="#mcetoc_1h7csahj80">Использование Swagger</a></li>
<li><a href="#mcetoc_1hrh3hhb12">Пример вызова метода System Core API</a></li>
<li><a href="#mcetoc_1hrgord0u3">Связанные статьи</a></li>
</ul>
</div>
<h2 id="mcetoc_1h7csek432">Введение</h2>
<p><strong>Comindware Platform</strong> может обращаться к API внешних систем через <a href="https://kb.comindware.ru/category.php?id=821">подключения</a> и <a href="https://kb.comindware.ru/category.php?id=515">пути передачи данных</a>, а также может обрабатывать запросы из внешних систем через интерфейсы <strong>REST API</strong> трех типов:</p>
<ul>
<li><a href="https://kb.comindware.ru/article.php?id=4863"><strong>Solution API</strong></a></li>
<li><a href="https://kb.comindware.ru/article.php?id=4862"><strong>System Core API</strong></a></li>
<li><a href="https://kb.comindware.ru/article.php?id=4861"><strong>Web API</strong></a></li>
</ul>
<div class="notice notice-success">
<h3 class="admonition-title" id="mcetoc_1hrgqoepi4">Определения</h3>
<ul>
<li><strong>API</strong> (Application Programming Interface) — это интерфейс прикладного программирования — набор методов, классов, библиотек и функций, обеспечивающих возможность взаимодействия между системами.</li>
<li><strong>REST API </strong>— это API, соответствующий архитектуре Representational State Transfer (передача репрезентативного состояния). Преимуществами REST API являются возможность оптимального использования протокола HTTP, масштабирования сервисов и разработки приложений с использованием практически любых языков программирования с соблюдением принципов проектирования REST:
<ul>
<li>отсутствие сохранения состояния на сервере — каждый поступающий запрос содержит все необходимые для обработки данные и обрабатывается независимо от других запросов;</li>
<li>единообразный интерфейс — сервер передаёт информацию в стандартном формате;</li>
<li>независимость клиента и сервера — клиент может взаимодействовать с сервером только посредством URI ресурса, а сервер может лишь передавать на клиент запрошенные данные посредством HTTP;</li>
<li>возможность кэширования ресурсов — ответы содержат данные о кэшируемости, запрашиваемые многократно ресурсы могут кэшироваться на стороне сервера или клиента;</li>
<li>многоуровневая архитектура системы — клиент может подключаться к авторизованным посредникам между клиентом и сервером, чтобы получать ответы от сервера, а сервер может передавать запросы другим серверам;</li>
<li>код по запросу — сервер может расширить возможности клиента, передав исполняемый код, например, для проверки введённых пользователем данных.</li>
</ul>
</li>
<li><strong>RESTful</strong> — это веб-служба, реализующая архитектуру <strong>REST</strong>.</li>
<li><strong>Ресурс</strong> — это объект или информация в приложении, например шаблон, аккаунт или документ, доступ к которым предоставляет API.</li>
<li><strong>URI ресурса</strong> — это универсальный идентификатор ресурса в API.</li>
<li><strong>Клиент</strong> — это человек или система, которые осуществляют доступ к ресурсам посредством API.</li>
</ul>
</div>
<h2 id="mcetoc_1h7csd8su1">Доступ к API</h2>
<p>В простейшем случае <strong>RESTful</strong>-службы отправляют и получают HTTP-запросы в строке URL-адреса для получения и отправки данных, запуска команд и выполнения других действий.</p>
<p>Все интеграции с помощью <strong>REST API</strong> настраиваются по одному принципу:</p>
<ul>
<li>составьте сценарий интеграции — какая система инициирует вызов API, как часто, какие методы она использует для передачи каких данных, что потом происходит и т. д.;</li>
<li>используйте документацию по API для тестирования запросов, настройки подключения и формирования финальных «рабочих» запросов.</li>
</ul>
<h3 id="mcetoc_1hrh1s2k61">Методы API</h3>
<p><strong>Comindware Platform</strong> поддерживает следующие методы API.</p>
<ul>
<li><code>GET</code> — получить список всех записей.</li>
<li><code>GET {id}</code> — получить данные о записи с идентификатором <code>{id}</code>.</li>
<li><code>DELETE {id}</code> — удалить запись с идентификатором <code>{id}</code>.</li>
<li><code>POST</code> — создать новую запись<span style="letter-spacing: 0.2px;">.</span></li>
<li><code>PUT {id}</code> — изменить данные о записи с идентификатором <code>{id}</code>.</li>
</ul>
<h3 id="mcetoc_1ho6umt4r1">Инициация запроса из внешней системы</h3>
<p><strong>Comindware Platform</strong> может принимать HTTP-запросы к <strong>API</strong> двумя способами:</p>
<ul>
<li>Запрос <code>GET</code> или <code>DELETE</code> в виде URL-строки, содержащей все параметры запроса.
<ul>
<li>Внешняя система отправляет запрос в строке URL. Заготовку запроса для внешней системы можно сформировать в интерфейсе <a href="#mcetoc_1h7csahj80">Swagger</a>. </li>
<li>Такой запрос можно проверить с помощью браузера: скопируйте полученный <strong>Request URL </strong>в адресную строку и нажмите клавишу <kbd>Enter</kbd>. Если вы уже вошли в систему в этом браузере, аутентификация не потребуется.</li>
</ul>
</li>
<li>Запрос <code>POST</code> или <code>PUT</code> с телом, содержащим все параметры (например, имя пользователя и пароль, данные, которые необходимо отправить или получить и т. д.).
<ul>
<li>Внешняя система отправляет запрос в формате JSON или XML. Заготовку запроса для внешней системы можно сформировать в интерфейсе <a href="#mcetoc_1h7csahj80">Swagger</a>. </li>
<li>Этот вариант является более гибким, позволяя передать гораздо больше данных в структурированном виде. Но такой запрос нельзя протестировать с помощью браузера. Для тестирования можно использовать встроенный <span style="letter-spacing: 0.2px;">веб-интерфейс Swagger или такие службы, как Postman, SoapUI, Insomnia и т. п.</span></li>
</ul>
</li>
<li><strong>Comindware Platform</strong> возвращает ответ формате JSON или XML.</li>
</ul>
<h3 id="mcetoc_1hrj96bl91">Аутентификация внешних систем при доступе к API</h3>
<p>API <strong>Comindware Platform</strong> поддерживает два способа аутентификации внешних систем:</p>
<ul>
<li>Basic-аутентификация — требуется передать имя пользователя и пароль аккаунта, от имени которого будет выполняться запрос;</li>
<li>HMAC —  требуется передать токен и секретный ключ, сформированные для аккаунта на странице «<strong>Администрирование</strong>» – «<strong>Ключи аутентификации</strong>».</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<ul>
<li>Для использования методов API и интерфейса <a href="#mcetoc_1h7csahj80">Swagger</a> следует создать специальный аккаунт и предоставить предоставить ему разрешение «<strong>Вызов API</strong>» в системной роли. См. <em>«<samp data-name="aid" data-title="" data-value="4662"><span style="color: #0066bc; font-family: Tahoma;">Системные роли. Определения, настройка, объединение, удаление {Article-ID:4662}</span></samp>»</em>. Кроме того, API и Swagger могут использовать пользователи, входящие в системную роль «<strong>Системные администраторы</strong>».</li>
<li>При вызове методов API в интерфейсе <a href="#mcetoc_1h7csahj80">Swagger</a> на странице <code>https://your-host/docs</code> уже выполнен вход в <strong>Comindware Platform</strong>, и дополнительная аутентификация не требуется.</li>
<li>При вызове методов API из внешней системы в запросы необходимо добавлять заголовки для аутентификации с использованием аккаунта, которому предоставлен доступ к API. </li>
<li>Большинство внешних систем обладают интерфейсом настройки метода аутентификации, при отсутствии такового добавьте в <code>Header</code> запроса параметр <code>Authorization</code>, содержащий зашифрованные в формате <code>Base64</code> имя пользователь и пароль.</li>
</ul>
</div>
<h3 id="mcetoc_1ho6umbsb0">Инициация запроса к внешней системе</h3>
<p><strong>REST API</strong> широко применяется в современных системах, и зачастую найти документацию по использованию API конкретной системы можно, введя в поисковой системе запрос вида <em>«&lt;название системы&gt; REST API»</em>.</p>
<p>В <strong>Comindware Platform </strong>поддерживает перечисленные ниже способы обращения к API внешних систем:</p>
<ul>
<li>Запрос отправляет скрипт на C# (вызываемый <a href="https://kb.comindware.ru/article.php?id=4790#mcetoc_1gk3dof774">кнопкой</a> или <a href="https://kb.comindware.ru/article.php?id=22388">задачей выполнения сценария</a> в процессе). Скрипт устанавливает подключение к внешней системе, формирует запрос, отправляет его и получает ответ.</li>
<li>Запрос формирует и отправляет <a href="https://kb.comindware.ru/article.php?id=2153" style="letter-spacing: 0.2px; background-color: #ffffff;">сценарий</a><span style="letter-spacing: 0.2px;"> посредством настроенного подключения к внешней системе. </span>Сценарий позволяет сформировать тело запроса, проанализировать полученный ответ и поместить из него данные в атрибуты записей. </li>
<li>Запрос формирует и отправляет <a href="https://kb.comindware.ru/article.php?id=4740">промежуточное</a> или <a href="https://kb.comindware.ru/article.php?id=4745">конечное событие</a> отправки сообщения в процессе.</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Для отправки запросов с помощью сценариев и событий процесса требуется настроить <a href="https://kb.comindware.ru/article.php?id=4675">подключение</a> к внешней службе и <a href="https://kb.comindware.ru/article.php?id=4676">путь передачи данных</a>. </p>
</div>
<h3 id="mcetoc_1hrj95ij20">Аутентификация при доступе к API внешних систем</h3>
<p>При доступе из к внешним API используйте метод аутентификации, который поддерживает внешняя система. Обратитесь документации API этой системы, чтобы узнать, следует ли указывать имя пользователя b пароль в URL-адресе или теле запроса, или необходимо сгенерировать и использовать токен безопасности вместо передачи пароля в виде обычного текста.</p>
<h2 id="mcetoc_1h7csahj80">Использование Swagger</h2>
<p><strong>Comindware Platform</strong> предоставляет встроенный веб-интерфейс API на основе Swagger.</p>
<ul>
<li>Swagger предоставляет подробную справку по методам API, включая описания запросов и ответов, а также модели данных с примерами значений.</li>
<li>Swagger позволяет выполнять запросы и просматривать ответы.</li>
<li>При выполнении запроса Swagger формирует URI ресурса API для использования во внешних системах, включая синтаксис тела запроса.</li>
</ul>
<ol class="colored_numbers_list">
<li>Чтобы перейти к странице Swagger, введите в адресной строке браузера строку <code>https://your-host/docs</code>, где <code>your-host</code> — доменное имя вашего сервера.</li>
<li>Отобразится страница <strong>Comindware Platform API </strong>со следующими разделами:
<ul>
<li><strong>RESTful Web API</strong> — общие методы для всех версий ПО (см. <samp data-name="aid" data-title="" data-value="4861"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>{Article-ID:4861}</span></samp>);</li>
<li><strong>System Core API</strong> — системные методы, которые могут отличаться для разных версий ПО (см. <samp data-name="aid" data-title="" data-value="4862"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>{Article-ID:4862}</span></samp>);</li>
<li><strong>Solution API</strong> — методы для шаблонов бизнес-приложений (см. <samp data-name="aid" data-title="" data-value="4863"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>{Article-ID:4863}</span></samp>).</li>
</ul>
</li>
<li>Перейдите на страницу требуемого API.</li>
<li>Раскройте требуемый метод API в списке.</li>
<li>Выберите формат запроса и ответа в поле <strong>Response Content Type</strong>.</li>
<li>Запустите любой из доступных методов, нажав кнопку <strong>Try it out</strong>.</li>
<li>Отобразится заготовка запроса: 
<ul>
<li><strong>Request URL</strong> — скопируйте эту строку во внешнюю систему в качестве URI запроса, для запросов <code>GET</code> и <code>DELETE</code> она содержит весь запрос;</li>
<li><strong>Example Value</strong> — скопируйте эту строку во внешнюю систему в качестве тела запроса.</li>
</ul>
</li>
</ol>
<figure class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Страница Swagger UI с разделами API Comindware Platform" class="img-responsive" height="622" src="https://kb.comindware.ru/assets/img_661d06c21de49.png" width="1048"/></p>
<figcaption class="caption" style="font-size: 15px !important;">Страница Swagger UI с разделами API Comindware Platform</figcaption>
</figure>
<h2 id="mcetoc_1hrh3hhb12">Пример вызова метода System Core API</h2>
<p>Для создания шаблона записи с помощью System Core API отправьте следующий <code>POST</code>-запрос на адрес <strong><span style="vertical-align: inherit;">Request URL</span></strong>, указанный в Swagger:</p>
<pre><code>http://your-host/api/public/system/TeamNetwork/ObjectAppService/Create</code></pre>
<ul>
<li>Вместо <code>your-host</code> укажите адрес экземпляра <strong>Comindware Platform</strong>.</li>
<li>В теле запроса (<code>body</code>) укажите системное имя шаблона записи (например, <code>"Car"</code>).</li>
<li>В ответ на запрос <strong>Comindware Platform </strong>вернёт ID созданного шаблона записи (например, <code>"oa.1"</code>).</li>
</ul>
<h2 id="mcetoc_1hrgord0u3">Связанные статьи</h2>
<p><strong><samp data-name="aid" data-title="" data-value="4863"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Методы Solution API {Article-ID:4863}</span></samp> </strong></p>
<p><strong><samp data-name="aid" data-value="4862"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Методы System Core API {Article-ID:4862}</span></samp> </strong></p>
<p><strong><samp data-name="aid" data-title="" data-value="4861"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Методы Web API {Article-ID:4861}</span></samp> </strong></p>
<p><a class="md-top md-icon mkdocs_imported_link" href="#"> <em class="fa-light fa-arrow-up">‌</em> К началу </a></p>