<h1>Comindware интеграция с ФНС</h1><p>ФНС предоставляет данные компаний, которые, в частности, могут быть необходимы в процессе проверки контрагента. Интеграция с сервисом ФНС осуществляется через подключение к <a href="https://api-fns.ru/index">API-ФНС</a>. </p>
<p>В данной статье представлен базовый вариант интеграций по следующему сценарию: получение ряда данных компании по указанному ИНН (метод <em>multinfo</em>). Интеграция запускается по нажатию кнопки в записи контрагента. Данные забираются из сведений баз данных ФНС, но не все данные могут присутствовать. Если ИНН является действительным, то полученные из базы ФНС данные запишутся в поля, если поля остались пустыми — это означает, что в ФНС таких данных нет. При повторном нажатии на кнопку данные будут перезаписаны.</p>
<p>Для юридического лица будут получены следующие данные:</p>
<ul>
<li>Наименование юридического лица;</li>
<li>Количество сотрудников;</li>
<li>Годовой доход;</li>
<li>ФИО руководителя;</li>
<li>ОГРН;</li>
<li>КПП;</li>
<li>Юридический адрес;</li>
<li>ОКВЭД;</li>
<li>Вид деятельности.</li>
</ul>
<p>Для ИП будут получены следующие данные:</p>
<ul>
<li>Наименование;</li>
<li>ФИО руководителя;</li>
<li>ОГРН;</li>
<li>Юридический адрес;</li>
<li>ОКВЭД;</li>
<li>Вид деятельности.</li>
</ul>
<p><strong>Настройка</strong></p>
<p><strong>1.</strong> Зарегистрируйтесь на сайте <a href="https://api-fns.ru/index">API-ФНС</a> и получите API ключ для подключения. </p>
<p><strong>2.</strong> В шаблоне записи, где хранятся данные по контрагентам, добавьте кнопку с операцией C# скрипт.</p>
<p><strong>3. </strong>Скачайте файл со скриптом из вложения к данной статье и модифицируйте его под свои данные:</p>
<ul>
<li>строка 23, 25, 30 — "INN" (вставьте в кавычках системное имя атрибута, хранящего данные по ИНН компании);</li>
<li>строка 31 — "123" (вставьте в кавычках полученный API ключ);</li>
<li>строка 42 — "NaimenovanieYuL" (вставьте в кавычках системное имя атрибута, хранящего данные по наименованию юридического лица);</li>
<li>строка 43 — "Kolichestvosotrudnikov" (вставьте в кавычках системное имя атрибута, хранящего данные по количеству сотрудников компании);</li>
<li>строка 45 — "Godovoydokhod" (вставьте в кавычках системное имя атрибута, хранящего данные по годовому доходу компании);</li>
<li>строка 46, 57 — "FIOrukovoditelya" (вставьте в кавычках системное имя атрибута, хранящего данные по ФИО руководителя компании);</li>
<li>строка 48, 58 — "OGRN" (вставьте в кавычках системное имя атрибута, хранящего данные по ОГРН компании);</li>
<li>строка 49 — "KPP" (вставьте в кавычках системное имя атрибута, хранящего данные по КПП компании);</li>
<li>строка 50, 59 — "Yuridicheskiyadres" (вставьте в кавычках системное имя атрибута, хранящего данные по юридическому адресу компании);</li>
<li>строка 52, 61 — "OKVED" (вставьте в кавычках системное имя атрибута, хранящего данные по коду ОКВЭД компании);</li>
<li>строка 53, 62 — "Viddeyatelnosti" (вставьте в кавычках системное имя атрибута, хранящего данные по виду деятельности компании);</li>
<li>строка 56 — "Naimenovanie" (вставьте в кавычках системное имя атрибута, хранящего данные по наименованию ИП);</li>
<li>строка 54, 64 — "Clients" (вставьте в кавычках системное имя шаблона записи, где хранятся все вышеуказанные атрибуты, т.е., текущий шаблон записи).</li>
</ul>
<p><strong>4.</strong> Во вкладке «<em><strong>Скрипт</strong></em>» вставьте получившийся скрипт.</p>
<p><strong>5.</strong> Нажмите «<em><strong>Сохранить</strong></em>».</p>
<p><strong>6.</strong> Расположите кнопку на формуе, или на области кнопок для формы.</p>
<p>При выполнении скрипта могут возникнуть следующие ошибки:</p>
<ul>
<li>Нет ИНН — атрибут для указания ИНН пустой. </li>
<li>Проблема с ответом — произошла проблема на сервере ФНС или проблема с API.</li>
<li>Нет компании по такому ИНН — в базе ФНС не найдена компания по такому ИНН;</li>
<li>Пустые поля — ФНС не хранит данных по указанной компании.</li>
<li>Ошибка — Возникла неизвестная ошибка.</li>
</ul>