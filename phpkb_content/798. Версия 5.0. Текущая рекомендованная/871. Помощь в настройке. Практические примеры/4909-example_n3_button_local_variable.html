<h1>Локальная переменная. Использование для массовой обработки записей</h1><p>В Comindware Platform можно настроить возможность массовой обработки несколько записей в таблице, например, если нужно поменять статус у нескольких заявок одновременно, подтвердить оплату нескольких счетов и т. д. В данной статье рассмотрен пример массового назначения исполнителей по заявкам и последующий запуск процесса по каждой из заявок.</p>
<p>Так как невозможно при выборе нескольких записей открывать какую-либо форму (форма показывает только атрибуты одной записи), предлагается использовать механизм локальных переменных. В локальную переменную можно поместить некоторое значение, которое потом можно применить или продублировать для всех выбранных записей.</p>
<p><strong>Исходные данные:</strong></p>
<ul>
<li>Шаблон записи «Заявки».</li>
<li>Атрибут «Ответственный» в шаблоне записи «Заявки» (тип данных — Аккаунт).</li>
<li>Шаблон процесса «Исполнение заявки».</li>
</ul>
<p><strong>Настройка:</strong></p>
<p><strong>1.</strong> В шаблоне записи «Заявки» создайте кнопку со следующими параметрами:</p>
<ul>
<li>Отображаемое название — Назначить исполнителя;</li>
<li>Контекст операции — Запись;</li>
<li>Операция — Сохранить;</li>
<li>Результат выполнения — Обновить данные;</li>
<li>Отображать диалоговое окно — отметьте чекбокс.</li>
</ul>
<p>Сохраните настройки кнопки и перейдите во вкладку «Локальные переменные». Создайте переменную «Исполнитель» (тип данных — Аккаунт).</p>
<p>Перейдите во вкладку «Свойства» и нажмите на «Настроить диалоговое окно». Вынесите на центральную область созданную локальную переменную. Сохраните настройки и вынесите кнопку на область кнопок для таблиц.</p>
<p><strong>2.</strong> Перейдите в настройки приложения и нажмите «Сценарии». Создайте новый сценарий со следующими параметрами:</p>
<ul>
<li>Название — Назначение исполнителя по заявке</li>
<li>Контекст выполнения — От инициатора;</li>
<li>Статус — Активен.</li>
</ul>
<p><strong>3.</strong> Настройте триггер на нажатие созданной в п. 1 кнопки, добавьте действие по изменению значения. Выберите атрибут «Ответственный», укажите операцию со значениями — Заменить и в поле «Значение», выберите N3 и вставьте следующее выражение:</p>
<div>
<table class="source_code_container">
<tbody>
<tr>
<td class="source_code">
<p style="margin-left: .5in;">@prefix cmwsession: &lt;http://comindware.com/ontology/session#&gt;.<br/>@prefix user: &lt;http://comindware.com/ontology/user#&gt;.<br/>@prefix variable: &lt;http://comindware.com/ontology/session/variable#&gt;.<br/>@prefix debug: &lt;http://comindware.com/ontology/debug#&gt;.</p>
<p style="margin-left: .5in;">{<br/>    cmwsession:context variable:dialogVariables ?v1.<br/>    ?v1 variable:Ispolnitel ?value.<br/>}</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>Важно указать системное имя, прописанное в локальной переменной после «<em><strong>variable:</strong></em>».</p>
<p>Затем добавьте действие «Запуск процесса», выберите процесс «Исполнение заявки». Перейдите во вкладку «Дополнительно» и отметьте галочки «Выполнять отдельно от сценария» и «Игнорировать все ошибки», если этого не сделать, процесс запустится не по каждой из записи, а только по одной.</p>
<p><strong>4.</strong> Протестируйте. Выберите несколько заявок, нажмите на кнопку «Назначить исполнителей». Откроется диалоговое окно с локальной переменной «Исполнитель». Выберите пользователя, подтвердите операцию.</p>