<h1>Урок 6. Усовершенствованный процесс</h1><div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="4870">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#введение">
<span class="md-ellipsis">
      Введение
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-выбора-типа-автомобиля-при-оформлении-заявки">
<span class="md-ellipsis">
      Настройка выбора типа автомобиля при оформлении заявки
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-выбора-автомобиля-при-выполнении-рейса">
<span class="md-ellipsis">
      Настройка выбора автомобиля при выполнении рейса
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-учёта-затрат-во-время-выполнения-рейса">
<span class="md-ellipsis">
      Настройка учёта затрат во время выполнения рейса
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-атрибута-итоговая-сумма-затрат">
<span class="md-ellipsis">
      Настройка атрибута «Итоговая сумма затрат»
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#тестирование-выбора-автомобиля-и-учёта-затрат">
<span class="md-ellipsis">
      Тестирование выбора автомобиля и учёта затрат
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-добавления-мастер-данных-на-лету">
<span class="md-ellipsis">
      Настройка добавления мастер-данных на лету
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#тестирование-добавления-нового-автомобиля-перед-выполнением-рейса">
<span class="md-ellipsis">
      Тестирование добавления нового автомобиля перед выполнением рейса
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#результаты">
<span class="md-ellipsis">
      Результаты
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="введение">Введение</h2>
<p>В ходе этого урока вы усовершенствуете процесс заказа автомобиля, используя созданные на предыдущем уроке шаблоны записей (реестры) (<em>Типы автомобилей, Автомобили, Затраты, Типы затрат</em>), — добавите возможность выбора типа машины из справочника во время оформления заявки и настроите учёт машин в гараже и отслеживание расходов.</p>
<p><strong>Предусловия:</strong> пройден <em><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4869">урок 5 «Структуры данных»</a></em>.</p>
<p><strong>Расчётная продолжительность:</strong> 100 мин.</p>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>В данном уроке представлен продукт <strong>Comindware Platform</strong> версии 5.0, внешний вид страниц и меню в других версиях продукта может отличаться.</p>
</div>
<h2 id="настройка-выбора-типа-автомобиля-при-оформлении-заявки">Настройка выбора типа автомобиля при оформлении заявки</h2>
<p>Добавим возможность выбора типа автомобиля для <em>Заказчика</em> при создании заявки. Для этого настроим основную форму заявки.</p>
<ol class="colored_numbers_list">
<li>Перейдите к шаблону <em>«Заявки на автомобили»</em>.</li>
<li>Выберите вкладку «<strong>Формы</strong>».</li>
<li>Откройте конструктор формы <em>«Заявки на автомобили — Основная форма»</em>.</li>
<li>Перетащите на макет формы атрибут <em>«Тип автомобиля»</em>.</li>
<li>Сохраните форму.</li>
</ol>
<figure class="screenshot_with_caption">
<p><img alt="Добавление атрибута «Тип автомобиля» на форму заявки на автомобиль" src="/platform/v5.0/tutorial/img/lesson_6_request_form_vehicle_type_add.png"/><figcaption class="caption">Добавление атрибута «Тип автомобиля» на форму заявки на автомобиль</figcaption></p>
</figure>
<h2 id="настройка-выбора-автомобиля-при-выполнении-рейса">Настройка выбора автомобиля при выполнении рейса</h2>
<p>Настроим форму для задачи <em>«Принять заявку»</em>, чтобы <em>Диспетчер гаража</em> мог выбрать машину для выполнения рейса.</p>
<ol class="colored_numbers_list">
<li>Перейдите к диаграмме процесса <em>«Заказ автотранспорта»</em>.</li>
<li>Нажмите кнопку «<strong>Редактировать</strong>».</li>
<li>Выберите задачу <em>«Принять заявку»</em>.</li>
<li>
<p>В меню элемента нажмите кнопку «<strong>Форма</strong>» <i class="fa-light fa-newspaper">‌<!--icon--></i>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Переход к настройке формы задачи «Принять заявку» на диаграмме процесса" src="/platform/v5.0/tutorial/img/lesson_6_process_accept_task_form.png"/><figcaption class="caption">Переход к настройке формы задачи «Принять заявку» на диаграмме процесса</figcaption></figure></p>
</li>
<li>
<p>Разверните элемент <em>«Заявки на автомобиль»</em> на панели элементов.</p>
</li>
<li>Перетащите атрибут <em>«Автомобиль»</em> в область <em>«Принятие заявки»</em>.</li>
<li>Укажите для поля <em>«Автомобиль»</em> <strong>режим доступа</strong> «<strong>Требовать ввод</strong>».</li>
<li>
<p>Сохраните форму.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Добавление атрибута «Автомобиль» на форму задачи «Принять заявку»" src="/platform/v5.0/tutorial/img/lesson_6_accept_task_form_vehicle_add.png"/><figcaption class="caption">Добавление атрибута «Автомобиль» на форму задачи «Принять заявку»</figcaption></figure></p>
</li>
</ol>
<h2 id="настройка-учёта-затрат-во-время-выполнения-рейса">Настройка учёта затрат во время выполнения рейса</h2>
<div class="notice notice-warning">
<p class="admonition-title">Бизнес-логика</p>
<p>Когда <em>Водитель</em> получит задачу <em>«Выполнить рейс»</em>, он должен увидеть номерной знак забронированного автомобиля.</p>
<p>Мы также дадим <em>Водителю</em> возможность добавить новый автомобиль в список и отслеживать затраты на поездку.</p>
<p>Для этого добавим раскрывающийся список <em>«Автомобиль»</em> и таблицу <em>«Затраты»</em> на форму задачи <em>«Выполнить рейс»</em>.</p>
</div>
<ol class="colored_numbers_list">
<li>На диаграмме процесса выберите задачу <em>«Выполнить рейс»</em> и с помощью меню элемента перейдите к ее форме.</li>
<li>Разверните элемент <em>«Заявки на автомобиль»</em>.</li>
<li>Перетащите атрибуты <em>«Автомобиль»</em> и <em>«Затраты»</em> на область <em>«Выполнить рейс»</em>.</li>
<li>
<p>В панели свойств для поля <em>«Затраты»</em> выберите <strong>представление</strong> «<strong>Таблица</strong>».</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Добавление на форму задачи «Выполнить рейс» раскрывающегося списка «Автомобиль» и таблицы «Затраты»" src="/platform/v5.0/tutorial/img/lesson_6_driver_task_form_costs_car_add.png"/><figcaption class="caption">Добавление на форму задачи «Выполнить рейс» раскрывающегося списка «Автомобиль» и таблицы «Затраты»</figcaption></figure></p>
</li>
<li>
<p>Разверните элемент <em>«Затраты»</em> на панели элементов.</p>
</li>
<li>Перетащите атрибуты <em>«Тип затрат»</em> и <em>«Сумма»</em> в таблицу <em>«Затраты»</em> на форме.</li>
<li>
<p>Выберите <strong>область кнопок</strong> таблицы <em>«Затраты»</em> и перетащите на нее из панели элементов кнопки «<strong>Создать</strong>», «<strong>Редактировать</strong>» и «<strong>Перейти</strong>». Это позволит пользователю создавать, редактировать и просматривать записи о затратах в таблице <em>«Затраты»</em> на форме.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Добавление в таблицу на форме задачи «Выполнить рейс» атрибутов записи «Затраты»" src="/platform/v5.0/tutorial/img/lesson_6_driver_task_form_cost_type_add.png"/><figcaption class="caption">Добавление в таблицу на форме задачи «Выполнить рейс» атрибутов записи «Затраты»</figcaption></figure></p>
</li>
</ol>
<h2 id="настройка-атрибута-итоговая-сумма-затрат">Настройка атрибута «Итоговая сумма затрат»</h2>
<p>Добавим в шаблон <em>«Заявки на автомобили»</em> атрибут, хранящий итоговую сумму затрат на рейс.</p>
<ol class="colored_numbers_list">
<li>Нажмите кнопку «<strong>Добавить атрибут</strong>» у атрибута <em>«Заявки на автомобили»</em> в панели элементов.</li>
<li>
<p>Настройте <strong>новый атрибут</strong>:</p>
<ul>
<li><strong>Название:</strong> <em>Итоговая сумма затрат</em></li>
<li><strong>Тип данных: число</strong></li>
<li><strong>Количество знаков после запятой: 2</strong></li>
</ul>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка атрибута «Итоговая сумма затрат» в шаблоне «Заявки на автомобили»" src="/platform/v5.0/tutorial/img/lesson_6_total_cost_attribute_configure.png"/><figcaption class="caption">Настройка атрибута «Итоговая сумма затрат» в шаблоне «Заявки на автомобили»</figcaption></figure></p>
</li>
<li>
<p>Перетащите атрибут <em>«Итоговая сумма затрат»</em> в область <em>«Выполнить рейс»</em> под таблицу <em>«Затраты»</em>.</p>
</li>
<li>Сохраните форму задачи <em>«Выполнить рейс»</em>.</li>
<li>Вернитесь к диаграмме процесса, нажав кнопку «<strong>Назад</strong>» в браузере.</li>
<li>Опубликуйте диаграмму процесса.</li>
</ol>
<div class="notice notice-success">
<p class="admonition-title">Версии экземпляров процессов</p>
<p>Изменения на диаграмме процесса вступают в силу только после ее публикации.</p>
<p>При публикации создаётся новая версия диаграммы:</p>
<ul>
<li>
<p>Экземпляры процесса, запущенные по старой версии диаграммы, будут выполняться до конца по этой версии. </p>
</li>
<li>
<p>Новые экземпляры процесса будут выполняться по новой версии диаграммы.</p>
</li>
</ul>
</div>
<h2 id="тестирование-выбора-автомобиля-и-учёта-затрат">Тестирование выбора автомобиля и учёта затрат</h2>
<ol class="colored_numbers_list">
<li>Перейдите на вкладку «<strong>Свойства</strong>» шаблона процесса <em>«Заказ автотранспорта»</em>.</li>
<li>Нажмите кнопку «<strong>Перейти к экземплярам</strong>».</li>
<li>В списке экземпляров процесса запустите новый процесс, нажав кнопку «<strong>Создать</strong>».</li>
<li>Заполните поля заявки и укажите тип автомобиля.</li>
<li>Нажмите кнопку «<strong>Создать</strong>».</li>
<li>Перейдите на страницу «<strong>Мои задачи</strong>» с помощью панели навигации слева.</li>
<li>Откройте задачу <em>«Заказ автотранспорта — Рассмотреть заявку»</em></li>
<li>Установите флажок <em>«Заявка одобрена»</em>.</li>
<li>Завершите задачу.</li>
<li>Вернитесь на страницу «<strong>Мои задачи</strong>».</li>
<li>Откройте задачу <em>«Заказ автотранспорта — Принять заявку»</em>.</li>
<li>В поле <em>«Автомобиль»</em> выберите автомобиль из раскрывающегося списка.</li>
<li>Укажите в поле <em>«Принято» — «Да»</em> и завершите задачу.</li>
<li>Вернитесь на страницу «<strong>Мои задачи</strong>».</li>
<li>Откройте задачу <em>«Выполнить рейс»</em>.</li>
<li>Нажмите кнопку «<strong>Создать</strong>» в таблице <em>«Затраты»</em>.</li>
<li>Укажите сумму и тип затрат в таблице.</li>
<li>Нажмите кнопку «<strong>Сохранить</strong>».</li>
<li>Добавьте еще несколько записей в таблицу затрат.</li>
<li>Завершите задачу.</li>
</ol>
<h2 id="настройка-добавления-мастер-данных-на-лету">Настройка добавления мастер-данных на лету</h2>
<p>Реализуем для <em>Водителя</em> возможность ввода данных нового автомобиля перед выполнением рейса.</p>
<ol class="colored_numbers_list">
<li>Вернитесь к диаграмме процесса <em>«Заказ автотранспорта»</em>.</li>
<li>Нажмите кнопку «<strong>Редактировать</strong>».</li>
<li>Перейдите к форме задачи <em>«Выполнить рейс»</em>.</li>
<li>Выберите поле <em>«Автомобиль»</em> на форме и в его свойствах установите флажок «<strong>Создание записей</strong>».</li>
<li>
<p>Укажите <strong>форму</strong> для создания записей: <em>«Автомобиль — Основная форма».</em></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка атрибута «Автомобиль» для создания записей на лету" src="/platform/v5.0/tutorial/img/lesson_6_driver_task_form_select_vehicle.png"/><figcaption class="caption">Настройка атрибута «Автомобиль» для создания записей на лету</figcaption></figure></p>
</li>
<li>
<p>Сохраните форму задачи.</p>
</li>
<li>Опубликуйте диаграмму процесса.</li>
</ol>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Установив флажок «<strong>Создание записей</strong>» в свойствах раскрывающегося списка, мы даём пользователю возможность создавать записи с помощью формы связанного шаблона.</p>
<p>Когда этот флажок установлен для поля <em>«Автомобиль»</em>, <em>Водитель</em> сможет добавить новый автомобиль «на лету».</p>
</div>
<h2 id="тестирование-добавления-нового-автомобиля-перед-выполнением-рейса">Тестирование добавления нового автомобиля перед выполнением рейса</h2>
<ol class="colored_numbers_list">
<li>Запустите процесс и пройдите его до задачи <em>«Выполнить рейс»</em>.</li>
<li>
<p>В форме задачи <em>«Выполнить рейс»</em> нажмите кнопку «<strong>Создать</strong>» в поле <em>«Автомобиль».</em></p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Создание автомобиля с помощью раскрывающегося списка на форме" src="/platform/v5.0/tutorial/img/lesson_6_vehicle_select.png"/><figcaption class="caption">Создание автомобиля с помощью раскрывающегося списка на форме</figcaption></figure></p>
</li>
<li>
<p>Заполните поля отобразившейся формы и сохраните её.</p>
</li>
<li>Завершите задачу.</li>
</ol>
<h2 id="результаты">Результаты</h2>
<p>В ходе этого урока вы настроили для <em>Диспетчера гаража</em> форму задач и возможность выбора типа автомобиля, реализовали для <em>Водителя</em> возможность добавления нового автомобиля перед выполнением рейса и протестировали усовершенствованный процесс.</p>
<p>В <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4872">следующем уроке</a> вы настроите автоматическое вычисление номера, статуса и итоговой суммы затрат по заявке, а также фильтрацию при выборе типа автомобиля.</p>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">‌<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>