<h1>Написание запросов на языке формул Comindware</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1h0hvc0uf0">Операторы запросов</a></li>
<li><a href="#mcetoc_1h0ftuuq00">Примеры запросов</a></li>
</ul>
</div>
<p>В данной статье представлен синтаксис и примеры предложений и операторов для запросов на языке формул <strong>Comindware Platform</strong>.</p>
<h2 id="mcetoc_1h0hvc0uf0">Операторы запросов</h2>
<table style="height: 895px;">
<tbody>
<tr style="height: 40px;">
<th style="height: 40px; width: 108.429px;"><a id="from_clause"></a>from</th>
<th style="height: 40px; width: 1074.96px;"> </th>
</tr>
<tr style="height: 119px;">
<td style="height: 119px; width: 108.429px;"><em>Описание</em></td>
<td style="height: 119px; width: 1074.96px;">
<p>Запрос должен начинаться с предложения <code>from</code>. Предложение <code>from</code> состоит из следующих частей: </p>
<ul>
<li>оператор <code>from</code>;</li>
<li>локальная переменная, которая представляет отдельные элементы источника данных (например, запись в шаблоне или аккаунт);</li>
<li>оператор <code>in</code>;</li>
<li>источник данных, по которому выполняется запрос.</li>
</ul>
</td>
</tr>
<tr style="height: 40px;">
<td style="height: 40px; width: 108.429px;"><em>Синтаксис</em></td>
<td style="height: 40px; width: 1074.96px;">
<p><code style="letter-spacing: 0.2px; background-color: #ffffff;">from переменная in источник_данных</code></p>
</td>
</tr>
<tr style="height: 65px;">
<td style="height: 65px; width: 108.429px;"><em>Аргументы</em></td>
<td style="height: 65px; width: 1074.96px;">
<p><a id="local_variable"></a><code>переменная</code>: имя локальной переменной</p>
<p><code>источник_данных</code>:</p>
<ul>
<li><code>db-&gt;имя_шаблона</code>: шаблон записи, шаблон аккаунта;</li>
<li><code>$путь-&gt;к-&gt;атрибуту</code>: атрибут шаблона;</li>
<li><code>from переменная2 in источник_данных2 where условие2 select атрибут2</code>: подзапрос;<code></code></li>
</ul>
</td>
</tr>
<tr style="height: 40px;">
<th style="height: 40px; width: 108.429px;">where</th>
<th style="height: 40px; width: 1074.96px;"> </th>
</tr>
<tr style="height: 90px;">
<td style="height: 90px; width: 108.429px;"><em>Описание</em></td>
<td style="height: 90px; width: 1074.96px;">Предложение  <code>where</code> задаёт условие выборки элементов в источнике данных. Условие может содержать несколько предикатов, возвращающих <code>true</code> или <code>false</code>. В условие можно включить несколько предикатов с помощью логических операторов <code>&amp;&amp;</code> (И), <code> ||</code> (ИЛИ), <code> ==</code> (РАВНО), <code> !=</code> (НЕ РАВНО) и функций <code>AND()</code>, <code>OR()</code>, <code>EQUALS()</code>, <code>IF()</code>, <code>NOT()</code>, <code>ANY()</code>, <code>ALL()</code>.</td>
</tr>
<tr style="height: 40px;">
<td style="height: 40px; width: 108.429px;"><em>Синтаксис</em></td>
<td style="height: 40px; width: 1074.96px;"><code>where условие</code></td>
</tr>
<tr style="height: 40px;">
<td style="height: 40px; width: 108.429px;"><em>Аргументы</em></td>
<td style="height: 40px; width: 1074.96px;"><code>условие</code>: значение логического типа или выражение, возвращающее <code>true</code> или <code>false</code>. </td>
</tr>
<tr style="height: 40px;">
<th style="height: 40px; width: 108.429px;">orderby</th>
<th style="height: 40px; width: 1074.96px;"> </th>
</tr>
<tr style="height: 41px;">
<td style="height: 41px; width: 108.429px;"><em>Описание</em></td>
<td style="height: 41px; width: 1074.96px;">
<p>Предложение <code>orderby</code> позволяет отсортировать результаты запроса по значению атрибута искомых объектов. Предложение <code>orderby</code> следует использовать между предложениями <code>where</code> и <code>select</code>. Предложение <code>orderby</code> состоит из следующих частей:</p>
<ul>
<li>оператор  <code>orderby</code>;</li>
<li>атрибут объекта, по которому следует выполнять сортировку результатов запроса;</li>
<li>оператор порядка сортировки — <code>ascending</code> по возрастанию (по умолчанию, можно не указывать) или <code>descending</code> — по убыванию.<code></code></li>
</ul>
</td>
</tr>
<tr style="height: 115px;">
<td style="height: 115px; width: 108.429px;"><em> Синтаксис</em></td>
<td style="height: 115px; width: 1074.96px;">
<ul>
<li>Сортировка по возрастанию: <br/><code>orderby атрибут_объекта ascending<br/></code>или<br/><code>orderby атрибут_объекта</code></li>
<li>Сортировка по убыванию: <br/><code>orderby атрибут_объекта descending</code> <br/><code></code></li>
</ul>
</td>
</tr>
<tr style="height: 40px;">
<td style="height: 40px; width: 108.429px;"><em>Аргументы</em></td>
<td style="height: 40px; width: 1074.96px;"><code>атрибут_объекта</code>: атрибут шаблона или иного объекта.</td>
</tr>
<tr style="height: 40px;">
<th style="height: 40px; width: 108.429px;">select</th>
<th style="height: 40px; width: 1074.96px;"> </th>
</tr>
<tr style="height: 65px;">
<td style="height: 65px; width: 108.429px;"><em>Описание</em></td>
<td style="height: 65px; width: 1074.96px;">Предложение <code>select</code> задаёт, атрибут объекта, значения которого вернёт запрос. В конечном результате учитываются как работа предыдущих операторов, так и любые выражения в самом операторе <code>select</code>.</td>
</tr>
<tr style="height: 40px;">
<td style="height: 40px; width: 108.429px;"><em>Синтаксис</em></td>
<td style="height: 40px; width: 1074.96px;"><code>select атрибут_объекта </code></td>
</tr>
<tr style="height: 40px;">
<td style="height: 40px; width: 108.429px;"><em>Аргументы</em></td>
<td style="height: 40px; width: 1074.96px;"><code>атрибут_объекта</code>: атрибут шаблона или иного объекта. </td>
</tr>
</tbody>
</table>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<ul>
<li>Следующие слова нельзя использовать в запросе в качестве <a href="#local_variable">локальной переменной</a>, так как они зарезервированы как системные:
<ul>
<li><code>and</code>, <code>ascending</code>, <code>between</code>, <code>by</code>, <code>db</code>, <code>descending</code>, <code>equals</code>, <code>from</code>, <code>group</code>, <code>in</code>, <code>into</code>, <code>item</code>, <code>join</code>, <code>let</code>, <code>on</code>, <code>orderby</code>, <code>select</code>, <code>source</code>, <code>where</code><code></code></li>
<li>слова, начинающиеся с подчеркивания (<code><strong>_</strong></code>)</li>
<li>имена <a href="https://kb.comindware.ru/article.php?id=1861">функций</a> и <a href="https://kb.comindware.ru/article.php?id=1862">литералы</a></li>
</ul>
</li>
<li><a href="#from_clause">Предложение <code>from</code> </a>может содержать подзапросы (также начинающиеся с <code>from</code>).</li>
</ul>
</div>
<h2 id="mcetoc_1h0ftuuq00">Примеры запросов</h2>
<ul>
<li>Запрос записей районов Москвы с сортировкой по убыванию названия района.
<pre><code>from a in db-&gt;Cities <br/>where a-&gt;CityName == "Москва" <br/>orderby a-&gt;Districts-&gt;DistrictName descending <br/>select a-&gt;Districts</code></pre>
</li>
<li> Запрос названий и авторов книг, у которых указан автор, с сортировкой по возрастанию имени автора и выводом в формате «<em>Название: название книги. Автор: имя автора</em>».
<pre><code>from book in db-&gt;Books <br/>where NOT(EMPTY(book-&gt;Author)) <br/>orderby book-&gt;Author-&gt;Name <br/>select CONCAT(LIST('Название: ', book-&gt;Name, '. Автор: ', book-&gt;Author-&gt;Name))</code></pre>
</li>
</ul>