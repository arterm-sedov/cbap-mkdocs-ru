<h1>Отмена процесса по кнопке. Настройка шаблонов, процессов и кнопки</h1><p>Процессы зачастую имеют несколько вариантов завершения. Например, заявка может быть согласована и не согласована. Бывают также случаи, когда нужно отменить процесс извне, например, если инициатор хочет отозвать договор, который уже был отправлен на согласование. В данном случае будет удобно создать отдельную кнопку, по которой процесс может быть отменен, вне зависимости от того, на каком шаге он находится.</p>
<p><strong>Сценарий: </strong>Процесс «<em>Согласование договора</em>». Инициатор решает, что договор больше неактуален и хочет отменить согласование. </p>
<p><strong>Описание: </strong>Реализовывать данную настройку мы будем, основываясь на межпроцессном взаимодействии.</p>
<p> </p>
<p><strong>Настройка:</strong></p>
<p><strong>1.</strong> В шаблоне записи, связанном с основным процессом «<em>Согласование договора</em>», создайте атрибут <em><strong>$processid</strong></em>.</p>
<p><strong>2.</strong> Перейдите в сценарий на выходе из стартового события на диаграмме процесса «<em>Согласование договора</em>» и добавьте действие «Изменить значения атрибутов», где заполните атрибут, созданный в п.1, следующим выражением: <em><strong>FORMAT("{0}", LIST($$ProcessObject))</strong></em>.</p>
<p><strong>3.</strong> На этой же диаграмме процесса сразу после стартового события поставьте развилку «и». Один поток пойдёт по вашему настроенному процессу, а другой — в промежуточное событие–получение сообщения. В настройках события укажите имя сообщения (должно быть уникальным между отправляющим и получающим событиями), и настройте соответствие атрибутов, если нужно.</p>
<div class="screenshot_with_caption">
<p><img alt="Настройка основного процесса" class="img-responsive" height="392" src="https://kb.comindware.ru/assets/cancel101.png" width="758"/></p>
<p class="caption">Настройка основного процесса</p>
</div>
<div class="blue_note"><strong>Примечание :</strong> важно, чтобы все выходы из процесса в данном случае были терминаторами, чтобы останавливался весь процесс, а не одна его ветка.</div>
<p>Таким образом, при запуске процесса будут активны оба потока и процесс завершится либо по настроенной логике (например, договор не согласован), либо если в событие–получение сообщения придет сообщение об отмене.</p>
<p><strong>4.</strong> Создайте технический процесс «<em>Отмена договора</em>» с новым шаблоном записи (например, «<em>Отмены договоров</em>»). В новом шаблоне создайте необходимые атрибуты: ссылка на шаблон записи, связанный с основным процессом (с обратной связью) и, например, комментарий, который будет заполняться на стартовой форме.</p>
<div class="screenshot_with_caption">
<p><img align="" alt="Настройка технического процесса" class="img-responsive" height="456" src="https://kb.comindware.ru/assets/cancel2.png" width="1274"/></p>
<p class="caption">Настройка технического процесса</p>
</div>
<p>В настройках события–отправки сообщения укажите имя сообщения (как в п.3) и экземпляр процесса по типу: <em><strong>$Dogovor-&gt; processid</strong></em>, где <em><strong>$Dogovor</strong></em> — ссылка на шаблон записи, связанный с основным процессом, <em><strong>processid</strong></em> — атрибут, созданный в п.1, хранящий информацию об экземпляре запущенного процесса. Если необходимо, настройте соответствие атрибутов и стартовую форму.</p>
<p><strong>5.</strong> В шаблоне записи, связанном с основным процессом, создайте новую кнопку «<em>Отменить договор</em>»:</p>
<ul>
<li>Контекст операции — Запись;</li>
<li>Операция — Запустить процесс по связанному шаблону;</li>
<li>Результат выполнения — Обновить данные;</li>
<li>Шаблон — Отмена договора (атрибут: ссылка на основной шаблон записи).</li>
</ul>
<p>Если нужно, настройте условие отображения кнопки.</p>
<p><strong>6.</strong> Вынесите кнопку на область кнопок для таблиц, формы, или на саму форму.</p>
<p><strong>7.</strong> Протестируйте.</p>