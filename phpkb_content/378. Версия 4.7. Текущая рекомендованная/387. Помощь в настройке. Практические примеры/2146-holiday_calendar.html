<h1>Календарь праздников. Настройка и использование</h1><p>Для контроля сроков исполнения задач, назначаемых на пользователей, в <strong>Comindware Business Application Platform</strong> существует встроенный функционал, который позволяет в настройках задачи указать количество времени, вплоть до секунд, за которое пользователь должен её выполнить. Но бывают случаи, когда сроки, в которые должна быть выполнена задача необходимо установить с учётом рабочих дней.</p>
<p><span style="color: #000000;">Для этого существуют функции <em><strong>WORKDAYS() </strong></em>и <em><strong>WORKHOURS()</strong></em>, которые возвращают дату на основании количества рабочих дней или часов с определенной даты. </span><span style="color: #000000;">Однако, у этих функций есть ограничение: они учитывают только выходные и не учитывают праздничные дни. Поэтому в данных функциях есть возможность прописать список дат, которые являются нерабочими. Чтобы не прописывать все праздничные даты внутри функции, рекомендуем создать отдельный справочник с календарем выходных и праздничных дней, и при написании выражения с <em><strong>WORKDAYS() </strong></em>и <em><strong>WORKHOURS() </strong></em>ссылаться на него. </span></p>
<p><span style="color: #000000;"><strong>1.</strong> Создайте шаблон записи «<em>Календарь выходных и праздничных дней</em>».</span></p>
<p><span style="color: #000000;"><strong>2.</strong> Создайте атрибут с типом данных «Дата и время» и назовите его «<em>Дата</em>».</span></p>
<p><span style="color: #000000;"><strong>3.</strong> Настройте форму и таблицу, вынеся на них созданный атрибут. </span></p>
<p><span style="color: #000000;"><strong>4.</strong> Заполните шаблон записи. Перейдите на таблицу, нажмите кнопку «<strong><em>Создать</em></strong>» и в поле «<em>Дата</em>» выберите один из праздничных дней, например, 1 января текущего года. </span></p>
<p><span style="color: #000000;"><strong>5.</strong> Далее аналогично создайте записи под все праздничные дни, которые есть в текущем году (для последующих лет также нужно будет создать отдельные записи в справочнике).</span></p>
<p><strong>6.</strong> <span style="color: #000000;">Перейдите в настройки задачи, на которой необходимо установить срок выполнения с учетом рабочих дней. Перейдите на вкладку «<em><strong>Дополнительные</strong></em>», затем выберите в поле «<em><strong>Продолжительность выполнения</strong></em>» вариант «<em>Формула</em>», затем вставьте следующее:</span></p>
<div>
<table class="source_code_container">
<tbody>
<tr>
<td class="source_code"><span style="color: #000000;">WORKHOURS(NOW(),18,DURATION("PT9H"),DURATION("PT9H"),LIST((from a in db-&gt;holliday_calendar select a-&gt;Data)))</span></td>
</tr>
</tbody>
</table>
</div>
<p><strong><span style="color: #000000;">где:</span></strong></p>
<p><span style="color: #000000;"><em><strong>holiday_calendar</strong></em> — системное имя шаблона записи, созданного в п.1;</span></p>
<p><span style="color: #000000;"><em><strong>Data</strong> </em>— системное имя атрибута, созданного в п.2.</span></p>
<p><span style="color: #000000;">Данная формула расшифровывается следующим образом: начиная с текущего момента (когда процесс создал задачу), отсчитай 18 рабочих часов (продолжительность выполнения задачи), учитывая, что рабочий день стартует в 9 часов утра и длится 9 часов, и учитывая все исключения, указанные в календаре праздников.</span></p>
<p><span style="color: #000000;">Т.е. если задача будет создана 22 февраля 2023 года в 09:00, то с учетом календаря праздников и выражения, которое указано в настройках задачи, крайний срок выполнения задачи будет указан 27 февраля 2023 года в 18:00.</span></p>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<ul>
<li>Продолжительность рабочего дня, то есть сумма третьего и четвёртого аргументов функции <code>WORKHOURS()</code>, не может превышать 24 часа</li>
<li><span style="color: #000000;">Если в календарь праздников добавить выходной день (субботу или воскресенье), то при вычислении выражения он будет рассматриваться как рабочий.</span></li>
</ul>
</div>