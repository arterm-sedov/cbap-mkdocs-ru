<h1>Синхронизация с веб-сервисом. Интеграция по OData</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1gmddfchi0">Настройка интеграции с внешним сервисом посредством OData</a>
<ul>
<li><a href="#mcetoc_1hos7vpp62">Настройка синхронизации</a></li>
<li><a href="#mcetoc_1hos7tgdn1">Настройка импорта данных</a>
<ul>
<li><a href="#mcetoc_1hos83r2d3">Настройка постпроцессинга</a></li>
</ul>
</li>
<li><a href="#mcetoc_1hos7sscg0">Настройка экспорта данных</a></li>
</ul>
</li>
<li><a href="#mcetoc_1gmdebhg01">Запуск синхронизации посредством интеграции</a></li>
<li><a href="#mcetoc_1gmdefqh72">Журналирование интеграции</a>
<ul>
<li><a href="#mcetoc_1gmdeg6873">Журнал событий</a></li>
<li><a href="#mcetoc_1gmdej1ta4">Сведения в журнале «Интеграция по OData»</a></li>
<li><a href="#mcetoc_1gmdejpn25">Файловый журнал</a></li>
</ul>
</li>
<li><a href="#mcetoc_1hd6mapv91">Связанные статьи</a></li>
</ul>
</div>
<h2 id="mcetoc_1gmddfchi0">Настройка интеграции с внешним сервисом посредством OData</h2>
<p><strong>Comindware Business Application Platform</strong> поддерживает автоматический и ручной импорт и экспорт данных посредством подключения к внешнему OData-сервису.</p>
<p>Подробные сведения о формате данных OData см. в статье «<a href="https://www.odata.org/documentation/odata-version-2-0/uri-conventions/"><strong>URI Conventions (OData Version 2.0)</strong></a>» (официальное руководство по OData, английский язык).</p>
<ol class="colored_numbers_list">
<li>
<p>Настройте <a href="https://kb.comindware.ru/article.php?id=2504">подключение к OData-сервису</a>.</p>
<div class="notice notice-success">
<p class="admonition-title">Совет</p>
<p>Для экспериментов с синхронизацией по OData при настройке подключения можно указать общедоступный сервер, предоставляемый OData.org.</p>
<p>Например, для тестирования импорта данных можно использовать следующий сервер:</p>
<p><a href="https://services.odata.org/V3/OData/OData.svc/">https://services.odata.org/V3/OData/OData.svc/</a></p>
</div>
</li>
<li>
<p>Откройте приложение из списка приложений.</p>
</li>
<li>
<p>На странице «<strong>Администрирование</strong>» приложения выберите пункт «<strong>Интеграции</strong>».</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Переход к разделу «Интеграции» приложения" class="img-responsive" height="254" src="https://kb.comindware.ru/assets/img_63bd250182d22.png" width="1191"/></p>
<p class="caption" style="font-size: 15px !important;">Переход к разделу «Интеграции» приложения</p>
</div>
</li>
<li>
<p>В списке <span style="font-size: 12.0pt; font-family: 'Arial',sans-serif;">интеграций </span>нажмите кнопку «<strong>Создать</strong>».</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Создание конфигурации интеграции" class="img-responsive" height="203" src="https://kb.comindware.ru/assets/img_63bd25466f414.png" width="1191"/></p>
<p class="caption" style="font-size: 15px !important;">Создание конфигурации интеграции</p>
</div>
</li>
<li>
<p>Настройте новую конфигурацию интеграции.</p>
</li>
</ol>
<h3 id="mcetoc_1hos7vpp62">Настройка синхронизации</h3>
<p>Настройте параметры на вкладке «<strong>Основные свойства</strong>».</p>
<ul>
<li><strong>Включить</strong> — установите этот флажок, чтобы задействовать данную конфигурацию интеграции.</li>
<li><strong>Название</strong> — введите наглядное название конфигурации интеграции.</li>
<li><strong>Подключение по OData</strong> — выберите ранее созданное подключение к OData-сервису.</li>
<li><strong>Тип</strong> — выберите направление синхронизации данных:
<ul style="list-style-type: circle;">
<li><strong>Импорт </strong>— передача данных из OData-сервиса в приложение;</li>
<li><strong>Экспорт </strong>— передача данных из приложения в OData-сервис.</li>
</ul>
</li>
<li><strong>Шаблон записи</strong> — выберите шаблон, с которым будут синхронизироваться данные.</li>
<li><strong>Внешняя сущность</strong> — укажите таблицу (набор данных) в OData-сервисе, с которой будут синхронизироваться данные.</li>
<li><span style="letter-spacing: 0.2px;"><strong>Синхронизируемые объекты</strong> — выберите, следует ли импортировать все данные или только изменённые:</span> <br/>
<ul style="list-style-type: circle;">
<li><strong>Все</strong>;</li>
<li><strong>По изменению полей объекта</strong>.</li>
</ul>
</li>
<li><strong>Режим запуска </strong>— выберите способ запуска синхронизации:
<ul style="list-style-type: circle;">
<li><strong>Вручную </strong>— для <a href="#mcetoc_1gmdebhg01">запуска синхронизации</a> потребуется выбрать интеграцию в списке и нажать кнопку «<strong>Запустить синхронизацию</strong>».</li>
<li><strong>По расписанию </strong>— настройте расписание автоматической синхронизации:
<ul style="list-style-type: circle;">
<li><strong>Первый запуск</strong>;</li>
<li><strong>Периодичность</strong>;</li>
<li><strong>Дни запуска</strong>;</li>
<li><strong>Интервал запуска</strong>.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Сопоставление данных</strong> — задайте соответствие атрибутов <strong>внешней сущности</strong> и атрибутов <strong>шаблона записи </strong>и укажите <strong>ключевой атрибут</strong>. 
<div class="notice notice-warning">
<p class="admonition-title">Принцип сопоставления записей по ключевым атрибутам</p>
<p>Для синхронизации необходимо выбрать пару ключевых атрибутов, содержащих уникальные значения, по которым будут сопоставляться синхронизируемые записи. </p>
<p>Если при синхронизации совпадут значения ключевых атрибутов в записи в выбранном шаблоне и во внешней сущности, то:</p>
<ul>
<li>при импорте запись в шаблоне будет обновлена данными из внешней сущности;</li>
<li>при экспорте запись во внешней сущности будет обновлена данными из шаблона;</li>
</ul>
<p>Если при синхронизации значения ключевых атрибутов не совпадут, будет создана новая запись:</p>
<ul>
<li>в выбранном шаблоне — при импорте;</li>
<li>во внешней сущности — при экспорте.</li>
</ul>
</div>
<ul>
<li>В столбце «<strong>Внешний атрибут</strong>» квадратных скобках указаны свойства атрибутов:
<ul>
<li><strong>[Primary key]</strong> — первичный ключ, по умолчанию выбран в качестве <strong>ключевого атрибута</strong>;</li>
<li><strong>[Not null]</strong> — атрибуты, которые не могут быть пустыми (при экспорте данных необходимо установить соответствие всех внешних и внутренних атрибутов с данным свойством).</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Настройка свойств интеграции" class="img-responsive" height="796" src="https://kb.comindware.ru/assets/img_65368fae9b021.png" width="600"/></p>
<p class="caption" style="font-size: 15px !important;">Настройка свойств интеграции</p>
</div>
<h3 id="mcetoc_1hos7tgdn1">Настройка импорта данных</h3>
<p>Если на вкладке «<strong>Основные свойства</strong>» выбран импорт данных, настройте параметры на вкладке «<strong>Настройки импорта</strong>»:</p>
<ul>
<li><strong>Зависит от</strong> — укажите интеграцию, синхронизацию по которой необходимо запускать перед запуском синхронизации по данной интеграции. Это может быть необходимо, например, для того, чтобы предварительно обновить данные в связанных шаблонах, к которым требуется привязать синхронизируемые записи.</li>
<li><strong>Фильтр</strong> — задайте фильтр данных посредством выражений OData. Синтаксис фильтров см. в статье <em>«<a href="https://msdn.microsoft.com/ru-ru/library/hh169248(v=nav.90).aspx">Using Filter Expressions in OData URIs</a></em><span style="letter-spacing: 0.2px;"><span style="letter-spacing: 0.2px;"><em>»</em> (учебник Microsoft, английский язык). Например, следующий фильтр выбирает записи с порядковым номером (<code>SequenceNumber</code>) от 11 до 14:</span> </span>
<pre class="has-inner-focus" style="box-sizing: inherit; outline-color: inherit; font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; font-size: 14px; margin: 0px; padding: 1rem; -webkit-font-smoothing: auto; border: .125rem solid var(--theme-border); background-color: var(--theme-code-block); white-space: pre; word-spacing: 0px; word-break: normal; overflow-wrap: normal; tab-size: 4; hyphens: none; line-height: 1.3571; overflow: auto; color: #161616; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><code data-author-content="filter=Entry_No gt 610 and Entry_No lt 615" style="box-sizing: inherit; outline-color: inherit; font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 1em; direction: ltr; border: 0px; padding: 0px; line-height: 1.3571; display: block; position: relative;">filter=SequenceNumber gt 10 and SequenceNumber lt 15</code></pre>
</li>
<li><strong>Количество объектов в одном запросе</strong> — укажите максимальное количество данных, передаваемых в одном запросе. При превышении этого количества будет формироваться новый запрос к внешнему сервису.</li>
<li><strong>Сортировка</strong> — укажите атрибуты и порядок сортировки записей по ним. Выборка импортируемых записей будет выполняться</li>
<li><strong>Динамический фильтр</strong> — настройте фильтрацию данных по времени, указав атрибут типа «Дата и время», значение которого будет проверяться на соответствие указанному интервалу фильтра.</li>
<li><strong>Интервал фильтра</strong> — интервал времени, который будет отсчитываться от даты запуска синхронизации.</li>
<li><strong>Удалить несуществующие записи</strong> — установите этот флажок, чтобы при синхронизации удалять записи, которые отсутствуют на внешнем сервере.</li>
<li><strong>Удалить по условию</strong> — укажите атрибуты и значения, чтобы при синхронизации удалять записи, соответствующие заданным условиям.</li>
</ul>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Настройки импорта данных из OData-сервиса" class="img-responsive" height="683" src="https://kb.comindware.ru/assets/img_63bd26be12c76.png" width="754"/></p>
<p class="caption" style="font-size: 15px !important;">Настройки импорта данных из OData-сервиса</p>
</div>
<h4 id="mcetoc_1hos83r2d3">Настройка постпроцессинга</h4>
<div class="notice notice-warning">
<p class="admonition-title">Логика постпроцессинга</p>
<p>Постпроцессинг позволяет привязать импортируемые записи к имеющимся записям в связанном шаблоне.</p>
<p>В таблице «<strong>Преобразование атрибутов</strong>» необходимо выбрать ключевые атрибуты связанных шаблонов записи, содержащие уникальные идентификаторы записей, которые требуется связать между собой посредством <strong>целевого атрибута</strong>.</p>
<p>Эти значения будут сравниваться при импорте записей. Если значения ключевых атрибутов в импортируемой записи и в имеющейся записи связанного шаблона совпадут, то эти записи будут связаны посредством выбранного <strong>целевого атрибута</strong>.</p>
</div>
<ol class="colored_numbers_list">
<li>Нажмите кнопку «<strong>Добавить новую настройку постпроцессинга</strong>».</li>
<li>
<p>Настройте сопоставление атрибутов между шаблоном записи и OData-сервисом:</p>
<ul>
<li><strong>Целевой атрибут</strong> — выберите атрибут типа «<strong>Запись</strong>», связанный с <strong>шаблоном записи</strong>, выбранным на вкладке «<strong>Основные свойства</strong>».</li>
<li><strong>Атрибут в выбранном шаблоне</strong> — выберите ключевой атрибут в <strong>шаблоне записи</strong>, выбранным на вкладке «<strong>Основные свойства</strong>» для синхронизации.</li>
<li><strong>Атрибут в связанном шаблоне</strong> — выберите ключевой атрибут шаблона, связанного с <strong>целевым атрибутом</strong>.</li>
</ul>
</li>
</ol>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Настройка постпроцессинга" class="img-responsive" height="347" src="https://kb.comindware.ru/assets/img_63bd27eda6fb4.png" width="717"/></p>
<p class="caption" style="font-size: 15px !important;">Настройка постпроцессинга</p>
</div>
<h3 id="mcetoc_1hos7sscg0">Настройка экспорта данных</h3>
<p>Если на вкладке «<strong>Основные свойства</strong>» выбран экспорт данных, настройте параметры на вкладке «<strong>Настройки экспорта</strong>»:</p>
<ul>
<li><strong>Удалить записи после экспорта</strong> — установите этот флажок, чтобы при синхронизации удалять экспортированные записи.</li>
<li><strong>Экспортировать архивные записи</strong> — установите этот флажок, чтобы при синхронизации экспортировать архивные записи.</li>
<li><strong>Фильтр</strong> — укажите атрибуты и значения, чтобы при синхронизации экспортировать только записи, соответствующие заданному фильтру.</li>
</ul>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Настройка экспорта" class="img-responsive" height="272" src="https://kb.comindware.ru/assets/img_63bd28330af91.png" width="752"/></p>
<p class="caption" style="font-size: 15px !important;">Настройка экспорта</p>
</div>
<h2 id="mcetoc_1gmdebhg01">Запуск синхронизации посредством интеграции</h2>
<ol class="colored_numbers_list">
<li><span style="letter-spacing: 0.2px;">Установите один или несколько флажков в списке интеграций</span>.</li>
<li>Нажмите кнопку «<strong>Запустить синхронизацию</strong>».</li>
<li>Будет запущена синхронизация посредством выбранных интеграций.</li>
<li>Результаты синхронизации можно просмотреть в журналах интеграции.</li>
</ol>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Запуск синхронизации" class="img-responsive" height="287" src="https://kb.comindware.ru/assets/img_63bd28a961d97.png" width="1173"/></p>
<p class="caption" style="font-size: 15px !important;">Запуск синхронизации</p>
</div>
<h2 id="mcetoc_1gmdefqh72">Журналирование интеграции</h2>
<h3 id="mcetoc_1gmdeg6873">Журнал событий</h3>
<p>Журнал сеансов синхронизации посредством интеграций отображается на вкладке «<strong>Интеграция по OData</strong>» в разделе «<strong>Администрирование</strong>» — «<strong>Инфраструктура</strong>» — «<strong>Журналы событий</strong>».</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Журнал сеансов синхронизации данных по OData" class="img-responsive" height="217" src="https://kb.comindware.ru/assets/img_63bd292283c00.png" width="982"/></p>
<p class="caption" style="font-size: 15px !important;">Журнал сеансов синхронизации данных по OData</p>
</div>
<h3 id="mcetoc_1gmdej1ta4">Сведения в журнале «Интеграция по OData»</h3>
<ul>
<li><strong>Без ошибок</strong> — в этом столбце отображается флажок, если синхронизация выполнена без ошибок.</li>
<li><strong>Сеанс</strong> — идентификатор сеанса синхронизации.</li>
<li><strong>Событие</strong> — описание события синхронизации. Для просмотра цепочки событий, приведших к событию в журнале, дважды нажмите строку в журнале.</li>
<li><strong>Дата</strong> — дата запуска синхронизации.</li>
<li><strong>Подключение</strong> — подключение, использованное для синхронизации. Перейдите по этой гиперссылке для просмотра свойств подключения.</li>
<li><strong>Конфигурация</strong> — идентификатор конфигурации интеграции. Перейдите по этой гиперссылке для просмотра свойств интеграции.</li>
<li><strong>Инициатор</strong> — аккаунт, запустивший синхронизацию. Перейдите по этой гиперссылке для просмотра свойств аккаунта.</li>
</ul>
<h3 id="mcetoc_1gmdejpn25">Файловый журнал</h3>
<p>При синхронизации посредством интеграции соответствующие события записываются в файл журнала с именем вида: <code>integration_raw_ГГГГ-ММ-ЧЧ.log</code>.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Файл integration_raw_ГГГГ-ММ-ЧЧ.log в папке журналов" class="img-responsive" height="133" src="https://kb.comindware.ru/assets/img_63bd29914dfe7.png" width="634"/></p>
<p class="caption" style="font-size: 15px !important;">Файл integration_raw_ГГГГ-ММ-ЧЧ.log в папке журналов</p>
</div>
<p>При успешной синхронизации в этом файле будут указаны все синхронизированные объекты. При сбое синхронизации в файл записывается ИД записи, на которой была обнаружена ошибка, и описание ошибки.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Содержимое файла integration_raw.log" class="img-responsive" height="566" src="https://kb.comindware.ru/assets/img_63bd29e26c4ce.png" width="1053"/></p>
<p class="caption" style="font-size: 15px !important;">Содержимое файла integration_raw.log</p>
</div>
<h2 id="mcetoc_1hd6mapv91">Связанные статьи</h2>
<p class="caption" style="font-size: 15px !important;"><strong><samp data-name="aid" data-title="" data-value="2504"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Подключение для синхронизации с веб-сервисом {Article-ID:2504}</span></samp> </strong></p>
<p class="caption" style="font-size: 15px !important;"><strong><a href="https://kb.comindware.ru/article.php?id=2180#mcetoc_1gjriatef8">Журнал сеансов синхронизации по OData</a></strong></p>
<p class="caption" style="font-size: 15px !important;"><strong><samp data-name="aid" data-title="" data-value="2011"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Пример интеграции с 1С {Article-ID:2011}</span></samp> </strong></p>