---
title: Отправка уведомлений с помощью Telegram. Пример: настройка подключения, пути передачи данных, сценария, приложения и Telegram-бота
kbId: 2610
---

# Отправка уведомлений с помощью Telegram. Пример: настройка подключения, пути передачи данных, сценария, приложения и Telegram-бота

## Введение

В этой статье представлен пример настройки **{{ productName }}** для отправки пользователю сообщений в Telegram.

## Прикладная задача

Требуется отправлять пользователю сообщение в Telegram с текстом из поля *«Сообщение»* на форме по нажатию кнопки *«Отправить в Telegram»*.

## Настройка приложения

1. Создайте приложение *«Интеграция с Telegram».*
2. Создайте шаблон записи *«Уведомления»*в приложении *«Интеграция с Telegram»**.*
3. Создайте атрибуты *«ID чата»* и *«Сообщение»* типа «**Текст**» в шаблоне *«Уведомления»*.
4. Создайте в шаблоне *«Уведомления»* кнопку *«Отправить в Telegram»* со следующими свойствами:
    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**
5. Поместите на основную форму шаблона *«Уведомления»* атрибуты *«ID чата»* и *«Сообщение»* и кнопку *«Отправить в Telegram».*

## Инициализация бота в Telegram

1. В мессенджере Telegram откройте чат **[@BotFather](https://t.me/BotFather "Открыть чат @BotFather")**
2. В чате введите команду `/start`
3. Введите команду `/new bot`
4. Введите имя нового бота. Имя бота должно заканчиваться на слово `bot`, например: `example_bot`
5. В чате отобразится сообщение со ссылкой на чат с ботом (например, `t.me/example_bot`) и токеном бота вида `XXXX:XXXXX`
6. Запишите токен бота.
7. Перейдите в чат созданного бота, введите команду `/start` и любое сообщение, чтобы активировать его.
8. В адресную строку браузера введите строку `https://api.telegram.org/bot<Токен:бота>/getUpdates`, заменив `<Токен:бота>` на фактический токен вашего бота.
9. В браузере отобразится сообщение вида:

```
{"ok":true,"result":[{"update_id":XXXXXXXX, "message":{"message_id":4,"from":{"id":1234567890,"is_bot":false,"first_name":"User Name","username":"username","language_code":"en"},"chat":{"id":1234567890,"first_name":"User Name","username":"username","type":"private"},"date":1717687196,"text":"chatid"}}]}
```
10. Найдите в этом сообщении идентификатор чата вида `"from":{"id":1234567890` или `"chat":{"id":1234567890`, где цифры — это идентификатор чата вашего бота.
11. Настройте подключение к Telegram с использованием полученных ключа и ID чата.

## Настройка подключения к Telegram и пути передачи данных

1. Откройте страницу «**Администрирование**» – «**Инфраструктура**» – «**Подключения**».
2. В меню «**Создать**» выберите пункт «**Подключения REST и OData**» – «**Отправка HTTP-запросов**».
3. Настройте подключение следующим образом:
    - **Системное имя:** *telegram\_send\_connection*
    - **Описание:***Подключение к Telegram*
    - **URI**: `https://api.telegram.org/bot<Токен:бота>`
        - Замените `<Токен:бота>` на токен своего Telegram-бота
    - **Формат данных**: **JSON**
    - **Кодировка данных:** **UTF-8**
    - **Тип аутентификации: отсутствует**
    - Остальные свойства оставьте без изменений.
4. Откройте приложение *«Интеграция с Telegram».*
5. На странице администрирования приложения выберите пункт «**Пути передачи данных**».
6. В списке путей передачи данных в меню «**Создать**» выберите пункт «**Подключения REST и OData**» – «**Отправка HTTP-запросов**».
7. Настройте путь передачи данных следующим образом:
    - **Основные свойства**
        - **Подключение:***Подключение к Telegram*
        - **Системное имя:** *telegram\_send\_route*
        - **Описание:** *Передача данных в Telegram*
    - **Атрибуты сообщений**
        - **Тип сообщения: отправка HTTP-запросов**
        - ****Запрос****
        
        
        
        | Системное имя | Тип |
        | --- | --- |
        | *chat\_id* | **Строка** |
        | *text* | **Строка** |
        - **Ответ:** оставьте таблицу пустой
        - **Ответ с ошибкой:**оставьте таблицу пустой
    - **Интеграция**
        - **Метод запроса: POST**
        - **Шаблон пути запроса:** `sendMessage
        sendMessage` — это метод API Telegram для отправки сообщений боту.
        - **Атрибуты для сериализации в тело запроса:** `chat_id,message`В этом поле перечислите через запятую атрибуты из таблицы «**Запрос**» с вкладки «**Атрибуты сообщений**».
        Имена этих атрибутов предопределены спецификацией API Telegram.
        - **Укажите атрибуты для сериализации ответа без ошибки** и ****ответа с ошибкой****
        
        
        
        | Путь к атрибуту | Выражение на языке запросов |
        | --- | --- |
        | `$` | `$` |
        
        
        
        Примечание
        
        
        Символ доллара `$` атрибутах для сериализации ответов означает передачу всех данных ответа в переменные для успешного ответа и ответа с ошибкой, указанные в [действии «**Отправить сообщение**» в сценарии](#send_message_action).
    - Остальные свойства оставьте без изменений.

## Настройка сценария

1. В приложении *«Интеграция с Telegram»*создайте сценарий *«Отправка уведомления»*, выбрав **контекст выполнения** « **От имени системы**»*.*
2. В конструкторе сценария настройте событие *«Нажатие кнопки»* следующим образом:
    - **Контекстный шаблон:** *Уведомления*
    - **Кнопка:***Отправить в Telegram*
3. Добавьте и настройте действие «**Изменить значения переменных**»:
    - **Операция со значениями переменных:** заменить
    - **Набор переменных:** body
    - **Таблица переменных**
    
    
    
    | Имя переменной | Значение |
    | --- | --- |
    | *text* | **Атрибут:** *Сообщение* |
    | *chat\_id* | **Атрибут:** *ID чата* |
4. Добавьте и настройте действие «**Отправить сообщение**»:
    - **Подключение:** *telegram\_send\_connection*
    - **Путь передачи данных:** *telegram\_send\_route*
    - **Переменная с сообщением:** *body*
    - **Переменная для успешного ответа:** *response*
    - **Переменная для ответа с ошибкой:** *error\_response*

## Тестирование бота

1. Создайте запись в шаблоне *«Уведомления».*
2. В поле *«ID чата»* введите [ID чата своего бота](#chat_id).
3. В поле *«Сообщение»* введите любой текст.
4. Сохраните запись.
5. Нажмите кнопку *«Отправить в Telegram».*
6. В чате вашего бота должно прийти сообщение, отправленное с формы.

--8<-- "related_topics_heading.md"

**[Шаблоны. Определения, создание, настройка, перенос между приложениями, архивирование, очистка, удаление][templates]**

**[Кнопки. Определение, настройка, удаление][buttons]**

**[Подключения. Определения, типы, создание, настройка, удаление][connections]**

**[Пути передачи данных. Определения, типы, создание, настройка, удаление][communication_routes]**

**[Сценарии. Определения, создание, настройка, использование][scenarios]**



{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
