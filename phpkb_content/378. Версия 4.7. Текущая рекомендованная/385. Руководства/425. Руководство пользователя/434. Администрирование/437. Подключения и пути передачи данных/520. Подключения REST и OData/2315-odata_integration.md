---
title: Синхронизация с веб-сервисом. Интеграция по OData
kbId: 2315
---

# Синхронизация с веб-сервисом. Интеграция по OData

## Настройка интеграции с внешним сервисом посредством OData

**{{ productName }}** поддерживает автоматический и ручной импорт и экспорт данных посредством подключения к внешнему OData-сервису.

Подробные сведения о формате данных OData см. в статье «[**URI Conventions (OData Version 2.0)**](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/)» (официальное руководство по OData, английский язык).

1. Настройте [подключение к OData-сервису][odata_connection].

Совет

Для экспериментов с синхронизацией по OData при настройке подключения можно указать общедоступный сервер, предоставляемый OData.org.

Например, для тестирования импорта данных можно использовать следующий сервер:

<https://services.odata.org/V3/OData/OData.svc/>
2. Откройте приложение из списка приложений.
3. На странице «**Администрирование**» приложения выберите пункт «**Интеграции**».

_![Переход к разделу «Интеграции» приложения](https://kb.comindware.ru/assets/img_63bd250182d22.png)_
4. В списке интеграций нажмите кнопку «**Создать**».

_![Создание конфигурации интеграции](https://kb.comindware.ru/assets/img_63bd25466f414.png)_
5. Настройте новую конфигурацию интеграции.

### Настройка синхронизации

Настройте параметры на вкладке «**Основные свойства**».

- **Включить** — установите этот флажок, чтобы задействовать данную конфигурацию интеграции.
- **Название** — введите наглядное название конфигурации интеграции.
- **Подключение по OData** — выберите ранее созданное подключение к OData-сервису.
- **Тип** — выберите направление синхронизации данных:
    - **Импорт** — передача данных из OData-сервиса в приложение;
    - **Экспорт** — передача данных из приложения в OData-сервис.
- **Шаблон записи** — выберите шаблон, с которым будут синхронизироваться данные.
- **Внешняя сущность** — укажите таблицу (набор данных) в OData-сервисе, с которой будут синхронизироваться данные.
- **Синхронизируемые объекты** — выберите, следует ли импортировать все данные или только изменённые:

    - **Все**;
    - **По изменению полей объекта**.
- **Режим запуска** — выберите способ запуска синхронизации:
    - **Вручную** — для [запуска синхронизации](#mcetoc_1gmdebhg01) потребуется выбрать интеграцию в списке и нажать кнопку «**Запустить синхронизацию**».
    - **По расписанию** — настройте расписание автоматической синхронизации:
        - **Первый запуск**;
        - **Периодичность**;
        - **Дни запуска**;
        - **Интервал запуска**.
- **Сопоставление данных** — задайте соответствие атрибутов **внешней сущности** и атрибутов **шаблона записи** и укажите **ключевой атрибут**. 

Принцип сопоставления записей по ключевым атрибутам

Для синхронизации необходимо выбрать пару ключевых атрибутов, содержащих уникальные значения, по которым будут сопоставляться синхронизируемые записи. 

Если при синхронизации совпадут значения ключевых атрибутов в записи в выбранном шаблоне и во внешней сущности, то:

    - при импорте запись в шаблоне будет обновлена данными из внешней сущности;
    - при экспорте запись во внешней сущности будет обновлена данными из шаблона;
Если при синхронизации значения ключевых атрибутов не совпадут, будет создана новая запись:

    - в выбранном шаблоне — при импорте;
    - во внешней сущности — при экспорте.

    - В столбце «**Внешний атрибут**» квадратных скобках указаны свойства атрибутов:
        - **[Primary key]** — первичный ключ, по умолчанию выбран в качестве **ключевого атрибута**;
        - **[Not null]** — атрибуты, которые не могут быть пустыми (при экспорте данных необходимо установить соответствие всех внешних и внутренних атрибутов с данным свойством).

_![Настройка свойств интеграции](https://kb.comindware.ru/assets/img_65368fae9b021.png)_

### Настройка импорта данных

Если на вкладке «**Основные свойства**» выбран импорт данных, настройте параметры на вкладке «**Настройки импорта**»:

- **Зависит от** — укажите интеграцию, синхронизацию по которой необходимо запускать перед запуском синхронизации по данной интеграции. Это может быть необходимо, например, для того, чтобы предварительно обновить данные в связанных шаблонах, к которым требуется привязать синхронизируемые записи.
- **Фильтр** — задайте фильтр данных посредством выражений OData. Синтаксис фильтров см. в статье *«[Using Filter Expressions in OData URIs](https://msdn.microsoft.com/ru-ru/library/hh169248(v=nav.90).aspx)**»* (учебник Microsoft, английский язык). Например, следующий фильтр выбирает записи с порядковым номером (`SequenceNumber`) от 11 до 14:

```
filter=SequenceNumber gt 10 and SequenceNumber lt 15
```
- **Количество объектов в одном запросе** — укажите максимальное количество данных, передаваемых в одном запросе. При превышении этого количества будет формироваться новый запрос к внешнему сервису.
- **Сортировка** — укажите атрибуты и порядок сортировки записей по ним. Выборка импортируемых записей будет выполняться
- **Динамический фильтр** — настройте фильтрацию данных по времени, указав атрибут типа «Дата и время», значение которого будет проверяться на соответствие указанному интервалу фильтра.
- **Интервал фильтра** — интервал времени, который будет отсчитываться от даты запуска синхронизации.
- **Удалить несуществующие записи** — установите этот флажок, чтобы при синхронизации удалять записи, которые отсутствуют на внешнем сервере.
- **Удалить по условию** — укажите атрибуты и значения, чтобы при синхронизации удалять записи, соответствующие заданным условиям.

_![Настройки импорта данных из OData-сервиса](https://kb.comindware.ru/assets/img_63bd26be12c76.png)_

#### Настройка постпроцессинга

Логика постпроцессинга

Постпроцессинг позволяет привязать импортируемые записи к имеющимся записям в связанном шаблоне.

В таблице «**Преобразование атрибутов**» необходимо выбрать ключевые атрибуты связанных шаблонов записи, содержащие уникальные идентификаторы записей, которые требуется связать между собой посредством **целевого атрибута**.

Эти значения будут сравниваться при импорте записей. Если значения ключевых атрибутов в импортируемой записи и в имеющейся записи связанного шаблона совпадут, то эти записи будут связаны посредством выбранного **целевого атрибута**.

1. Нажмите кнопку «**Добавить новую настройку постпроцессинга**».
2. Настройте сопоставление атрибутов между шаблоном записи и OData-сервисом:

    - **Целевой атрибут** — выберите атрибут типа «**Запись**», связанный с **шаблоном записи**, выбранным на вкладке «**Основные свойства**».
    - **Атрибут в выбранном шаблоне** — выберите ключевой атрибут в **шаблоне записи**, выбранным на вкладке «**Основные свойства**» для синхронизации.
    - **Атрибут в связанном шаблоне** — выберите ключевой атрибут шаблона, связанного с **целевым атрибутом**.

_![Настройка постпроцессинга](https://kb.comindware.ru/assets/img_63bd27eda6fb4.png)_

### Настройка экспорта данных

Если на вкладке «**Основные свойства**» выбран экспорт данных, настройте параметры на вкладке «**Настройки экспорта**»:

- **Удалить записи после экспорта** — установите этот флажок, чтобы при синхронизации удалять экспортированные записи.
- **Экспортировать архивные записи** — установите этот флажок, чтобы при синхронизации экспортировать архивные записи.
- **Фильтр** — укажите атрибуты и значения, чтобы при синхронизации экспортировать только записи, соответствующие заданному фильтру.

_![Настройка экспорта](https://kb.comindware.ru/assets/img_63bd28330af91.png)_

## Запуск синхронизации посредством интеграции

1. Установите один или несколько флажков в списке интеграций.
2. Нажмите кнопку «**Запустить синхронизацию**».
3. Будет запущена синхронизация посредством выбранных интеграций.
4. Результаты синхронизации можно просмотреть в журналах интеграции.

_![Запуск синхронизации](https://kb.comindware.ru/assets/img_63bd28a961d97.png)_

## Журналирование интеграции

### Журнал событий

Журнал сеансов синхронизации посредством интеграций отображается на вкладке «**Интеграция по OData**» в разделе «**Администрирование**» — «**Инфраструктура**» — «**Журналы событий**».

_![Журнал сеансов синхронизации данных по OData](https://kb.comindware.ru/assets/img_63bd292283c00.png)_

### Сведения в журнале «Интеграция по OData»

- **Без ошибок** — в этом столбце отображается флажок, если синхронизация выполнена без ошибок.
- **Сеанс** — идентификатор сеанса синхронизации.
- **Событие** — описание события синхронизации. Для просмотра цепочки событий, приведших к событию в журнале, дважды нажмите строку в журнале.
- **Дата** — дата запуска синхронизации.
- **Подключение** — подключение, использованное для синхронизации. Перейдите по этой гиперссылке для просмотра свойств подключения.
- **Конфигурация** — идентификатор конфигурации интеграции. Перейдите по этой гиперссылке для просмотра свойств интеграции.
- **Инициатор** — аккаунт, запустивший синхронизацию. Перейдите по этой гиперссылке для просмотра свойств аккаунта.

### Файловый журнал

При синхронизации посредством интеграции соответствующие события записываются в файл журнала с именем вида: `integration_raw_ГГГГ-ММ-ЧЧ.log`.

![Файл integration_raw_ГГГГ-ММ-ЧЧ.log в папке журналов](https://kb.comindware.ru/assets/img_63bd29914dfe7.png)

Файл integration\_raw\_ГГГГ-ММ-ЧЧ.log в папке журналов

При успешной синхронизации в этом файле будут указаны все синхронизированные объекты. При сбое синхронизации в файл записывается ИД записи, на которой была обнаружена ошибка, и описание ошибки.

![Содержимое файла integration_raw.log](https://kb.comindware.ru/assets/img_63bd29e26c4ce.png)

Содержимое файла integration\_raw.log

--8<-- "related_topics_heading.md"

**[Синхронизация с веб-сервисом. Настройка подключения][odata_connection]**

**[Журнал сеансов синхронизации по OData][logs]**

**[Интеграция с 1С по OData. Настройка для импорта данных][1c_integrations]**

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
