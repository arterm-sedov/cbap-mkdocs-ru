<h1>Максимальный размер загружаемых файлов. Настройка для экземпляра ПО</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1hchr2nua1">Введение</a></li>
<li><a href="#mcetoc_1hchr2b5s0">Расположение загруженных файлов</a></li>
<li><a href="#mcetoc_1hsaa6pef5">Настройка лимита на объем загружаемых файлов</a>
<ul>
<li><a href="#mcetoc_1hsaagi8k6">Изменение лимита в Linux</a></li>
<li><a href="#mcetoc_1hsaainio8">Изменение лимита в Windows</a></li>
</ul>
</li>
<li><a href="#mcetoc_1hkb80dlo0">Связанные статьи</a></li>
</ul>
</div>
<h2 id="mcetoc_1hchr2nua1">Введение</h2>
<p>В данной статье представлены инструкции по настройке максимально допустимого размера загружаемых файлов для экземпляра ПО <strong>Comindware Business Application Platform</strong> в операционных системах Windows и Linux (Astra Linux, Альт Сервер, РЕД ОС, Rocky Linux, Ubuntu и т. п.).</p>
<p>К загружаемым файлам относятся документы и изображения, прикреплённые к атрибутам типов «<a href="https://kb.comindware.ru/article.php?id=2241"><strong>Документ</strong></a>», «<a href="https://kb.comindware.ru/article.php?id=2253"><strong>Изображение</strong></a>» и «<strong>Чертёж</strong>», изображения загруженные на страницах «<a href="https://kb.comindware.ru/article.php?id=2199"><strong>Темы</strong></a>» и «<a href="https://kb.comindware.ru/article.php?id=2198"><strong>Дизайн страниц входа и регистрации</strong></a>», а также <a href="https://kb.comindware.ru/article.php?id=2194#mcetoc_1gjrh0knp6"> изображения <strong>аккаунтов</strong></a>.</p>
<h2 id="mcetoc_1hchr2b5s0">Расположение загруженных файлов</h2>
<p>По умолчанию файлы, загружаемые конечными пользователями и формируемые автоматически, хранятся в следующем каталоге:</p>
<ul>
<li> <code style="letter-spacing: 0.2px;">/var/lib/comindware</code><code style="letter-spacing: 0.2px;">/<em><strong>instancename</strong></em>/Streams</code> — Linux</li>
<li><code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">C</code><code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">:\</code><code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">ProgramData</code><code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">\</code><code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">Comindware</code><code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">\
            </code> <code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">Instances</code><code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;">\<em><span style="box-sizing: border-box; font-weight: 700 !important;">instancename</span></em>\Streams</code> — Windows </li>
</ul>
<p>Здесь и далее <code><em><strong>instancename</strong></em></code> — имя экземпляра ПО.</p>
<p>Подробные сведения о расположении загружаемых файлов см. в статье <em>«<samp data-name="aid" data-title="" data-value="2502"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Пути и содержимое папок экземпляра ПО {Article-ID:2502}</span></samp>».</em><code style="letter-spacing: 0.2px;"></code></p>
<h2 id="mcetoc_1hsaa6pef5">Настройка лимита на объем загружаемых файлов</h2>
<p>При развёртывании экземпляра ПО в конфигурации экземпляра ПО и конфигурации сервера NGINX по умолчанию устанавливается максимальный размер передаваемых данных в форме.</p>
<div class="notice notice-warning">
<p class="admonition-title">Логика работы лимита</p>
<ul>
<li>В файле конфигурации <code>Web.config</code> (в Linux и Windows) задаются два лимита:
<ul>
<li><code>httpRuntime maxRequestLength</code> — максимальный размер запроса для .NET;</li>
<li><code>requestLimits maxAllowedContentLength</code> — максимальный размер запроса для сервера IIS.</li>
</ul>
</li>
<li>В файле конфигурации NGINX (в Linux) задаётся лимит <code>client_max_body_size</code> — максимальный размер запроса.</li>
<li>Применяется меньший из трёх лимитов.</li>
<li>Если, например, установлен лимит в 300 МБ:
<ul>
<li>На форме имеется три поля типа «<strong>Документ</strong>» и несколько полей любых типов.
<ul>
<li>К каждому полю типа «<strong>Документ</strong>» можно прикрепить файл объёмом 99 МБ (то есть три файла суммарным размером 297 МБ) и ввести в другие поля формы ещё 3 МБ данных.</li>
<li>Можно прикрепить к одному полю типа «<strong>Документ</strong>» файл объёмом 299 МБ и ввести в другие поля формы ещё 1 МБ данных.</li>
<li>Можно прикрепить к одному полю типа «<strong>Документ</strong>» файл объёмом 300 МБ.</li>
<li>Нельзя прикрепить к полям типа «<strong>Документ</strong>» три файла по 110 МБ.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h3 id="mcetoc_1hsaagi8k6">Изменение лимита в Linux</h3>
<p>Для изменения лимита на размер загружаемых файлов в ОС Linux необходимо отредактировать конфигурацию экземпляра ПО, а также конфигурацию NGINX.</p>
<ol class="colored_numbers_list">
<li>Перейдите в режим суперпользователя <code>root</code>: 
<pre><code>sudo -i</code></pre>
</li>
<li>Откройте для редактирования файл <code>/var/www/</code><code>comindware<strong><em>instancename</em></strong></code><code>/Web.config</code>: 
<pre><code>sudo </code><code>nano /var/www/comindware<strong><em>instancename</em></strong>/Web.config</code></pre>
</li>
<li>
<p>Установите лимит (например, 1 ГБ) с помощью директив <code>httpRuntime maxRequestLength</code> (в килобайтах) и <code>requestLimits maxAllowedContentLength</code> (в байтах):</p>
<pre class="source_code_container"><code>&lt;httpRuntime maxRequestLength="1048576" maxUrlLength="4096" requestValidationMode="2.0" shutdownTimeout="300" executionTimeout="3000" targetFramework="4.8" enableVersionHeader="false" /&gt;
...
&lt;requestLimits maxAllowedContentLength="1073741824" /&gt;       </code></pre>
</li>
<li>Откройте для редактирования файл <code>/etc/nginx/sites-available/comindware<strong><em>instancename</em></strong></code>:
<pre><code>sudo </code><code>nano /etc/nginx/sites-available/comindware<strong><em>instancename</em></strong></code></pre>
</li>
<li>Откройте для редактирования файл <code>/etc/nginx/sites-available/comindware<strong><em>instancename</em></strong></code>:
<pre><code>sudo </code><code>nano /etc/nginx/sites-available/comindware<strong><em>instancename</em></strong></code></pre>
</li>
<li>
<p>Установите лимит в мегабайтах с помощью директивы <code>client_max_body_size</code>:</p>
<pre class="source_code_container"><code>client_max_body_size 1024m;</code></pre>
</li>
<li>
<p>Перезагрузите экземпляр ПО и NGINX:</p>
<pre class="source_code_container"><code>systemctl restart nginx<br/>systemctl restart comindwareinstancename</code></pre>
</li>
</ol>
<h3 id="mcetoc_1hsaainio8">Изменение лимита в Windows</h3>
<p>Для изменения лимита на размер загружаемых файлов в ОС Windows необходимо отредактировать конфигурацию экземпляра ПО.</p>
<ol class="colored_numbers_list">
<li>Откройте для редактирования файл <code>C</code><code>:\</code><code>ProgramData</code><code>\</code><code>Comindware</code><code>\</code><code>Instances</code><code>\<code style="box-sizing: border-box; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13.5px; color: #36464e !important; word-break: break-word; padding: 0px; background-color: #f5f5f5; border-radius: 0.25rem; font-weight: normal; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><em style="box-sizing: border-box;"><strong style="box-sizing: border-box; font-weight: 700 !important;">instancename</strong></em></code></code><code>\</code><code>Config</code><code></code><code>\Web.config</code>.</li>
<li>
<p>Установите лимит (например, 1 ГБ) с помощью директив <code>httpRuntime maxRequestLength</code> (в килобайтах) и <code>requestLimits maxAllowedContentLength</code> (в байтах):</p>
<pre class="source_code_container"><code>&lt;httpRuntime maxRequestLength="1048576" maxUrlLength="4096" requestValidationMode="2.0" shutdownTimeout="300" executionTimeout="3000" targetFramework="4.8" enableVersionHeader="false" /&gt;
...
&lt;requestLimits maxAllowedContentLength="1073741824" /&gt;</code></pre>
</li>
<li>Перезагрузите экземпляр ПО с помощью Утилиты администрирования (либо с помощью Диспетчера служб IIS перезагрузите сервер приложений и сайт экземпляра ПО).<code></code></li>
</ol>
<h2 id="mcetoc_1hkb80dlo0">Связанные статьи</h2>
<p><strong><samp data-name="aid" data-title="" data-value="2502"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Пути и содержимое папок экземпляра ПО {Article-ID:2502}</span></samp></strong></p>
<p><a class="md-top md-icon mkdocs_imported_link" href="#"> <em class="fa-light fa-arrow-up">‌</em> К началу </a></p>