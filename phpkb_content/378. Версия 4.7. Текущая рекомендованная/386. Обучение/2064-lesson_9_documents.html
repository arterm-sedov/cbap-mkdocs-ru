<h1>Урок 9.  Формирование документов</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1gbl7rnh80">Формирование авансового отчета</a></li>
<li><a href="#mcetoc_1hoc1u2no0">Синтаксис файла шаблона экспорта</a></li>
<li><a href="#mcetoc_1gbl7tasj1">Настройка шаблона экспорта</a></li>
<li><a href="#mcetoc_1gbl7uc0i2">Настройка кнопки экспорта отчета</a></li>
<li><a href="#mcetoc_1gbl80cs34">Настройка разрешения на использование кнопки</a></li>
<li><a href="#mcetoc_1gbl815o35">Тестирование</a></li>
<li><a href="#mcetoc_1gbl822r56">Результаты</a></li>
</ul>
</div>
<h2 id="mcetoc_1hv71mtli0">Введение</h2>
<p>Следуя указаниям в этом уроке, вы настроите автоматический экспорт отчета о затратах на основе данных процесса и по шаблону, созданному с помощью Microsoft Excel.</p>
<p><strong>Предусловие:</strong> пройден <samp data-name="aid" data-title="" data-value="2059"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>{Article-ID:2059}</span></samp>.</p>
<p><strong>Расчетная продолжительность:</strong> 15 мин.</p>
<p><strong>Примечание:</strong> в данном уроке представлен продукт <strong>Comindware Business Application Platform</strong> версии <span style="color: #545764; font-family: 'Open Sans', sans-serif; font-size: 15px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 300; letter-spacing: 0.2px; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">4.2.219.0</span>, внешний вид страниц и меню в других версиях продукта может отличаться.</p>
<h2 id="mcetoc_1gbl7rnh80">Формирование авансового отчета</h2>
<p>Настроим генерацию отчета по затратам по кнопке в задаче <em>«Выполнение рейса»</em>.</p>
<div class="notice notice-info">
<p><strong>Примечание</strong></p>
Настройка экспорта данных состоит из следующих этапов: сначала мы создадим файл Excel с шаблоном, по которому будет формироваться отчет (также можно создать шаблон в формате Word), затем загрузим этот файл в систему и настроим операцию, которая будет выполняться при нажатии кнопки.</div>
<p>Создадим файл для шаблона экспорта… <br/><br/><strong> 1. </strong> Создайте файл Excel (в формате XLSX).</p>
<p><strong> 2. </strong> Заполните лист Excel, как показано на следующей иллюстрации.</p>
<div class="notice notice-warning">
<p class="admonition-title">Внимание!</p>
<p>В файле шаблона экспорта необходимо указывать те системные имена, которые вы фактически использовали в своём приложении.</p>
<p>Например, если вы присвоили атрибуту <em>«Номер заявки» </em>системное имя <code>Nomerzayavki123</code>, то именно это имя следует использовать в файле шаблона экспорта.</p>
<p>То есть, если системные имена, приведённые в уроках, не совпадают с фактическими системными именами в вашем приложении, используйте фактические системные имена, а не копируйте их из текста уроков.</p>
</div>
<div class="screenshot_with_caption">
<p><img alt="Шаблон авансового отчета в формате Excel" class="img-responsive" height="435" src="https://kb.comindware.ru/assets/img_624594abce6ec.png" width="962"/></p>
<p class="caption" style="font-size: 15px !important;">Шаблон авансового отчета в формате Excel</p>
</div>
<h2 id="mcetoc_1hoc1u2no0">Синтаксис файла шаблона экспорта</h2>
<p>Подробные сведения об использовании шаблонов экспорта см. в разделе <em>«<a href="https://kb.comindware.ru/category.php?id=468">Шаблоны экспорта</a>»</em>.</p>
<p>В файле шаблона экспорта в фигурных скобках <code>{ }</code> указывайте системные имена <strong>атрибутов</strong>, значения которых должны отображаться в отчете.</p>
<p>Текст без фигурных скобок будет отображаться как обычный текст.</p>
<p>Для вывода значений из шаблона, связанного с атрибутом типа «<strong>Запись</strong><em>»</em>, используйте оператор <code>
    foreach</code>:</p>
<ul>
<li>в начале строки в фигурных скобках указываются оператор <code>
        foreach</code> и системное имя атрибута типа «<strong>Запись</strong>» — <code>{foreach:Zatraty}</code>;</li>
<li>затем перечисляются системные имена атрибутов из связанного с этим атрибутом шаблона записи, также в фигурных скобках — <code>{Tipzatrat.Nazvanie}</code> <code>{Summa}</code>;</li>
<li>в конце строки указывается оператор <code>
        end</code> и системное имя атрибута типа «<strong>Запись</strong>» — <code>{end:Zatraty}</code>;</li>
<li><code>
        Zatraty</code> — системное имя атрибута типа «<strong>Запись</strong><em>» шаблона <em>«Заявка на автомобиль»</em>, связанного с шаблоном <em>«Затраты»</em>. </em></li>
<li><code>Summa</code> и <code>
        Tipzatrat</code> — системные имена атрибутов шаблона <em>«Затраты»</em>.</li>
<li><code>Tipzatrat</code> — атрибут типа «<strong>Запись</strong>» в шаблоне <em>«Затраты»</em><code></code>, связанный с шаблоном <em>«Тип затрат»</em>. С помощью символа точки мы обращаемся к атрибуту <code>Nazvanie</code> шаблона <em>«Тип затрат»</em>.</li>
</ul>
<p>Кроме того, мы используем системные имена следующих атрибутов шаблона <em>«Заявка на автомобиль»</em>:</p>
<ul>
<li><code>
        Itogovayasummazatrat
        </code> — итоговая сумма затрат;</li>
<li><code>
        Nomerzayavki
        </code> — номер заявки;</li>
<li><code>
        Vremyapodachi
        </code> — время подачи.</li>
</ul>
<h2 id="mcetoc_1gbl7tasj1">Настройка шаблона экспорта</h2>
<p><strong> 1. </strong> Перейдите на вкладку «<strong>Шаблоны экспорта</strong>» шаблона записи <em>«Заявка на автомобиль»</em>.</p>
<p><strong> 2. </strong> Нажмите кнопку «<strong>Создать</strong>».</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Создание шаблона экспорта для шаблона записи «&lt;em&gt;Заявка на автомобиль&lt;/em&gt;»" class="img-responsive" height="282" src="https://kb.comindware.ru/assets/img_63175c2c30b3d.png" width="1254"/></p>
<p class="caption" style="font-size: 15px !important;">Создание шаблона экспорта для шаблона записи <em>«Заявка на автомобиль»</em></p>
</div>
<p><strong> 3. </strong>Отобразится окно «<strong>Новый шаблон экспорта</strong>».</p>
<p><strong>4. </strong>Укажите <strong>название</strong> шаблона экспорта <em>«Авансовый отчет»</em>.</p>
<p><strong> 5. </strong>В поле «<strong>Файл шаблона</strong>» выберите пункт «<strong><strong>Значение</strong> </strong> »  и загрузите созданный ранее файл шаблона в формате XLSX.</p>
<p><strong>6. </strong>В поле «<strong>Имя выходного файла</strong>» выберите пункт «<strong>Значение</strong>» и укажите требуемое имя экспортируемого файла с данными.</p>
<p><strong>7. </strong>Установите флажок «<strong>Экспортировать как PDF</strong>».</p>
<p><strong>8. </strong>Нажмите кнопку «<strong>Сохранить</strong>».</p>
<div class="screenshot_with_caption">
<p><img alt="Настройка свойств шаблона экспорта" class="img-responsive" height="426" src="https://kb.comindware.ru/assets/img_63175def9edd8.png" width="1254"/></p>
<p class="caption" style="font-size: 15px !important;">Настройка свойств шаблона экспорта</p>
</div>
<h2 id="mcetoc_1gbl7uc0i2">Настройка кнопки экспорта отчета</h2>
<p>При создании шаблона экспорта автоматически создается кнопка экспорта. Удостоверимся, что эта кнопка экспорта соответствует нашим требованиям…</p>
<p><strong> 1. </strong> Перейдите на вкладку «<strong>Кнопки</strong><em>» шаблона <em>«Заявка на автомобиль»</em>.  </em></p>
<div class="screenshot_with_caption">
<p><img alt="Список кнопок шаблона записи" class="img-responsive" height="310" src="https://kb.comindware.ru/assets/img_6317c3362c2cf.png" width="1254"/></p>
<p class="caption" style="font-size: 15px !important;">Список кнопок шаблона записи</p>
</div>
<p><strong> 2. </strong> Откройте кнопку <em>«Авансовый отчет»</em>. Проверьте корректность её свойств:</p>
<ul>
<li><strong>отображаемое название</strong> — Авансовый отчет;</li>
<li><strong>контекст операции </strong>— <strong>Запись</strong>;</li>
<li><strong>операция —</strong> <strong>Экспорт записи</strong>;</li>
<li><strong>результат выполнения</strong> — <strong>Скачать документ</strong>;</li>
<li><strong>шаблон экспорта</strong> — Авансовый отчет. </li>
</ul>
<div class="screenshot_with_caption">
<p><img alt="Свойства кнопки экспорта документа, сформированному по шаблону экспорта" class="img-responsive" height="568" src="https://kb.comindware.ru/assets/img_6475e53906e3b.png" width="1266"/></p>
<p class="caption" style="font-size: 15px !important;">Свойства кнопки экспорта документа, сформированному по шаблону экспорта</p>
</div>
<p>Добавим кнопку для экспорта данных на экранную форму. Для этого создадим новую форму…</p>
<p><strong> 1. </strong> Перейдите на вкладку «<strong>Формы</strong>» шаблона <em>«Заявка на автомобиль»</em>.</p>
<p><strong> 2. </strong> Нажмите кнопку «<strong>Создать</strong>»<em>. </em></p>
<p><strong> 3. </strong> Введите <strong>отображаемое название</strong> формы — <em>«Выгрузка отчета»</em>.</p>
<p><strong> 4. </strong> Измените <strong>отображаемое название</strong> автоматически созданной <strong>новой области</strong> на <em>«Выгрузка отчета»</em>.</p>
<p><strong> 5. </strong> Выделите область кнопок <em>«Выгрузка отчета»</em> и перетащите на неё кнопку <em>«Авансовый отчет»</em>.</p>
<p><strong>6. </strong>Сохраните форму.</p>
<div class="screenshot_with_caption">
<p><img alt="Добавление кнопки на форму выгрузки отчета" class="img-responsive" height="489" src="https://kb.comindware.ru/assets/img_6317c544eb9bd.png" width="1254"/></p>
<p class="caption" style="font-size: 15px !important;">Добавление кнопки на форму выгрузки отчета</p>
</div>
<p>Теперь добавим созданную форму на форму задачи <em>«Выполнить рейс»</em>…</p>
<p><strong> 1. </strong> Перейдите на вкладку «<strong>Диаграмма</strong><em>» шаблона процесса <em>«Заказ автотранспорта»</em> и нажмите кнопку </em>«<strong>Редактировать</strong>».</p>
<p><strong> 2. </strong> Выберите задачу <em>«Выполнить рейс»</em> и в меню элемента нажмите кнопку «<strong>Форма</strong>».</p>
<p><strong> 3. </strong>Разверните в панели элементов шаблон <em>«Заявка на автомобиль»</em> и перетащите форму <em>«Выгрузка отчета»</em> под область <em>«Выполнить рейс»</em>.</p>
<p><strong> 4. </strong> Сохраните форму.</p>
<div class="screenshot_with_caption">
<p><img alt="Добавление вложенной формы с кнопкой выгрузки отчета на форму задачи «&lt;em&gt;Выполнить рейс&lt;/em&gt;»" class="img-responsive" height="620" src="https://kb.comindware.ru/assets/img_6317c6a560b8b.png" width="1254"/></p>
<p class="caption" style="font-size: 15px !important;">Добавление вложенной формы с кнопкой выгрузки отчета на форму задачи <em>«Выполнить рейс»</em></p>
</div>
<p id="mcetoc_1gbl80cs33"><strong>5. </strong> Опубликуйте диаграмму бизнес-процесса <em>«Заказ автотранспорта»</em>.</p>
<h2 id="mcetoc_1gbl80cs34">Настройка разрешения на использование кнопки</h2>
<p>Для того, чтобы водитель мог воспользоваться кнопкой <em>«Авансовый отчет»</em>, необходимо предоставить ему соответствующее разрешение с помощью роли <em>«Водитель»</em>.</p>
<p><strong>1.</strong> Откройте раздел «<strong>Роли</strong><em>» приложения <em>«Управление автопарком»</em>. </em></p>
<p><strong>2.</strong> Откройте роль <em>«Водитель»</em> и перейдите на вкладку «<strong>Разрешения</strong>»<em><em>.</em></em></p>
<p><strong>3.</strong> Раскройте в панели ресурсов шаблон <em>«Заявка на автомобиль»</em> и перетащите из него на таблицу разрешений кнопку <em>«Авансовый отчет»</em>.</p>
<p><strong>4.</strong> Установите для кнопки <em>«Авансовый отчет»</em> разрешение «<strong>Использование кнопки</strong>»<em>. </em></p>
<p><strong>5.</strong> Сохраните роль.</p>
<div class="screenshot_with_caption">
<p><img alt="Добавление для роли «&lt;em&gt;Водитель&lt;/em&gt;» разрешения на использование кнопки «&lt;em&gt;Авансовый отчет&lt;/em&gt;»" class="img-responsive" height="832" src="https://kb.comindware.ru/assets/img_6317c77750dd6.png" width="1254"/></p>
<p class="caption" style="font-size: 15px !important;"><em>Добавление для роли <em>«Водитель»</em> разрешения на использование кнопки <em>«Авансовый отчет»</em> </em></p>
</div>
<h2 id="mcetoc_1gbl815o35">Тестирование</h2>
<div class="notice notice-info">
<p><strong>Примечание</strong></p>
Если вы проходите этот урок после прохождения <a href="https://kb.comindware.ru/article.php?id=2063">Урока 8 <em>«Аккаунты»</em></a>, то для тестирования работы приложения вы можете выполнять пользовательские задачи одним из трех способов: <br/>
<ul>
<li>войти в систему несколько раз с разными учетными записями: заказчик, секретарь, водитель, диспетчер;</li>
<li>создать заявку на автомобиль, затем открыть диаграмму запущенного бизнес-процесса <em>«Заказ автотранспорта»</em> и переходить к задачам с помощью кнопки «<strong>Перейти</strong><em>»  <img alt="Перейти" class="img-responsive" height="24" src="https://kb.comindware.ru/assets/img_6317c8a89172d.png" style="letter-spacing: 0.2px;" width="24"/> <span style="letter-spacing: 0.2px;"> в панели «</span><strong style="letter-spacing: 0.2px;"><em>Токены</em> </strong> </em> »<span style="letter-spacing: 0.2px;">;</span></li>
<li>назначить себя исполнителем всех пользовательских задач.</li>
</ul>
</div>
<p><strong> 1. </strong> Перейдите к списку экземпляров шаблона <em>«Заказ автотранспорта»</em> и создайте новую заявку.</p>
<p><strong> 2. </strong> С помощью раздела «<strong>Мои задачи</strong>» пройдите бизнес-процесс до задачи<em> <em>«Выполнение рейса»</em>. </em></p>
<p><strong> 3. </strong> Откройте форму задачи <em>«Выполнить рейс»</em> и заполните коллекцию затрат.</p>
<p><strong>4. </strong>Нажмите кнопку «<strong>Сохранить</strong>».</p>
<p><strong> 5. </strong> Нажмите кнопку<em> «Авансовый отчет»</em> и дождитесь экспорта (скачивания) сформированного PDF-документа. </p>
<div class="screenshot_with_caption">
<p><img alt="Выгрузка сформированного по шаблону экспорта документа с помощью кнопки на форме" class="img-responsive" height="698" src="https://kb.comindware.ru/assets/img_6317ca7944c7f.png" width="1254"/></p>
<p class="caption" style="font-size: 15px !important;">Выгрузка сформированного по шаблону экспорта документа с помощью кнопки на форме</p>
</div>
<p><strong>6. </strong> Откройте экспортированный документ. </p>
<p><strong>7. </strong> Завершите задачу.</p>
<div class="screenshot_with_caption">
<p><img alt="PDF-документ авансового отчета, экспортированный по шаблону в формате Excel из Comindware Business Application Platform" class="img-responsive" height="468" src="https://kb.comindware.ru/assets/img_6245b16fd7334.png" width="1060"/></p>
<p class="caption" style="font-size: 15px !important;">PDF-документ авансового отчета, экспортированный по шаблону в формате Excel из Comindware Business Application Platform</p>
</div>
<h2 id="mcetoc_1gbl822r56">Результаты</h2>
<p>Поздравляем! Вы научились автоматически формировать и экспортировать документы по шаблонам, подставляя в них фактические данные из бизнес-приложения.</p>
<p>В <a href="https://kb.comindware.ru/article.php?id=2065"> следующем уроке </a> вы научитесь работать с контентом.</p>