---
title: Урок 5. Структуры данных
kbId: 2058
---

# Урок 5. Структуры данных

## Введение

В этом уроке вы научитесь создавать реестры данных различных типов (справочники, мастер-данные, транзакционные данные), устанавливать между ними связи и наглядно отображать данные и связи между ними на диаграмме «сущность-связь».

**Предусловия:**пройден [Урок 2. Мой первый реестр данных](https://kb.comindware.ru/article.php?id=2054), создан и настроен реестр данных *«Заявка на автомобиль»*.

**Расчетная продолжительность:** 30 мин.

**Примечание:** в данном уроке представлен продукт **{{ productName }}** версии 4.2.219.0, внешний вид страниц и меню в других версиях продукта может отличаться.

## Диаграмма «сущность-связь»

**Определение**

- Диаграмма «сущность-связь» наглядно показывает атрибуты реестров данных и их связи друг с другом.
- Непосредственно в ходе создания и редактирования диаграммы можно создавать и настраивать новые реестры данных (шаблоны записей), добавлять атрибуты.
- Это позволяет настраивать бизнес-приложение и при этом видеть всю картину в целом.

 **1.**  В панели навигации слева выберите пункты «**Настройки**» — «**Диаграммы**». Отобразится список диаграмм всех приложений.

**Примечание**

- По умолчанию список диаграмм содержит диаграммы бизнес-процессов (графические схемы процессов) и диаграммы моделей классов.
- Диаграмма модели классов создается автоматически для каждого приложения, а для каждого создаваемого шаблона процесса создается диаграмма процесса.

 **2.**  Нажмите кнопку «**Создать**», чтобы создать новую диаграмму.

**3.** В окне «**Новая диаграмма**» укажите  **название** *«Модель данных — заказ автотранспорта»*, **тип**  « **Диаграмма модели данных**» и **приложение**  *«Управление автопарком».*

**4.** Нажмите кнопку «**Сохранить**».

_![Создание новой диаграммы модели данных](https://kb.comindware.ru/assets/img_62433315d3acc.png)_

Отобразится конструктор диаграммы.

**Определение**

**Конструктор диаграммы** позволяет создавать и редактировать модель данных приложения.
Конструктор диаграммы содержит:
(1) панель элементов, которая содержит уже созданные шаблоны и кнопки для создания новых;
(2) область диаграммы;
(3) кнопки для работы с диаграммой. 

_![Конструктор диаграммы](https://kb.comindware.ru/assets/img_624333f52be92.png)_

**5.**  Перетащите на диаграмму шаблон записи *«Заявка на автомобиль»* с левой панели.

_![Добавление шаблона на диаграмму модели данных](https://kb.comindware.ru/assets/img_624334607fe65.png)_

Диаграмма модели данных сохраняется автоматически.

## Справочник «Тип автомобиля»

**Примечание**


Добавим справочник типов автомобилей, чтобы *Заказчик* мог указать тип автомобиля в заявке. 
Сначала мы создадим реестр данных (**шаблон записи**) *«Тип автомобиля»*, затем настроим для него экранную форму, список и заполним его значениями.
Создавать и настраивать реестр данных мы будем с помощью конструктора диаграмм. 
Добавим справочник типов автомобилей…

 **1.**  Перетащите на диаграмму элемент «**Новый шаблон записи**» с панели элементов.

_![Элемент для создания шаблона записи на диаграмме модели данных](https://kb.comindware.ru/assets/img_624334b3e271d.png)_

 **2.** В окне «**Новый шаблон**» введите  ***название***  шаблона — *«Тип автомобиля»* и нажмите кнопку «**Создать**».

_![Создание нового шаблона записи](https://kb.comindware.ru/assets/img_6243355e063a0.png)_

Создадим атрибут текстового типа для реестра данных *«Тип автомобиля»…*

 **1.**  Выберите шаблон «Тип автомобиля» на диаграмме. В меню элемента нажмите кнопку «**Добавить новый атрибут**» *‌*.

_![Переход к созданию атрибута шаблона записи на диаграмме модели данных](https://kb.comindware.ru/assets/img_624335a2049c9.png)_

Отобразится форма создания атрибута.

 **2.**  Укажите **тип данных**«**Текст**» и  **название** атрибута *«Тип автомобиля».*

 **3.**  Установите флажок «**Использовать как заголовок записей**».

 **4.**  Нажмите кнопку «**Сохранить**».

_![Окно свойств нового атрибута](https://kb.comindware.ru/assets/img_63107f7da1fdd.png)_

**Примечание**


Когда установлен флажок «**Использовать как заголовок записей**», что значение этого атрибута будет отображаться как заголовок записей этого шаблона на формах и в таблицах. Если в качестве заголовка записей не выбран ни один атрибут, заголовком будет ID записи — служебный числовой идентификатор. Это будет неинформативно, поэтому атрибут-заголовок записей следует задать. 
Настроим форму, с помощью которой мы будем заполнять справочник типов автомобилей…

 **1.**  Выберите шаблон «Тип автомобиля» на диаграмме. В меню элемента выберите пункт «**Перейти к шаблону**» — «**Формы**».

_![Переход к вкладке «Формы» шаблона записи с диаграммы модели данных](https://kb.comindware.ru/assets/img_6243374d6f32e.png)_

 **2.**  В отобразившемся списке форм дважды нажмите форму «Тип автомобиля — Основная форма», чтобы открыть её.

 **3.**Перетащите на форму новую **область** и переименуйте её в *«Тип автомобиля».*

 **4.**  Перетащите атрибут *«Тип автомобиля»* с панели элементов на область *«Тип автомобиля».*

 **5.**  Нажмите кнопку «**Сохранить**».

 **6.**  Нажмите кнопку «**Настроить шаблон**» *‌*.

_![Добавление атрибута на форму](https://kb.comindware.ru/assets/img_6243382e160d6.png)_

Создадим таблицу *«Тип автомобиля»…*

 **1.**  Перейдите на вкладку «**Таблицы**» шаблона записи *«Тип автомобиля» .*

 **2.**  Дважды нажмите строку «**Все записи**», чтобы перейти к конструктору таблицы.

![Вкладка «Таблицы» шаблона записи](https://kb.comindware.ru/assets/img_6243389f77110.png)

Вкладка «**Таблицы**» шаблона записи

 **3.**  В конструкторе таблицы нажмите кнопку «**Очистить**», чтобы удалить все атрибуты из макета таблицы. В отобразившемся диалоговом окне подтвердите очистку.

 **4.**  Перетащите атрибут *«Тип автомобиля»* на форму.

**5.** Нажмите кнопку «**Сохранить**».

 **6.**  Нажмите кнопку «**Настроить шаблон**» для возврата к вкладке «**Свойства**» шаблона записи *«Тип автомобиля».*

_![Добавление в список атрибута «Тип автомобиля»](https://kb.comindware.ru/assets/img_631085eb1eff4.png)_

Заполним справочник типов автомобилей…

 **1.**  На вкладке «**Свойства**» шаблона записи *«Тип автомобиля»* нажмите кнопку «**Перейти к экземплярам**».

 **2.**   В списке записей «Тип автомобиля» нажмите кнопку «**Создать**».

 **3.**  В поле «Тип автомобиля» укажите значение *«Легковой»* и нажмите кнопку «**Сохранить**».

 **4.**  Нажмите ссылку «*Тип автомобиля*» над формой, чтобы вернуться к списку записей *«Тип автомобиля».*

 **5.**  Аналогичным образом создайте ещё два типа автомобилей — *«Представительский» и «Автобус».*

_![Создание записи с типом автомобиля и переход к списку записей](https://kb.comindware.ru/assets/img_631081080a0bd.png)_

Справочник типов автомобилей готов:

_![Справочник «Тип автомобиля»](https://kb.comindware.ru/assets/img_62433b6f93a3a.png)_

Теперь следует добавить на экранную форму заявки поле *«Тип автомобиля»*, в котором *Заказчик* будет выбирать значение из справочника. Для этого установим связь между реестром данных заявок и справочником типов автомобилей с помощью атрибута типа «**Запись**».

**Определение**

- Атрибут типа «Запись» используется для создания связи между реестрами вида M:1 (многие к одному).
- Это означает, что несколько записей реестра могут ссылаться на одну запись реестра.
- Такой реестр называется связанным шаблоном.
- Связанный шаблон всегда указывается при создании атрибута типа «**Запись**».

 **1.**  В модели данных заказа автотранспорта выберите шаблон *«Заявка на автомобиль»* и в меню элемента нажмите кнопку «**Добавить новый атрибут**» *‌*.

_![Добавление атрибута шаблона записи с помощью диаграммы модели данных](https://kb.comindware.ru/assets/img_62433e63da67b.png)_

 **2.** В окне «**Новый атрибут**» выберите **тип данных** «**Запись**» и укажите **название** *«Тип автомобиля».*

 **3.**  Выберите **связанный шаблон***«Тип автомобиля».*

**4.**Остальные поля оставьте неизменными.

**5.**  Нажмите кнопку «**Сохранить**».

_![Настройка атрибута типа «Запись»](https://kb.comindware.ru/assets/img_631082a57bf73.png)_

 **6.** На диаграмме отобразится связь между шаблонами. 

_![Отображение связи между шаблонами](https://kb.comindware.ru/assets/img_624340bfb62f1.png)_

**Примечание**


Соединительная линия показывает, что для одной заявки на автомобиль может быть указан только один тип автомобиля, и разные заявки могут ссылаться на один и тот же тип автомобиля. 

**Примечание**


Если связь не отобразилась автоматически, выберите любой шаблон и нажмите кнопку «**Показать связанные элементы**».
## Мастер-данные «Автомобиль»

**Определение**

**Мастер-данные** — это объекты учета, например автомобили, клиенты, товарная номенклатура.
*Сотрудникам Гаража* необходимо вести учет автомобилей и видеть, какие автомобили на данный момент свободны. Для этого создадим реестр данных (шаблон записи), где будут храниться данные конкретного автомобиля. 

**1.**  В модели данных заказа автотранспорта перетащите на диаграмму элемент «**Новый шаблон** **записи**». В окне свойств нового шаблона введите **название** *«Автомобиль»* и сохраните шаблон.

 **2.**  Выберите добавленный шаблон и перейдите на его вкладку «**Атрибуты**».

_![Добавление нового шаблона записи с помощью диаграммы модели данных](https://kb.comindware.ru/assets/img_624341506920c.png)_

 **3.**  Добавьте три атрибута **типа «Текст»**:

- *Марка*
- *Модель*
- *Регистрационный номер* — для этого атрибута выберите  **формат отображения** «**Регистрационный номер ТС (РФ)**» и установите флажок «**Использовать как заголовок записей**»

 **4.**  Добавьте атрибут типа «**Запись**» — *«Тип»* и укажите **связанный шаблон** — *«Тип автомобиля».*

_![Атрибуты шаблона записи «Автомобиль»](https://kb.comindware.ru/assets/img_6243425951e2b.png)_

 **5.**  Перейдите на вкладку «**Формы**» и откройте конструктор формы *«Автомобиль — Основная форма».*

 **6**  . Для *новой* **области**на макете формы укажите **отображаемое название** *«Автомобиль».*

**7.**  Перетащите только что созданные атрибуты на область *«Автомобиль»* в конструкторе формы.

**Примечание**


Для удобства конечного пользователя можно использовать элементы «**Колонки**» и «**Вкладки**»,  позволяющие упорядочить поля формы. Вы можете поэкспериментировать с макетом формы.
**8.**Нажмите кнопку «**Сохранить**».

_![Создание основной формы «Автомобиль»](https://kb.comindware.ru/assets/img_6243433a2469b.png)_

Настроим таблицу, чтобы в ней отображались нужные нам атрибуты…

 **1.**  Нажмите кнопку «**Настроить шаблон**» *‌* и перейдите на вкладку «**Таблицы**».

 **2.**  Откройте конструктор таблицы «**Все записи**».

 **3.**  Нажмите кнопку «**Очистить**».

 **4.**  Перетащите на макет таблицы атрибуты: *«Марка», «Модель», «Регистрационный номер»* и *«Тип».*

 **5.**  Нажмите кнопку «**Сохранить**».

 **6.**  Нажмите кнопку «**Настроить шаблон**», чтобы перейти к свойствам шаблона записи *«Автомобиль».*

_![Создание списка](https://kb.comindware.ru/assets/img_6310853815a6a.png)_

## Тестирование: справочники и мастер-данные

Протестируем созданные справочники и мастер-данные:

 **1.**  На вкладке «**Свойства**» шаблона записи *«Автомобиль»* нажмите кнопку «**Перейти к экземплярам**».

 **2.**  Нажмите кнопку «**Создать**». Отобразится форма «Автомобиль».

 **3.**  Заполните экранную форму, в поле *«Тип»* выберите тип автомобиля.

 **4.**  Нажмите кнопку «**Сохранить**»

 **5.**  Нажмите ссылку «*Автомобиль*» над формой, чтобы вернуться к списку записей.

_![Заполнение формы новой записи «Автомобиль»](https://kb.comindware.ru/assets/img_631086cee50f6.png)_

 **6.**  Создайте ещё несколько записей в реестре *«Автомобиль»*, указав при этом разные типы автомобилей, как показано на следующей иллюстрации.

_![Список записей «Автомобиль»](https://kb.comindware.ru/assets/img_62434925df356.png)_

Теперь настроим список с группировкой по типу автомобиля…

 **1.**  Щелкните значок воронки в столбце *«Тип».*

 **2.**  Установите флажок «**Группировать**» в раскрывшемся меню.

 **3.**  Нажмите кнопку «**Сохранить**».

Пункты в списке будут сгруппированы по значению атрибута *«Тип».*

_![Группировка записей по значению атрибута «Тип»](https://kb.comindware.ru/assets/img_62434abbc53b0.png)_

## Атрибуты типа «Запись»

Добавим в реестр данных *«Автомобиль»* информацию о выполненных заявках, в которых использовался этот автомобиль.

Нам понадобится атрибут, который свяжет реестры *«Автомобиль»* и *«Заявка на автомобиль»* связью вида 1:M (один к многим) — когда на один автомобиль может быть несколько заявок. Такую связь позволяет установить атрибут типа «**Запись**» с **взаимной связью и несколькими значениями**.

**Определение**

- Атрибут типа «Запись» с взаимной связью позволяет хранить, отображать и изменять набор связанных записей в другом реестре данных.
- При изменении значения в любом из взаимосвязанных атрибутов во второй атрибут автоматически записывается обратная ссылка на запись в связанном шаблоне.
- **Пример**
    - В реестре автомобилей атрибут *«Заявки на автомобиль»* взаимосвязан с атрибутом *«Автомобиль»* из реестра заявок.
    - При выборе в заявке автомобиля в соответствующей записи из реестра автомобилей автоматически появится обратная ссылка на заявку.

 **1.**  Создайте атрибут типа «**Запись**» в шаблоне *«Автомобиль»:*

- укажите **название** *«Заявки на автомобиль»;*
- выберите **связанный шаблон** *«Заявка на автомобиль»;*
- в списке «**Взаимная связь с атрибутом**» выберите пункт «**С новым**»;
- введите **название нового атрибута** *«Автомобиль»;*
- для атрибута *«Заявки на автомобиль»* установите флажок «**Хранить несколько значений**»;
- нажмите кнопку «**Сохранить**».

_![Создание атрибута «Заявки на автомобиль», взаимосвязанного с атрибутом «Автомобиль»](https://kb.comindware.ru/assets/img_6310a144096fe.png)_

 **2.**  Откройте конструктор формы *«Автомобиль — Основная форма»* и перетащите атрибут *«Заявки на автомобиль»* на область *«Автомобиль».*

**3.** Выберите **представление**«**Таблица**» с помощью панели свойств.

_![Добавление коллекции в форму](https://kb.comindware.ru/assets/img_62434eceb082c.png)_

**Примечание**


На форме атрибут типа «**Запись**» может отображаться в виде таблицы, в столбцах которой расположены атрибуты связанного реестра (шаблона). Какие именно атрибуты должны отображаться, мы указываем с помощью конструктора формы. 
**4.**  Раскройте атрибут *«Заявки на автомобиль»* на панели элементов и перетащите в таблицу на форме атрибуты *«Время подачи», «Маршрут»* и *«Создатель».*

_![Добавление в форму столбцов коллекции](https://kb.comindware.ru/assets/img_6243504618b3b.png)_

**5.**  Выберите область кнопок таблицы и перетащите на нее кнопки «**Добавить**» и «**Перейти**». Это позволит привязывать имеющиеся заявки к автомобилю и переходить к связанным с ним заявкам.

 **6.**  Нажмите кнопку «**Сохранить**».

_![Настройка кнопок для работы с записями в связанном шаблоне](https://kb.comindware.ru/assets/img_624351615fe96.png)_

## **Транзакционные данные: затраты**

Мы научились работать со справочниками и мастер-данными. Помимо этого, нам могут понадобиться транзакционные данные, дополняющие исходные данные нашего процесса (заявку на автомобиль).

Например, мы можем захотеть сохранить список пассажиров или список точек маршрута, помимо конечного пункта назначения.

Или можно дать возможность водителю отчитаться о затратах, сделанных в ходе рейса.

Для этого нам потребуются два новых реестра данных (шаблона записей): затраты на поездку (транзакционные данные) и типы затрат (справочник). Эти реестры мы свяжем с заявкой: заявки — с затратами, а затраты — с типами затрат.

Сначала создадим справочник типов затрат. Для этого вернемся к диаграмме модели данных…

 **1.**  Выберите на панели навигации слева раздел «**Настройки**» — «**Приложения**».

 **2.**  Перейдите в приложение — *«Управление автопарком»*.

 **3.**  Выберите раздел «**Диаграммы**» и перейдите к диаграмме *«Модель данных — Заказ автотранспорта».*

 **4.**  Создайте новый шаблон записи *«Тип затрат».*

**5.**  Выберите созданный шаблон и в меню элемента нажмите кнопку «**Добавить новый атрибут**» *‌*.

_![Создание нового шаблона записи и создание атрибута на диаграмме модели данных](https://kb.comindware.ru/assets/img_6243552de3c5a.png)_

 **6.**  Создайте текстовый атрибут *«Название»* и установите в его свойствах флажок «**Использовать как заголовок записей**».

 **7.**  С помощью меню элемента перейдите на вкладку «**Формы**» шаблона записи «**Тип затрат**».

_![Переход на вкладку «Формы» шаблона записи с диаграммы модели данных](https://kb.comindware.ru/assets/img_624355c4c23ee.png)_

 **8.**  Откройте форму *«Тип затрат — Основная форма».*

**9.** Создайте область *«Укажите тип затрат»* и перетащите на нее атрибут *«Название».*

**10.** Нажмите кнопку «**Сохранить**» и кнопку «**Настроить шаблон**» *‌*, чтобы перейти к свойствам шаблона.

_![Настройка формы «Тип затрат»](https://kb.comindware.ru/assets/img_624356bc20331.png)_

**11.**  Перейдите на вкладку «**Таблицы**» шаблона *«Типы затрат»* и настройте таблицу *«Все записи»* так, чтобы в ней отображался только атрибут *«Название»*. Нажмите кнопку «**Сохранить**» и кнопку «**Настроить шаблон**», чтобы перейти к свойствам шаблона.

_![Настройка списка «Тип затрат»](https://kb.comindware.ru/assets/img_63109faf6b2d6.png)_

 **12.**  Перейдите к списку экземпляров шаблона записи *«Тип затрат»* и создайте следующие типы затрат: *«Топливо», «Сервис», «Прочее».*

_![Экземпляры шаблона записи «Тип затрат»](https://kb.comindware.ru/assets/img_6243578c96194.png)_

Теперь создадим реестр данных (шаблон записи) для затрат…

 **1.**  Вернитесь к диаграмме модели данных и создайте шаблон записи *«Затраты».*

 **2.**  Выберите созданный шаблон и создайте следующие атрибуты:

- **название** *— Сумма*, **тип данных** — **Число**, **количество знаков после запятой** — **2**;
- **название** *—**Тип затрат*, **тип данных**— **Запись**, **связанный шаблон** — *Тип затрат.*

 **3.**  Перейдите на вкладку «**Формы**» через меню элемента *«Затраты».*

**4.** Откройте конструктор формы *«Затраты — Основная форма».*

**5.** Создайте на форме **область** «Затраты».

**6.** Перетащите на область *«Затраты» атрибуты «Сумма»* и *«Тип затрат».*

**7.** Нажмите кнопку «**Сохранить**».

_![Настройка формы «Затраты»](https://kb.comindware.ru/assets/img_624359690fd4c.png)_

 **8.**  Вернитесь к диаграмме модели данных. На диаграмме должна отображаться связь между шаблонами *«Тип затрат»* и *«Затраты»*. Если связь не отображается, в меню элемента нажмите кнопку «**Показать связанные элементы**».

_![Отображение связей шаблона «Тип затрат»](https://kb.comindware.ru/assets/img_62435a3fbe0a2.png)_

Теперь свяжем реестр данных *«Заявка на автомобиль»* с *«Затратами»* с помощью взаимной связи атрибутов типа «**Запись**»…

**1.**  Выберите шаблон *«Заявка на автомобиль»* и нажмите кнопку *‌* ( **Добавить новый атрибут**) в меню элемента.

**2.**  Создайте атрибут со следующими свойствами:

- **тип данных**— **Запись**;
- **название**— *Затраты*;
- **связанный шаблон**— *Затраты*;
- **в****заимная связь с атрибутом** — **С новым**;
- **название нового атрибута** — *Заявка*;
- **хранить несколько значений** — флажок установлен для атрибута *«Затраты»*.

![Создание атрибута «Затраты» типа «Запись» для шаблона «Заявка на автомобиль», взаимно связанного с шаблоном «Затраты»](https://kb.comindware.ru/assets/img_6310a11c1a8ce.png)

Создание атрибута «Затраты» типа «**Запись**» для шаблона «Заявка на автомобиль», взаимно связанного с шаблоном «Затраты»

**3.** На диаграмме должна отображаться связь между шаблонами *«Заявка на автомобиль»* и *«Затраты»*. Если связь не отображается, в меню элемента нажмите кнопку «**Показать связанные элементы**».

_![Отображение связей шаблона записи «Заявка на автомобиль»](https://kb.comindware.ru/assets/img_62435dabb2301.png)_

Настроим отображение реестра данных…

**4.**  Перейдите на вкладку «**Таблицы**» шаблона *«Затраты»*, нажав кнопку «**Таблицы**» в его меню элемента.

_![Переход к таблицам шаблона записи «Затраты» с диаграммы модели данных](https://kb.comindware.ru/assets/img_62435e603ac71.png)_

 **5.**  Настройте таблицу «**Все записи**» шаблона *«Затраты»* так, чтобы в ней отображались атрибуты: *«Заявка», «Тип затрат», «Сумма».*

**6.** Нажмите кнопку «**Сохранить**».

_![Настройка таблицы «Все записи» шаблона «Затраты»](https://kb.comindware.ru/assets/img_6310a2677c532.png)_

## **Результаты**

В этом уроке вы познакомились с новым типом атрибутов — «**Запись**» и узнали, как с его помощью установить связь между реестрами.

Мы улучшили наше приложение — добавили в него справочник *«Тип автомобиля»* и мастер-данные для учета автомобилей.

В  [следующем уроке](https://kb.comindware.ru/article.php?id=2059)  мы усовершенствуем наш процесс — используем созданный справочник, мастер-данные и транзакционные данные.

 

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
