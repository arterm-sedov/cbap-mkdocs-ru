<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr"> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <nav aria-label="Содержание" class="md-nav md-nav--secondary"> <div class="mce-toc"> <h2 class="toc-heading"> Содержание </h2> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#введение"> <span class="md-ellipsis"> Введение </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#требования-к-компьютеру"> <span class="md-ellipsis"> Требования к компьютеру </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#установка-elasticsearch"> <span class="md-ellipsis"> Установка Elasticsearch </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#подключение-к-elasticsearch-при-развертывании-экземпляра-продукта"> <span class="md-ellipsis"> Подключение к Elasticsearch при развертывании экземпляра продукта </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#пример-типового-файла-конфигурации-elasticsearch"> <span class="md-ellipsis"> Пример типового файла конфигурации Elasticsearch </span> </a> </li> </ul> </div> </nav> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset">  <h2 id="введение">Введение</h2> <p>Для работы <strong>Comindware Business Application Platform</strong> требуется сервер Elasticsearch. См. <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=1271">системные требования</a>.</p> <p>В случае установки <strong>Comindware Business Application Platform</strong> версии 4.7 в Windows <a class="mkdocs_imported_link" href="https://kb.comindware.ru/category.php?id=414">Утилита администрирования</a> устанавливает службу Elasticsearch в папку <code>C:\Program Files\Elasticsearch\elasticsearch-8.1.0\</code>. Эта служба имеет базовую конфигурацию и доступна по адресу <code>localhost:9200</code>.</p> <p>Вы можете использовать имеющуюся службу Elasticsearch или развернуть её на отдельном сервере.</p> <p>Здесь представлены требования к конфигурации компьютера для сервера Elasticsearch, инструкции по установке и настройке конфигурации сервера и службы Elasticsearch в ОС Windows, а также приведен пример типового файла конфигурации. Инструкции представлены для версии 8.10.2, для других версий содержимое файлов конфигурации и порядок установки могут быть иными.</p> <p>Только после того, как служба Elasticsearch запущена, можно приступать к развертыванию Comindware Business Application Platform, указав путь к серверу Elasticsearch.</p> <h2 id="требования-к-компьютеру">Требования к компьютеру</h2> <p>Сервер Elasticsearch создает значительную нагрузку на вычислительные ресурсы компьютера, поэтому рекомендуется:</p> <ul> <li>использовать отдельный SSD-диск для хранения журналов и данных сервера Elasticsearch;</li> <li>осуществлять мониторинг свободного места на диске, так как сервер перестает записывать данные, если на диске мало свободного места;</li> <li>использовать высокопроизводительный компьютер с достаточным объемом ОЗУ и количеством ядер ЦП, так как для обработки каждого индекса создается отдельный поток, а индексов может быть много.</li> </ul> <h2 id="установка-elasticsearch">Установка Elasticsearch</h2> <p>Для установки Elasticsearch необходимо распаковать исполняемые файлы из ZIP-архива, а затем настроить переменные среды, службу Elasticsearch и конфигурацию сервера.</p> <p>В процессе установки и настройки Elasticsearch все команды следует выполнять от имени администратора.</p> <ol class="colored_numbers_list"> <li> <p>Скачайте файл <code>elasticsearch-&lt;8.XX.X&gt;-windows-x86_64.zip</code> c дистрибутивом Elasticsearch. Здесь <code>&lt;8.XX.X&gt;</code> — номер версии Elasticsearch.</p> </li> <li> <p>Распакуйте архив в целевую папку, например: <code>C:\Program Files\Elastic\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;</code></p> <p>Последующие инструкции подразумевают, что сервер Elasticsearch установлен в эту папку.</p> </li> <li> <p>Настройте переменные среды, как указано ниже.</p> </li> </ol> <ul> <li>Путь к исполняемым файлам Elasticsearch: <code>ES_HOME: C:\Program Files\Elasticsearch\elasticsearch\elasticsearch-&lt;8.XX.X&gt;</code></li> <li>Путь к JDK (требуется версия, совместимая с текущей версией Elasticsearch): <code>ES_JAVA_HOME: C:\Program Files\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\jdk</code></li> <li>Папка с файлами конфигурации: <code>ES_PATH_CONF: C:\Program Files\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\config</code></li> <li>Папка с файлами журналов: <code>SERVICE_LOG_DIR: C:\ProgramData\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\logs</code></li> <li>Директива для автоматического запуска службы: <code>ES_START_TYPE: auto</code></li> </ul> <ol class="colored_numbers_list" start="4"> <li>Настройте службу Elasticsearch с помощью файла конфигурации <code>elasticsearch.yml</code></li> </ol> <p>Можно скопировать его содержимое из раздела «Пример типового файла конфигурации Elasticsearch».</p> <ol class="colored_numbers_list" start="5"> <li> <p>Зарегистрируйте службу Elasticsearch, выполнив следующую команду: <code>"C:\Program Files\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\bin\elasticsearch-service.bat" install</code></p> </li> <li> <p>Запустите службу Elasticsearch, выполнив следующую команду: <code>"C:\Program Files\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\bin\elasticsearch-service.bat" start</code></p> </li> <li> <p>Сформируйте пароль для пользователя Elasticsearch с помощью следующей команды: <code>"C:\Program Files\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\bin\elasticsearch-reset-password.bat" –u elastic</code></p> </li> <li> <p>Сохраните пароль, который отобразится на экране. </p> </li> </ol> <p><strong>Примечание.</strong> Если пароль не отобразился, но отобразилось сообщение с предложением нажать клавишу «Y» для просмотра пароля, нажмите клавишу «Y». 9. Убедитесь, что служба Elasticsearch успешно зарегистрирована и работает с помощью приложения «Службы» (<code>services.msc</code>):</p> <div class="highlight"><code><pre><span></span><code>&lt;figure markdown&gt;![Сведения о службе Elasticsearch в приложении «Службы»](https://kb.comindware.ru/assets/Picture5.png)&lt;figcaption&gt;Сведения о службе Elasticsearch в приложении «Службы»&lt;/figcaption&gt;&lt;/figure&gt;</code><br/>
</pre></code></div> <p>10.Если служба Elasticsearch не запустилась:</p> <div class="highlight"><code><pre><span></span><code>- проверьте ошибки конфигурации в журнале Elasticsearch по пути `C:\ProgramData\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\logs` (указанном в переменной окружения среды `SERVICE_LOG_DIR`).</code><br/>
<code>- устраните ошибки, запустите службу и проверьте работоспособность службы, как указано в параграфе 8.</code><br/>
</pre></code></div> <h2 id="подключение-к-elasticsearch-при-развертывании-экземпляра-продукта">Подключение к Elasticsearch при развертывании экземпляра продукта</h2> <ol class="colored_numbers_list"> <li> <p>Перед созданием экземпляра продукта укажите адрес сервера Elasticsearch, который будет использоваться по умолчанию для новых экземпляров продукта, в конфигурации Утилиты администрирования Comindware. См. документ «<strong><em>Утилита администрирования Comindware. Установка и использование</em></strong>».</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка стандартного адреса сервера Elasticsearch" src="https://kb.comindware.ru/assets/Picture6.png"/><figcaption class="caption">Настройка стандартного адреса сервера Elasticsearch</figcaption></figure></p> </li> <li> <p>Если не указать адрес сервера Elasticsearch в конфигурации Утилиты администрирования, то его потребуется указать при развертывании экземпляра продукта.</p> </li> <li> <p>Укажите адрес сервера и префикс индекса Elasticsearch для данного экземпляра Comindware Business Application Platform.</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка адреса сервера Elasticsearch для экземпляра продукта" src="https://kb.comindware.ru/assets/Picture7.png"/><figcaption class="caption">Настройка адреса сервера Elasticsearch для экземпляра продукта</figcaption></figure></p> </li> <li> <p>После развертывания экземпляра продукта в разделе «<strong>Администрирование системы</strong>» — «<strong>Подключения</strong>» будет отображаться настроенное подключение к Elasticsearch.</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Подключение к Elasticsearch в новом экземпляре продукта" src="https://kb.comindware.ru/assets/Picture8.png"/><figcaption class="caption">Подключение к Elasticsearch в новом экземпляре продукта</figcaption></figure></p> </li> <li> <p>Чтобы изменить свойства подключения к Elasticsearch, дважды нажмите его строку в списке подключений.</p> </li> <li> <p>Отобразится окно «<strong>Свойства подключения: Elasticsearch</strong>».</p> </li> <li> <p>При необходимости измените свойства подключения, <strong>проверьте соединение</strong> и нажмите кнопку «<strong>Сохранить</strong>».</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Настройка свойств подключения к Elasticsearch" src="https://kb.comindware.ru/assets/Picture9.png"/><figcaption class="caption">Настройка свойств подключения к Elasticsearch</figcaption></figure></p> </li> <li> <p>После изменения свойств сервера Elasticsearch перезапустите экземпляр продукта с помощью Утилиты администрирования Comindware. См. документ «<strong><em>Утилита администрирования Comindware. Установка и использование</em></strong>».</p> </li> </ol> <h2 id="пример-типового-файла-конфигурации-elasticsearch">Пример типового файла конфигурации Elasticsearch</h2> <p>Ниже приведен пример файла <code>elasticsearch.yml</code> для следующей конфигурации сервера:</p> <ul> <li>сервер Elasticsearch состоит из единственного узла;</li> <li>служба работает в локальной сети;</li> <li>включена аутентификация;</li> <li>служба доступна через порт <code>9201</code>;</li> <li>адрес сервера <code>http://testhost:9201</code>;</li> <li>путь к файлу конфигурации: <code>C:\Program Files\Elastic\Elasticsearch\&lt;8.XX.X&gt;\config\elasticsearch.yml</code></li> </ul> <div class="highlight"><code><pre><span></span><code>#Начало файла конфигурации   </code><br/>
<code>#Разрешить свопинг памяти   </code><br/>
<code>bootstrap.memory_lock: false   </code><br/>
<code></code><br/>
<code>#Название кластера   </code><br/>
<code>cluster.name: cmw   </code><br/>
<code></code><br/>
<code>#Максимальное возможное количество шардов в кластере   </code><br/>
<code>#Система создает отдельный индекс для каждого объекта мониторинга, поэтому рекомендуется увеличить количество шардов до 3000   </code><br/>
<code>cluster.max_shards_per_node: 3000   </code><br/>
<code></code><br/>
<code>#Стандартный номер порта 9200 изменен по соображениям безопасности   </code><br/>
<code>http.port: 9201   </code><br/>
<code></code><br/>
<code>#Сетевые параметры   </code><br/>
<code>#Если доступ по сети не требуется, то закомментируйте строки #network.host и discovery.seed_hosts   </code><br/>
<code>#Замените имя компьютера — testhost — на реальное имя   </code><br/>
<code>network.host: testhost   </code><br/>
<code>discovery.seed_hosts:   </code><br/>
<code>  - testhost   </code><br/>
<code></code><br/>
<code>#Простейшая конфигурация с одним узлом   </code><br/>
<code>discovery.type: single-node   </code><br/>
<code></code><br/>
<code>#Название узла   </code><br/>
<code>node.name: cmw   </code><br/>
<code></code><br/>
<code>#Путь к папке с данными   </code><br/>
<code>path.data: d:\ProgramData\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\data   </code><br/>
<code></code><br/>
<code>#Путь к папке с журналами   </code><br/>
<code>path.logs: d:\ProgramData\Elasticsearch\elasticsearch-&lt;8.XX.X&gt;\logs   </code><br/>
<code></code><br/>
<code>#Путь к папке с резервными копиями   </code><br/>
<code>#Путь должен указывать на существующий диск   </code><br/>
<code>#Резервные копии должны храниться на отдельном диске отдельно от #основных данных   </code><br/>
<code>#Раскомментируйте директиву path.repo, если требуется создавать резервные копии   </code><br/>
<code>#path.repo: d:elastic_backup   </code><br/>
<code></code><br/>
<code>#Обычная лицензия   </code><br/>
<code>xpack.license.self_generated.type: basic   </code><br/>
<code></code><br/>
<code>#Аутентификация включена   </code><br/>
<code>xpack.security.enabled: true   </code><br/>
<code></code><br/>
<code>#Этот флаг требуется для записи данных в индексы   </code><br/>
<code>indices.id_field_data.enabled: true   </code><br/>
<code></code><br/>
<code>#отключить геолокацию    </code><br/>
<code>ingest.geoip.downloader.enabled: false</code><br/>
</pre></code></div> </article> </div> </div> <a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#"> <i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i> К началу </a> </main> </div> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>