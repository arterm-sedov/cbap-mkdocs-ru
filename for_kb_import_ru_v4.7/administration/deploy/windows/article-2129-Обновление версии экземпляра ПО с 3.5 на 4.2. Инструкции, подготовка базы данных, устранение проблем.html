<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr"> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <nav aria-label="Содержание" class="md-nav md-nav--secondary"> <div class="mce-toc"> <h2 class="toc-heading"> Содержание </h2> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#введение"> <span class="md-ellipsis"> Введение </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#требования-для-обновления"> <span class="md-ellipsis"> Требования для обновления </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#порядок-обновления-по"> <span class="md-ellipsis"> Порядок обновления ПО </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#возможные-проблемы-после-обновления-и-способы-их-устранения"> <span class="md-ellipsis"> Возможные проблемы после обновления и способы их устранения </span> </a> <nav aria-label="Возможные проблемы после обновления и способы их устранения" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#использование-выражения-const--и-пустых-значений-в-сценариях"> <span class="md-ellipsis"> Использование выражения CONST(" ") и пустых значений в сценариях </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#выделение-памяти-для-elasticsearch"> <span class="md-ellipsis"> Выделение памяти для Elasticsearch </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#перекомпиляция-скриптов-на-c"> <span class="md-ellipsis"> Перекомпиляция скриптов на C </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#преобразование-глобальных-функций"> <span class="md-ellipsis"> Преобразование глобальных функций </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#использование-специальных-символов-в-имени-пользователя"> <span class="md-ellipsis"> Использование специальных символов в имени пользователя </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#преобразование-повторно-используемых-подпроцессов"> <span class="md-ellipsis"> Преобразование повторно используемых подпроцессов </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#преобразование-правил-для-данных-у-промежуточных-событий"> <span class="md-ellipsis"> Преобразование правил для данных у промежуточных событий </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#преобразование-формул"> <span class="md-ellipsis"> Преобразование формул </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#настройка-разрешений-для-шаблонов-процессов"> <span class="md-ellipsis"> Настройка разрешений для шаблонов процессов </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#настройка-кнопок-и-разрешений-для-таблиц-на-формах"> <span class="md-ellipsis"> Настройка кнопок и разрешений для таблиц на формах </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#публикация-диаграмм-процессов"> <span class="md-ellipsis"> Публикация диаграмм процессов </span> </a> </li> </ul> </nav> </li> </ul> </div> </nav> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset">  <h2 id="введение">Введение</h2> <p>В данной статье представлены инструкции по обновлению экземпляра ПО <strong>Comindware Business Application Platform</strong> (далее «ПО») с версии 3.5 на версию 4.2 для Windows, включая устранение ошибок, которые могут возникнуть при обновлении.</p> <h2 id="требования-для-обновления">Требования для обновления</h2> <p>Для обновления версии экземпляра ПО требуется заранее подготовить:</p> <ol class="colored_numbers_list"> <li>Резервную копию экземпляра ПО версии 3.5 в формате <code>.CDBBZ</code>.</li> <li>Работающий экземпляр ПО версии 3.5.</li> <li>Дистрибутив ПО версии 3.5.1058 или выше: <code>ComindwarePlatform_3.5.1058.0.msi</code>.</li> <li>Дистрибутив ПО версии 3.5.1076 или выше: <code>ComindwarePlatform_3.5.1076.0.msi</code>.</li> <li>Дистрибутив ПО версии 3.5.1100 или выше: <code>ComindwarePlatform_3.5.1100.0.msi</code>.</li> <li>Дистрибутив ПО версии 4.2, например, <code>ComindwarePlatform_4.2.278.0.msi</code>.</li> <li>Развернутый сервер Elasticsearch, см. статью «<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2094">Установка Elasticsearch. Краткое руководство для Windows</a>».</li> </ol> <h2 id="порядок-обновления-по">Порядок обновления ПО</h2> <ol class="colored_numbers_list"> <li>Установите ПО версии 3.5.1058 с помощью файла <code>ComindwarePlatform_3.5.1058.0.msi</code> и Утилиты администрирования. См. статью «<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2028">Установка продукта Comindware Business Application Platform</a>».</li> <li>С помощью Утилиты администрирования обновите экземпляр ПО версии 3.5 до версии 3.5.1058. См. статью «<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2031">Обновление версии продукта для экземпляра</a>».</li> <li>Запустите экземпляр ПО.</li> <li>Выполните вход в экземпляр ПО с аккаунтом системного администратора.</li> <li>При отображении запросов на обновление базы данных и инициализацию экземпляра ПО, нажимайте кнопку «<strong>Далее</strong>».</li> <li>Дождитесь отображения начальной страницы экземпляра ПО.</li> <li>Проверьте работоспособность экземпляра ПО, устраните возможные ошибки и при необходимости проведите дополнительную настройку экземпляра ПО, чтобы обеспечить его штатную работу.</li> <li>Создайте резервную копию экземпляра ПО в формате <code>.CDBBZ</code> с помощью раздела «<strong>Администрирование</strong>» — «<strong>Инфраструктура</strong>» — «<strong>Резервное копирование</strong>» в экземпляре ПО.</li> <li>Повторите шаги 1–8 для ПО версии 3.5.1076 или выше, а затем для версии 3.5.1100 или выше. В результате у вас должен быть работоспособный экземпляр ПО версии 3.5.1100 (или выше) и его резервная копия.</li> <li>С помощью Утилиты администрирования обновите версию экземпляра ПО до версии 4.2. См. статью «<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2031">Обновление версии продукта для экземпляра</a>».</li> <li>При отображении запросов на обновление базы данных, индексов Elasticsearch и инициализацию экземпляра ПО, нажимайте кнопку «<strong>Далее</strong>».</li> <li>Дождитесь отображения начальной страницы экземпляра ПО.</li> <li>В процессе обновления версии экземпляра ПО в папке журналов экземпляров ПО будет создан файл <code>upgrade.log</code>.</li> <li> <p>Откройте папку журналов экземпляра ПО. Путь к этой папке указан в Утилите администрирования в поле «<strong>Журнал системы</strong>» на вкладке «<strong>Пути к файлам</strong>» в окне «<strong>Конфигурация</strong> <strong>экземпляра системы</strong>». См. «<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2301">Обновление версии продукта для экземпляра</a>».</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Путь к папке журналов экземпляра ПО в Утилите администрирования" src="https://kb.comindware.ru/assets/img_632c16a5d2547.png"/><figcaption class="caption">Путь к папке журналов экземпляра ПО в Утилите администрирования</figcaption></figure></p> </li> <li> <p>Откройте файл <code>upgrade.log</code> в папке журналов экземпляра ПО </p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Файл upgrade.log в папке журналов экземпляра ПО" src="https://kb.comindware.ru/assets/img_632c1702b0dcb.png"/><figcaption class="caption">Файл upgrade.log в папке журналов экземпляра ПО</figcaption></figure></p> </li> <li> <p>В файле <code>upgrade.log</code> найдите все ошибки по ключевым словам <code>ERROR</code> и <code>ошиб</code>.</p> <p><figure class="screenshot_with_caption" markdown=""><img alt="Пример ошибок в журнале обновления экземпляра ПО" src="https://kb.comindware.ru/assets/img_632c16c77cf4f.png"/><figcaption class="caption">Пример ошибок в журнале обновления экземпляра ПО</figcaption></figure></p> </li> <li> <p>Если в файле <code>upgrade.log</code> ошибки отсутствуют, обновление версии экземпляра ПО выполнено успешно и его можно эксплуатировать в штатном режиме. Шаги 18–25 выполнять не требуется.</p> </li> <li>Если в файле <code>upgrade.log</code>имеются ошибки, переходите к шагам 19–25.</li> <li>С помощью Утилиты администрирования смените версию экземпляра ПО на версию 3.5.1058. См. статью «<code>![](https://kb.comindware.ru/images/marker.png){Article-ID:2031}</code> » .</li> <li>С помощью Утилиты администрирования восстановите экземпляр ПО из резервной копии версии 3.5 в формате <code>.CDBBZ</code>, созданной на шаге 8 или 23.</li> <li>Запустите экземпляр ПО.</li> <li>Выполните вход в экземпляр ПО с аккаунтом системного администратора.</li> <li>Устраните все ошибки, указанные в файле <code>upgrade.log</code>.</li> <li>Создайте резервную копию экземпляра ПО.</li> <li>Снова обновите экземпляр ПО до версии 4.2.</li> <li>Повторяйте шаги 9–25 до тех пор, пока не удастся запустить экземпляр ПО в штатном режиме.</li> <li>Переходите к <a class="mkdocs_imported_link" href="#возможные-проблемы-после-обновления-и-способы-их-устранения">устранению возможных проблем в работоспособном экземпляре версии 4.2</a>.</li> </ol> <h2 id="возможные-проблемы-после-обновления-и-способы-их-устранения">Возможные проблемы после обновления и способы их устранения</h2> <p>После того как экземпляр ПО версии 4.2 будет запущен, проверьте наличие перечисленных ниже потенциальных проблем и устраните их при необходимости.</p> <h3 id="использование-выражения-const--и-пустых-значений-в-сценариях">Использование выражения CONST(" ") и пустых значений в сценариях</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>В сценариях в действии «<strong>Изменить значение атрибутов</strong>» в версии 3.5 для установки в атрибуте пустого значения в него записывалось пустое значение или использовалось выражение <code>CONST(" ")</code>.</td> <td>Чтобы установить в атрибуте пустое значение, укажите операцию со значением «<strong>Удалить</strong>» .</td> </tr> </tbody> </table> <h3 id="выделение-памяти-для-elasticsearch">Выделение памяти для Elasticsearch</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>Сервис Elasticsearch работает некорректно или не работает. В информационной панели экземпляра ПО отображаются сообщения об ошибках Elasticsearch.</td> <td>Проверьте конфигурацию сервера Elasticsearch: выделите достаточный объем памяти и необходимое количество шардов в соответствии с объемом исторических данных.</td> </tr> </tbody> </table> <h3 id="перекомпиляция-скриптов-на-c">Перекомпиляция скриптов на C</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>Не все скрипты на C# из версии 3.5 могут без изменений работать в версии 4.2. Например, в функции <code>Api.Process.ProcessObjectService.CreateWithObjectId()</code> было четыре параметра, а в версии 4.2 а стало три. В некоторых случаях после обновления с версии 3.5 на версию 4.2 может отображаться сообщение об ошибке «Could not find a part of the path».</td> <td>1. Перекомпилируйте скрипты, нажав кнопку «<strong>Перекомпилировать библиотеки скриптов</strong>» на странице «<strong>Администрирование</strong>» — «<strong>Глобальная конфигурация</strong>». 2. Ознакомьтесь с журналом компиляции скриптов. 3. Исправьте выявленные ошибки в скриптах.</td> </tr> </tbody> </table> <h3 id="преобразование-глобальных-функций">Преобразование глобальных функций</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>Глобальные функции из версии 3.5 не поддерживаются в версии 4.2.</td> <td>Вместо глобальных функций следует создать аналогичные сценарии или скрипты на C#.</td> </tr> </tbody> </table> <h3 id="использование-специальных-символов-в-имени-пользователя">Использование специальных символов в имени пользователя</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>В версии 3.5 в имени пользователя можно было указать специальные символы. В версии 4.2 в имени пользователя разрешено использовать только буквы латинского алфавита (строчные и прописные), цифры, символ подчеркивания, точку и дефис: a-z A-Z 0-9 _ . - Все остальные символы недопустимы.</td> <td>1. Исправьте имена пользователей, содержащие недопустимые символы, на странице «<strong>Администрирование</strong>» — «<strong>Аккаунты</strong>». 2. Исправьте выражения и скрипты на C#, в которых могут присваиваться имена пользователей с недопустимыми символами.</td> </tr> </tbody> </table> <h3 id="преобразование-повторно-используемых-подпроцессов">Преобразование повторно используемых подпроцессов</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>Элемент диаграммы процесса «<strong>Повторно используемый подпроцесс</strong>» из версии 3.5 в версии 4.2 переименован в «<strong>Вызов под процесса</strong>». В версии 4.2 вызов процесса настраивается и может работать несколько иначе, чем в версии 3.5.</td> <td>Проверьте конфигурацию и работоспособность элементов «<strong>Вызов под процесса</strong>» на всех диаграммах процессов. Исправьте конфигурацию при необходимости.</td> </tr> </tbody> </table> <h3 id="преобразование-правил-для-данных-у-промежуточных-событий">Преобразование правил для данных у промежуточных событий</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>Правила для данных <em>на входе и выходе</em> промежуточных событий из версии 3.5 при обновлении до версии 4.2 преобразуются в сценарии <em>на выходе</em>. В результирующем сценарии на выходе из промежуточного события все действия выстраиваются последовательно — сначала идут действия из правил на входе, затем — из правил на выходе.</td> <td>1. Если требуется полностью сохранить прежнюю логику работы правил для данных на входе в промежуточное событие: - Создайте дополнительное промежуточное событие перед имеющимся. - Перенесите на его выход действия из правил на входе исходного события. 2. Проверьте сценарии на выходе из промежуточных событий на всех диаграммах процессов на предмет корректной работы. Исправьте сценарии при необходимости.</td> </tr> </tbody> </table> <h3 id="преобразование-формул">Преобразование формул</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>В версии 3.5 в формулах можно было не выполнять проверку на пустое значение атрибутов. В версии 4.2 такая проверка необходима во избежание деления на 0 и других неполадок, в противном случае будет возникать ошибка.</td> <td>В формулах необходимо проверять наличие значений у атрибутов с помощью функции <code>NOT(EMPTY())</code> либо обеспечивать ненулевое значение с помощью функции <code>VALUE()</code>.</td> </tr> </tbody> </table> <h3 id="настройка-разрешений-для-шаблонов-процессов">Настройка разрешений для шаблонов процессов</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>В версии 3.5 не требовалось разрешение на создание экземпляра процесса. В версии 4.2 для создания экземпляра процесса у аккаунта должно быть разрешение.</td> <td>В свойствах ролей добавьте разрешение «<strong>Создание</strong>» для соответствующих шаблонов процессов.</td> </tr> </tbody> </table> <h3 id="настройка-кнопок-и-разрешений-для-таблиц-на-формах">Настройка кнопок и разрешений для таблиц на формах</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>В версии 3.5 для коллекции (таблицы) на форме кнопки операций с записями создавались автоматически в соответствии с разрешениями на соответствующие операции, заданными в свойствах коллекции (таблицы) на форме. В версии 4.2 кнопки операций с записями в таблице на форме требуется выносить на область кнопок таблицы. При этом вынесенные кнопки определяют разрешения на соответствующие операции с записями в таблице.</td> <td>Если у таблицы на форме не отображаются или не работают должным образом кнопки операций с записями в таблице, например «<strong>Редактировать</strong>», «<strong>Создать</strong>», «<strong>Сохранить</strong>», «<strong>Удалить</strong>»:- в конструкторе формы выберите область кнопок таблицы; - перетащите на область кнопок требуемые кнопки, при этом будут разрешены соответствующие операции с записями в таблице; - проверьте и настройте свойства таблицы на форме.</td> </tr> </tbody> </table> <h3 id="публикация-диаграмм-процессов">Публикация диаграмм процессов</h3> <table style="width: 100%;"> <thead> <tr> <th><strong>Проблема</strong></th> <th><strong>Решение</strong></th> </tr> </thead> <tbody> <tr> <td>При обновлении с версии 3.5 на версию 4.2 некоторые процессы могут перестать выполняться.</td> <td>Откройте диаграмму процесса, который не выполняется должным образом или выдаёт ошибку. Опубликуйте её заново, выбрав способ «<strong>Создать новую версию</strong>».</td> </tr> </tbody> </table> </article> </div> </div> <a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#"> <i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i> К началу </a> </main> </div> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>