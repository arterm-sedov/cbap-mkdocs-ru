<div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="4909" kb-tags="" kb-title="Локальная переменная. Использование для массовой обработки записей">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<p>В Comindware Platform можно настроить возможность массовой обработки несколько записей в таблице, например, если нужно поменять статус у нескольких заявок одновременно, подтвердить оплату нескольких счетов и т. д. В данной статье рассмотрен пример массового назначения исполнителей по заявкам и последующий запуск процесса по каждой из заявок.</p>
<p>Так как невозможно при выборе нескольких записей открывать какую-либо форму (форма показывает только атрибуты одной записи), предлагается использовать механизм локальных переменных. В локальную переменную можно поместить некоторое значение, которое потом можно применить или продублировать для всех выбранных записей.</p>
<p><strong>Исходные данные:</strong></p>
<ul>
<li>Шаблон записи «Заявки».</li>
<li>Атрибут «Ответственный» в шаблоне записи «Заявки» (тип данных — Аккаунт).</li>
<li>Шаблон процесса «Исполнение заявки».</li>
</ul>
<p><strong>Настройка:</strong></p>
<p><strong>1.</strong> В шаблоне записи «Заявки» создайте кнопку со следующими параметрами:</p>
<ul>
<li>Отображаемое название — Назначить исполнителя;</li>
<li>Контекст операции — Запись;</li>
<li>Операция — Сохранить;</li>
<li>Результат выполнения — Обновить данные;</li>
<li>Отображать диалоговое окно — отметьте чекбокс.</li>
</ul>
<p>Сохраните настройки кнопки и перейдите во вкладку «Локальные переменные». Создайте переменную «Исполнитель» (тип данных — Аккаунт).</p>
<p>Перейдите во вкладку «Свойства» и нажмите на «Настроить диалоговое окно». Вынесите на центральную область созданную локальную переменную. Сохраните настройки и вынесите кнопку на область кнопок для таблиц.</p>
<p><strong>2.</strong> Перейдите в настройки приложения и нажмите «Сценарии». Создайте новый сценарий со следующими параметрами:</p>
<ul>
<li>Название — Назначение исполнителя по заявке</li>
<li>Контекст выполнения — От инициатора;</li>
<li>Статус — Активен.</li>
</ul>
<p><strong>3.</strong> Настройте триггер на нажатие созданной в п. 1 кнопки, добавьте действие по изменению значения. Выберите атрибут «Ответственный», укажите операцию со значениями — Заменить и в поле «Значение», выберите N3 и вставьте следующее выражение:</p>
<div class="highlight"><code><pre><span></span><code>@prefix cmwsession: &lt;http://comindware.com/ontology/session#&gt;.</code> <br/><code>@prefix user: &lt;http://comindware.com/ontology/user#&gt;.</code> <br/><code>@prefix variable: &lt;http://comindware.com/ontology/session/variable#&gt;.</code> <br/><code>@prefix debug: &lt;http://comindware.com/ontology/debug#&gt;.</code> <br/><code></code> <br/><code>{</code> <br/><code>    cmwsession:context variable:dialogVariables ?v1.</code> <br/><code>    ?v1 variable:Ispolnitel ?value.</code> <br/><code>}</code> <br/></pre></code></div>
<p>Важно указать системное имя, прописанное в локальной переменной после «<strong><em>variable:</em></strong>».</p>
<p>Затем добавьте действие «Запуск процесса», выберите процесс «Исполнение заявки». Перейдите во вкладку «Дополнительно» и отметьте галочки «Выполнять отдельно от сценария» и «Игнорировать все ошибки», если этого не сделать, процесс запустится не по каждой из записи, а только по одной.</p>
<p><strong>4.</strong> Протестируйте. Выберите несколько заявок, нажмите на кнопку «Назначить исполнителей». Откроется диалоговое окно с локальной переменной «Исполнитель». Выберите пользователя, подтвердите операцию.</p>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>