<div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="5154" kb-tags="N3,Notation 3,RDF,дата и время,длительность,задачи,вычисление,список задач,пример,просрочка,срок выполнения,триплеты,тройка,тройки" kb-title="Список задач всех пользователей со статусом и длительностью просрочки. Настройка с помощью N3">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#example_n3_task_list_custom_intro">
<span class="md-ellipsis">
      Введение
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#example_n3_task_list_custom_use_case">
<span class="md-ellipsis">
      Прикладная задача
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#example_n3_task_list_custom_configure">
<span class="md-ellipsis">
      Пример настройки
    </span>
</a>
<nav aria-label="Пример настройки" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#example_n3_task_list_custom_attributes">
<span class="md-ellipsis">
      Настройка атрибутов
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#example_n3_task_list_custom_table">
<span class="md-ellipsis">
      Настройка таблицы задач
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#связанные-статьи">
<span class="md-ellipsis">
      Связанные статьи
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="example_n3_task_list_custom_intro">Введение</h2>
<p><strong>Comindware Platform</strong> предусмотрена стандартная страница «<strong>Мои задачи</strong>» с заранее заданными столбцами, которая показывает список задач для текущего пользователя.</p>
<p>Чтобы вывести список задач определённых пользователей, с дополнительными бизнес-данными и т. п, можно настроить таблицу с требуемыми вычисляемыми атрибутами и особыми параметрами фильтрации, группировки и сортировки.</p>
<p>Здесь приведён пример вычисления с помощью языка <strong>N3</strong> атрибутов просрочки для задач и настройки списка всех задач для всех пользователей со отображением этих атрибутов.</p>
<p>Если вам требуется отфильтровать список задач, см. также <em>«<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4935">Фильтр списка по активным задачам текущего пользователя: по всем процессам, по конкретному процессу</a>»</em>.
.</p>
<h2 id="example_n3_task_list_custom_use_case">Прикладная задача</h2>
<p>Имеется шаблон процесса <em>«Обработка заявок»</em> со связанным шаблоном записей <em>«Заявки»</em>.</p>
<p>Требуется настроить таблицу <em>«Все задачи»</em> со следующими параметрами:</p>
<ul>
<li>выводить задачи всех пользователей: как активные, так и завершённые;</li>
<li>столбцы <strong>Задача</strong>, <strong>Исполнитель</strong>, <strong>Дата создания</strong>, <strong>Плановая дата завершения</strong>, <strong>Дата завершения</strong>;</li>
<li>столбец <em>«Просрочена»</em> с булевым (логическим) значением:<ul>
<li><em>Да</em> — если задача активна и плановая дата завершения уже наступила, либо задача завершена, но дата завершения позже плановой даты завершения;</li>
<li><em>Нет</em> — в остальных случаях.</li>
</ul>
</li>
<li>столбец <em>«Длительность просрочки»</em> (<em>0</em>, если задача не просрочена).</li>
</ul>
<h2 class="pageBreakBefore" id="example_n3_task_list_custom_configure">Пример настройки</h2>
<p>Решим задачу следующим образом:</p>
<ul>
<li>В шаблоне записей <em>«Заявки»</em> <a class="mkdocs_imported_link" href="#example_n3_task_list_custom_attributes">создадим атрибуты для контроля просрочки</a>:<ul>
<li><strong>вычисляемый логический</strong> атрибут <em>«Статус просрочки»</em> с выражением на <strong>N3</strong> для определения признака просрочки;</li>
<li><strong>вычисляемый текстовый</strong> атрибут <em>«Просрочена»</em> с <strong>формулой</strong> для отображения в таблице статуса просрочки в виде <em>«Да»</em> и <em>«Нет»</em>;</li>
<li><strong>вычисляемый</strong> атрибут <em>«Длительность просрочки»</em> типа «<strong>дата и время</strong>» с выражением на <strong>N3</strong> для определения длительности просрочки.</li>
<li>Статус и длительность просрочки вычислим с помощью <strong>N3</strong> по разности между текущим временем (для активных задач) или фактической датой завершения (для закрытых задач) и плановой датой завершения.</li>
</ul>
</li>
<li>В шаблоне процесса <em>«Обработка заявок»</em> <a class="mkdocs_imported_link" href="#example_n3_task_list_custom_table">создадим <strong>таблицу задач</strong></a> с <strong>системным фильтром</strong> для выборки всех задач всех пользователей и требуемыми столбцами.</li>
</ul>
<div class="notice notice-warning">
<p class="admonition-title">Внимание!</p>
<p>Для корректного вычисления выражений указывайте в них те системные имена шаблонов и атрибутов, которые используются в вашем приложении. Они могут отличаться от указанных в примере.</p>
</div>
<h3 id="example_n3_task_list_custom_attributes">Настройка атрибутов</h3>
<ol class="colored_numbers_list">
<li>В шаблоне записи <em>«Заявки»</em> создайте атрибут для вычисления признака просрочки:</li>
</ol>
<ul>
<li><strong>Название:</strong> <code>Статус просрочки</code></li>
<li><strong>Системное имя:</strong> <code>СтатусПросрочки</code></li>
<li><strong>Тип данных: логический</strong></li>
<li><strong>Описание:</strong> <em>Логический признак просрочки задачи</em></li>
<li><strong>Вычислять автоматически:</strong> флажок установлен</li>
<li>
<p><strong>Вычисляемое значение: N3</strong></p>
<div class="highlight"><code><pre><span></span><code><span class="c"># Импортируем функции для работы с объектами, статусами задач,</span></code> <br/><code><span class="c"># сеансом (текущим временем) и сравнения величин</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">cmw:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/logics#&gt;</span><span class="p">.</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">taskStatus:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/ontology/taskStatus#&gt;</span><span class="p">.</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">session:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/ontology/session#&gt;</span><span class="p">.</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">w3math:</span><span class="w"> </span><span class="nv">&lt;http://www.w3.org/2000/10/swap/math#&gt;</span><span class="p">.</span></code> <br/><code><span class="p">{</span></code> <br/><code>    <span class="c"># Текущее время (UTC) для сравнения со сроками.</span></code> <br/><code>    <span class="nn">session</span><span class="p">:</span><span class="nt">context</span> <span class="nn">session</span><span class="p">:</span><span class="nt">requestTime</span> <span class="err">?nowUTC</span><span class="p">.</span></code> <br/><code>    <span class="c"># Активная задача с истёкшим сроком — просрочена.</span></code> <br/><code>    <span class="err">if</span> <span class="p">{</span></code> <br/><code>        <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">taskStatus</span> <span class="nn">taskStatus</span><span class="p">:</span><span class="nt">inProgress</span><span class="p">.</span></code> <br/><code>        <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">dueDate</span> <span class="err">?dueDates</span><span class="p">.</span></code> <br/><code>        <span class="err">?dueDates</span> <span class="nn">w3math</span><span class="p">:</span><span class="nt">lessThan</span> <span class="err">?nowUTC</span><span class="p">.</span></code> <br/><code>    <span class="p">}</span></code> <br/><code>    <span class="err">then</span> <span class="p">{</span><span class="err">True</span> <span class="err">-&gt;</span> <span class="err">?value</span> <span class="p">}</span></code> <br/><code>    <span class="err">else</span> <span class="p">{</span></code> <br/><code>        <span class="c"># Завершённая задача: просрочена, если завершена после срока.</span></code> <br/><code>        <span class="err">if</span> <span class="p">{</span></code> <br/><code>            <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">taskStatus</span> <span class="nn">taskStatus</span><span class="p">:</span><span class="nt">completed</span><span class="p">.</span></code> <br/><code>            <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">dueDate</span> <span class="err">?dueDates</span><span class="p">.</span></code> <br/><code>            <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">scheduledEndDate</span> <span class="err">?endDates</span><span class="p">.</span></code> <br/><code>            <span class="err">?dueDates</span> <span class="nn">w3math</span><span class="p">:</span><span class="nt">lessThan</span> <span class="err">?endDates</span><span class="p">.</span></code> <br/><code>        <span class="p">}</span></code> <br/><code>        <span class="err">then</span> <span class="p">{</span><span class="err">True</span> <span class="err">-&gt;</span> <span class="err">?value</span> <span class="p">}</span></code> <br/><code>        <span class="err">else</span> <span class="p">{</span><span class="err">False</span> <span class="err">-&gt;</span> <span class="err">?value</span> <span class="p">}.</span></code> <br/><code>    <span class="p">}.</span></code> <br/><code><span class="p">}</span></code> <br/></pre></code></div>
</li>
</ul>
<ol class="colored_numbers_list" start="2">
<li>В шаблоне <em>«Заявки»</em> создайте атрибут для отображения признака просрочки:</li>
</ol>
<ul>
<li><strong>Название:</strong> <code>Просрочена</code></li>
<li><strong>Системное имя:</strong> <code>Просрочена</code></li>
<li><strong>Тип данных: текстовый</strong></li>
<li><strong>Описание:</strong> <em>Текстовый статус просрочки задачи</em></li>
<li><strong>Вычислять автоматически:</strong> флажок установлен</li>
<li>
<p><strong>Вычисляемое значение: формула</strong></p>
<div class="highlight"><code><pre><span></span><code><span class="k">IF</span><span class="p">(</span><span class="ss">"СтатусПросрочки"</span><span class="p">,</span><span class="w"> </span><span class="ss">"Да"</span><span class="p">,</span><span class="w"> </span><span class="ss">"Нет"</span><span class="p">)</span></code> <br/></pre></code></div>
</li>
</ul>
<ol class="colored_numbers_list" start="3">
<li>В шаблоне записи <em>«Заявки»</em> создайте атрибут для вычисления длительности просрочки:</li>
</ol>
<ul>
<li><strong>Название:</strong> <code>Длительность просрочки</code></li>
<li><strong>Системное имя:</strong> <code>ДлительностьПросрочки</code></li>
<li><strong>Тип данных: длительность</strong></li>
<li><strong>Описание:</strong> <em>Длительность просрочки задачи</em></li>
<li><strong>Вычислять автоматически:</strong> флажок установлен</li>
<li>
<p><strong>Вычисляемое значение: N3</strong></p>
<div class="highlight"><code><pre><span></span><code><span class="c"># Импортируем функции для работы с объектами, статусами задач,</span></code> <br/><code><span class="c"># сеансом, временем и сравнения величин</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">cmw:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/logics#&gt;</span><span class="p">.</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">taskStatus:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/ontology/taskStatus#&gt;</span><span class="p">.</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">session:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/ontology/session#&gt;</span><span class="p">.</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">w3math:</span><span class="w"> </span><span class="nv">&lt;http://www.w3.org/2000/10/swap/math#&gt;</span><span class="p">.</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">cmwtime:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/logics/time#&gt;</span></code> <br/><code><span class="p">{</span></code> <br/><code>    <span class="c"># Текущее время (UTC) для сравнения со сроками.</span></code> <br/><code>    <span class="nn">session</span><span class="p">:</span><span class="nt">context</span> <span class="nn">session</span><span class="p">:</span><span class="nt">requestTime</span> <span class="err">?nowUTC</span><span class="p">.</span></code> <br/><code>    <span class="c"># Активная задача с истёкшим сроком — просрочена.</span></code> <br/><code>    <span class="err">if</span> <span class="p">{</span></code> <br/><code>        <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">taskStatus</span> <span class="nn">taskStatus</span><span class="p">:</span><span class="nt">inProgress</span><span class="p">.</span></code> <br/><code>        <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">dueDate</span> <span class="err">?dueDates</span><span class="p">.</span></code> <br/><code>        <span class="err">?dueDates</span> <span class="nn">w3math</span><span class="p">:</span><span class="nt">lessThan</span> <span class="err">?nowUTC</span><span class="p">.</span></code> <br/><code>        <span class="p">(</span><span class="err">?nowUTC</span> <span class="err">?dueDates</span><span class="p">)</span> <span class="nn">cmwtime</span><span class="p">:</span><span class="nt">getSpan</span> <span class="err">?overdueDuration</span><span class="p">.</span></code> <br/><code>    <span class="p">}</span></code> <br/><code>    <span class="err">then</span> <span class="p">{</span><span class="err">overdueDuration</span> <span class="err">-&gt;</span> <span class="err">?value</span> <span class="p">}</span></code> <br/><code></code> <br/><code>    <span class="err">else</span> <span class="p">{</span></code> <br/><code>        <span class="c"># Завершённая задача: просрочена, если завершена после срока.</span></code> <br/><code>        <span class="err">if</span> <span class="p">{</span></code> <br/><code>            <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">taskStatus</span> <span class="nn">taskStatus</span><span class="p">:</span><span class="nt">completed</span><span class="p">.</span></code> <br/><code>            <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">dueDate</span> <span class="err">?dueDates</span><span class="p">.</span></code> <br/><code>            <span class="err">?item</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">scheduledEndDate</span> <span class="err">?endDates</span><span class="p">.</span></code> <br/><code>            <span class="err">?dueDates</span> <span class="nn">w3math</span><span class="p">:</span><span class="nt">lessThan</span> <span class="err">?endDates</span><span class="p">.</span></code> <br/><code>            <span class="p">(</span><span class="err">?endDates</span> <span class="err">?dueDates</span><span class="p">)</span> <span class="nn">cmwtime</span><span class="p">:</span><span class="nt">getSpan</span> <span class="err">?overdueDuration</span><span class="p">.</span></code> <br/><code>        <span class="p">}</span></code> <br/><code>        <span class="err">then</span> <span class="p">{</span><span class="err">overdueDuration</span> <span class="err">-&gt;</span> <span class="err">?value</span> <span class="p">}</span></code> <br/><code>        <span class="err">else</span> <span class="p">{</span><span class="mi">0</span> <span class="err">-&gt;</span> <span class="err">?value</span> <span class="p">}.</span></code> <br/><code>    <span class="p">}.</span></code> <br/><code><span class="p">}</span></code> <br/></pre></code></div>
</li>
</ul>
<h3 class="pageBreakBefore" id="example_n3_task_list_custom_table">Настройка таблицы задач</h3>
<ol class="colored_numbers_list">
<li>В шаблоне <em>«Обработка заявок»</em> создайте <strong>таблицу задач</strong> <em>«Все задачи»</em>. См. <em>«<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4800#table_configure_tasks_view">Создание таблицы со списком задач</a>»</em>.</li>
<li>
<p>В конструкторе таблицы на вкладке «<strong>Основные</strong>» следующий <strong>системный фильтр</strong> на <strong>N3</strong>:</p>
<div class="highlight"><code><pre><span></span><code><span class="c"># Импортируем функции для работы с объектами</span></code> <br/><code><span class="k">@prefix</span><span class="w"> </span><span class="nn">cmw:</span><span class="w"> </span><span class="nv">&lt;http://comindware.com/logics#&gt;</span><span class="p">.</span></code> <br/><code></code> <br/><code><span class="c"># Получаем все пользовательские задачи</span></code> <br/><code><span class="p">{</span><span class="err">?item</span> <span class="kt">a</span> <span class="nn">cmw</span><span class="p">:</span><span class="nt">UserTask</span><span class="p">.}</span></code> <br/></pre></code></div>
<p>С таким фильтром в таблице будут отображаться задачи всех пользователей и с любым статусом: активные и завершённые.</p>
</li>
<li>
<p>Добавьте в столбцы таблицы задач системные атрибуты:</p>
<ul>
<li><strong>Задача</strong></li>
<li><strong>Исполнитель</strong></li>
<li><strong>Дата создания</strong></li>
<li><strong>Плановая дата завершения</strong></li>
<li><strong>Дата завершения</strong></li>
</ul>
</li>
<li>
<p>Добавьте в столбцы таблицы задач атрибуты, показывающие статус просрочки:</p>
<ul>
<li><em>Просрочена</em></li>
<li><em>Длительность просрочки</em></li>
</ul>
</li>
<li>
<p>Добавьте таблицу <em>«Все задачи»</em> на требуемую информационную страницу приложения. Например, см. <em>«<a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4800#table_configure_add_to_my_tasks">Добавление таблицы на страницу «Мои задачи»</a>»</em>.</p>
</li>
<li>Откройте результирующую таблицу и проверьте её состав.</li>
</ol>
<div class="relatedTopics">
<h2 id="связанные-статьи">Связанные статьи</h2>
<ul>
<li><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4800#table_configure_tasks_view">Создание таблицы со списком задач</a></li>
<li><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4800#table_configure_add_to_my_tasks">Добавление таблицы на страницу «Мои задачи»</a></li>
<li><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4852">Справочник по языку N3</a></li>
<li>[Справочник по формулам][formula_guide_reference]</li>
<li><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4935">Фильтр списка по активным задачам текущего пользователя: по всем процессам, по конкретному процессу</a></li>
</ul>
</div>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></div>