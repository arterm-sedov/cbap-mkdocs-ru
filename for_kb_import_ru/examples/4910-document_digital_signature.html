<div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="4910" kb-tags="" kb-title="Документы с электронной подписью. Настройка сертификатов, приложения и использование">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#введение">
<span class="md-ellipsis">
      Введение
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-пк-конечного-пользователя">
<span class="md-ellipsis">
      Настройка ПК конечного пользователя
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#настройка-приложения">
<span class="md-ellipsis">
      Настройка приложения
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#подписание-документа">
<span class="md-ellipsis">
      Подписание документа
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="введение">Введение</h2>
<p>В этой статье представлены инструкции по настройке браузера конечного пользователя и приложения для подписания документов электронной подписью (ЭП) и по подписанию документов.</p>
<p>Для работы с ЭП необходимо:</p>
<ul>
<li><a class="mkdocs_imported_link" href="#mcetoc_1hpgc8b6v1">настроить ПК конечного пользователя</a> — установить ПО КриптоПро CSPT, расширение КриптоПро для браузера и сертификаты для цифровых подписей;</li>
<li><a class="mkdocs_imported_link" href="#mcetoc_1hpgbm68v0">настроить приложение</a> в Comindware Platform для использования ЭП.</li>
</ul>
<p>В статье представлен пример настройки приложения таким образом, чтобы текущий пользователь мог подписывать документы с помощью ЭП.</p>
<h2 id="настройка-пк-конечного-пользователя">Настройка ПК конечного пользователя</h2>
<ol class="colored_numbers_list">
<li>Установите расширение для браузера CryptoPro Extension for CAdES (КриптоПро ЭЦП Browser plug-in):
   <a class="mkdocs_imported_link" href="https://www.cryptopro.ru/products/cades/plugin">https://www.cryptopro.ru/products/cades/plugin</a></li>
<li>Установите ПО КриптоПро CSPT:
   <a class="mkdocs_imported_link" href="https://cryptopro.ru/products/csp?csp=download">https://cryptopro.ru/products/csp?csp=download</a></li>
<li>Получите и установите сертификат с расширением <code>.cer</code>, используя параметры по умолчанию:</li>
</ol>
<p><img alt="Установка сертификата в формате .cer" src="https://kb.comindware.ru/assets/img_63330916d0ee5.png"/></p>
<p>Установка сертификата в формате .cer
4. Получите и установите закрытый сертификат с расширением <code>.pfx</code>, используя параметры по умолчанию:</p>
<p><img alt="Установка закрытого сертификата в формате .pfx" src="https://kb.comindware.ru/assets/img_63341c8bd0462.png"/></p>
<p>Установка закрытого сертификата в формате .pfx</p>
<h2 id="настройка-приложения">Настройка приложения</h2>
<ol class="colored_numbers_list">
<li>В шаблоне записи для хранения подписанных документов (например, «<em>Документы</em>») создайте атрибут «<em>Подписанные договоры</em>» типа «<strong>Документ</strong>» с форматом отображения «<strong>Документ с цифровой подписью</strong>».</li>
</ol>
<p><img alt="Создание атрибута типа «Документ» с цифровой подписью" src="https://kb.comindware.ru/assets/img_63330abedcb02.png"/></p>
<p>Создание атрибута типа «Документ» с цифровой подписью
2. Поместите атрибут «<em>Подписанные договоры</em>» на форму, которая будет служить для загрузки и подписания документов ЭП.
3. В разделе «<strong>Роли</strong>» приложения откройте свойства роли, которая будет давать доступ на подписание документа.
4. На вкладке «<strong>Разрешения</strong>» перетащите атрибут «<em>Подписанные договоры</em>» в список ресурсов и установите для него флажок «<strong>Использование кнопок</strong>».</p>
<p><img alt="Настройка роли для использования документов с ЭП" src="https://kb.comindware.ru/assets/img_63330e18f1d29.png"/></p>
<p>Настройка роли для использования документов с ЭП
5. В шаблоне «<em>Договоры</em>» создайте кнопку «<em>Добавить подписанта</em>»:
   - в поле «<strong>Контекст операции</strong>» выберите пункт «<strong>Запись</strong>»;
   - в поле «<strong>Операция</strong>» выберите пункт «<strong>Пользовательское событие</strong>»;
   - в поле «<strong>Результат выполнения</strong>» выберите пункт «<strong>Обновить данные</strong>».</p>
<div class="highlight"><code><pre><span></span><code> ![Создание кнопки «Добавить подписанта»](https://kb.comindware.ru/assets/img_63342330ef3e3.png)</code> <br/><code></code> <br/><code> Создание кнопки «Добавить подписанта»</code> <br/></pre></code></div>
<ol class="colored_numbers_list" start="6">
<li>Поместите кнопку «<em>Добавить подписанта</em>» на ту же форму, на которую поместили атрибут «<em>Подписанные договоры</em>».</li>
</ol>
<p><img alt="Кнопка «Добавить подписанта» и атрибут «Подписанные договоры» на форме" src="https://kb.comindware.ru/assets/img_6334242d7e090.png"/></p>
<p>Кнопка «Добавить подписанта» и атрибут «Подписанные договоры» на форме
7. В разделе приложения «<strong>Сценарии</strong>» создайте сценарий «<em>Добавить подписанта</em>».</p>
<p>Логика работы сценария</p>
<p>Сценарий для кнопки подписания документа требуется для того, чтобы назначить подписантом документа текущего пользователя.</p>
<p>Список разрешённых подписантов хранится в атрибуте <em>«Подписанты»</em> системного шаблона документа.</p>
<p>Файл, прикреплённый к атрибуту типа «<strong>Документ</strong>» представляет собой запись в шаблоне документа.</p>
<p>Соответственно, для подписания документа в данном примере сценарий записывать в атрибут <em>«Подписанты»</em> текущего документа идентификатор аккаунта текущего пользователя (вычисляемый с помощью функции <code>USER()</code>).
8. Настройте свойства начального события сценария «<strong>Нажать кнопку</strong>»:
   - в поле «<strong>Контекстный шаблон выберите</strong>» выберите шаблон «<em>Документы</em>»;
   - в поле «<strong>Кнопка</strong>» выберите созданную на <a class="mkdocs_imported_link" href="#step9">шаге 9</a> кнопку «<em>Добавить подписанта</em>».</p>
<div class="highlight"><code><pre><span></span><code> ![Настройка свойств события «Нажатие кнопки» в сценарии](https://kb.comindware.ru/assets/img_633424ef7f1a5.png)</code> <br/><code></code> <br/><code> Настройка свойств события «Нажатие кнопки» в сценарии</code> <br/></pre></code></div>
<ol class="colored_numbers_list" start="9">
<li>Добавьте в сценарий действие «<strong>Сменить контекст</strong>».</li>
<li>
<p>В свойствах блока «<strong>Сменить контекст</strong>» в поле «<strong>Целевой шаблон</strong>» выберите пункт «<strong>Шаблон документа</strong>» и атрибут «<em>Подписанные договоры</em>».</p>
<p><img alt="Настройка свойств события «Сменить контекст» в сценарии" src="https://kb.comindware.ru/assets/img_6334252026f9c.png"/></p>
<p>Настройка свойств события «Сменить контекст» в сценарии
11. Добавьте внутрь действия «<strong>Сменить контекст</strong>» действие «<strong>Изменить значения атрибутов</strong>».
12. Настройте свойства блока «<strong>Изменить значения атрибутов</strong>»:
- нажмите кнопку «<strong>Создать</strong>»;
- в столбце «<strong>Атрибут</strong>» выберите атрибут «<strong>Подписанты</strong>»;
- в столбце «<strong>Операция со значениями</strong>» выберите пункт «<strong>Заменить</strong>»;
- в столбце «<strong>Значение</strong>» выберите пункт «<strong>Формула</strong>» и введите формулу: <code>USER()</code></p>
<p><img alt="Настройка свойств события «Изменить значения атрибутов» в сценарии" src="https://kb.comindware.ru/assets/img_633424a369e98.png"/></p>
<p>Настройка свойств события «Изменить значения атрибутов» в сценарии
13. Должен получиться показанный ниже сценарий:</p>
<p><img alt="Сценарий для подписания документа ЭП по нажатию кнопки" src="https://kb.comindware.ru/assets/img_63342583e522c.png"/></p>
<p>Сценарий для подписания документа ЭП по нажатию кнопки
14. На этом настройка приложения для использования документов с ЭП завершена.</p>
</li>
</ol>
<h2 id="подписание-документа">Подписание документа</h2>
<ol class="colored_numbers_list">
<li>Создайте новую запись в шаблоне «<em>Документы</em>».</li>
<li>Добавьте документ для подписания, нажав кнопку «<strong>Добавить документ</strong>».</li>
</ol>
<p><img alt="Добавление документа для подписания" src="https://kb.comindware.ru/assets/img_63342801ce457.png"/></p>
<p>Добавление документа для подписания
3. Нажмите кнопку «<em>Поставить подписанта</em>».
4. Сохраните запись, нажав кнопку «<strong>Сохранить</strong>».
5. Обновите страницу в браузере.
6. Рядом с названием документа появится кнопка «<strong>Подписать</strong>».</p>
<p><img alt="Добавление подписанта для документа" src="https://kb.comindware.ru/assets/img_633429e15bc05.png"/></p>
<p>Добавление подписанта для документа
7. Нажмите кнопку «<strong>Подписать</strong>».
8. Отобразится окно «<strong>Подписание</strong>».
9. Выберите сертификат.
10. Нажмите кнопку «<strong>Подписать</strong>».</p>
<div class="highlight"><code><pre><span></span><code>![Выбор сертификата для подписания документа](https://kb.comindware.ru/assets/img_65fc25f9d781a.png)</code> <br/><code></code> <br/><code>Выбор сертификата для подписания документа</code> <br/></pre></code></div>
<ol class="colored_numbers_list" start="11">
<li>
<p>Подтвердите операцию с ЭП для веб-сайта и при необходимости введите пароль.</p>
<p><img alt="Подтверждение операции с ЭП" src="https://kb.comindware.ru/assets/img_63342cf0954aa.png"/></p>
<p>Подтверждение операции с ЭП
12. Документ будет подписан ЭП и рядом с его названием отобразятся статус «<strong>Документ подписан</strong>» и дата подписания.</p>
<p><img alt="Представление подписанного документа" src="https://kb.comindware.ru/assets/img_65fc271adfbdb.png"/></p>
<p>Представление подписанного документа
13. Чтобы подписать документ с помощью другого сертификата, нажмите кнопку «<strong>Отозвать подпись</strong>» и подпишите документ заново.
14. При необходимости загрузите подпись в виде файла формата SIGN, нажав кнопку «<strong>Скачать подпись</strong>».
15. Чтобы просмотреть подробную информацию о документе и подписи, нажмите кнопку «<strong>Перейти к форме</strong>».
16. Отобразится форма с информацией о документе и подписях для него, также содержащая сам подписанный документ.</p>
<p><img alt="Форма со сведениями о документе, подписанном ЭП" src="https://kb.comindware.ru/assets/img_63342e3a80378.png"/></p>
<p>Форма со сведениями о документе, подписанном ЭП</p>
</li>
</ol>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>