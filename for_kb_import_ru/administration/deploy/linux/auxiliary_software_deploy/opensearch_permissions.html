<div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="5152" kb-tags="OpenSearch,разрешения,права доступа,роли,журнал транзакций,журналирование,журналирование,безопасность" kb-title="OpenSearch. Настройка разрешений">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_intro">
<span class="md-ellipsis">
      
        Введение
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_overview">
<span class="md-ellipsis">
      
        Обзор необходимых разрешений
      
    </span>
</a>
<nav aria-label="Обзор необходимых разрешений" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_index_management">
<span class="md-ellipsis">
      
        Разрешения на управление индексами
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_read">
<span class="md-ellipsis">
      
        Разрешения на чтение данных
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_pit">
<span class="md-ellipsis">
      
        Разрешения Point-in-Time
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_write">
<span class="md-ellipsis">
      
        Разрешения на запись данных
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_cluster">
<span class="md-ellipsis">
      
        Глобальные разрешения кластера
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_role_config">
<span class="md-ellipsis">
      
        Настройка роли для Comindware Platform
      
    </span>
</a>
<nav aria-label="Настройка роли для Comindware Platform" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_role_config_api">
<span class="md-ellipsis">
      
        Создание роли через REST API
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_role_config_dashboards">
<span class="md-ellipsis">
      
        Создание роли через OpenSearch Dashboards
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_verification">
<span class="md-ellipsis">
      
        Проверка конфигурации
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_security">
<span class="md-ellipsis">
      
        Рекомендации по безопасности
      
    </span>
</a>
<nav aria-label="Рекомендации по безопасности" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_security_least_privilege">
<span class="md-ellipsis">
      
        Принцип наименьших привилегий
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_security_index_pattern">
<span class="md-ellipsis">
      
        Ограничение шаблона индексов
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#opensearch_permissions_security_tls">
<span class="md-ellipsis">
      
        Использование TLS
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#связанные-статьи">
<span class="md-ellipsis">
      
        Связанные статьи
      
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="opensearch_permissions_intro">Введение</h2>
<p><strong>Comindware Platform</strong> использует службу OpenSearch (Elasticsearch) для журналирования транзакций (истории изменений записей и <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4723">экземпляров процессов</a>, <a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4673#logs_event_chain_view">цепочки событий</a> и т. п.).</p>
<p>Для корректной работы журнала транзакций пользователь <strong>Comindware Platform</strong> в OpenSearch (Elasticsearch) должен иметь необходимые разрешения на создание индексов, запись и чтение данных.</p>
<p>Здесь представлены инструкции по настройке разрешений для пользователя <strong>Comindware Platform</strong> в OpenSearch (Elasticsearch).</p>
<div class="notice notice-info">
<p class="admonition-title">Служебный пользователь в OpenSearch (Elasticsearch)</p>
<ul>
<li>В конфигурации экземпляра ПО необходимо указать адрес сервера и уникальный префикс индексов OpenSearch (Elasticsearch). Индекс префикса служит для идентификации данных экземпляра ПО на сервере журналирования транзакций. Поэтому во избежание конфликтов данных для каждого экземпляра ПО следует указывать собственный префикс индекса.</li>
<li>В конфигурации сервера OpenSearch (Elasticsearch) необходимо создать одного пользователя для <strong>Comindware Platform</strong>.</li>
<li>При инициализации экземпляра ПО или в конфигурации экземпляра необходимо указать пользователя <strong>Comindware Platform</strong>, используемого сервером OpenSearch (Elasticsearch).</li>
<li>Экземпляр ПО будет взаимодействовать с OpenSearch (Elasticsearch) под указанным пользователем и создавать, наполнять и читать индексы с заданным префиксом.</li>
</ul>
</div>
<h2 id="opensearch_permissions_overview">Обзор необходимых разрешений</h2>
<p>Для корректной работы журнала транзакций пользователь <strong>Comindware Platform</strong> в OpenSearch (Elasticsearch) должен иметь перечисленные ниже разрешения.</p>
<h3 id="opensearch_permissions_index_management">Разрешения на управление индексами</h3>
<p>Обеспечивают управление структурой хранилища журналов: создание индексов и обновление сопоставления полей.</p>
<table style="width: 100%;">
<thead>
<tr>
<th style="text-align: left;">Разрешение</th>
<th style="text-align: left;">Описание</th>
<th style="text-align: left;">Применение в Comindware Platform</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>indices:admin/create</code></td>
<td style="text-align: left;">Создание новых индексов</td>
<td style="text-align: left;">Создание индексов при первом запуске</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:admin/data_stream/create</code></td>
<td style="text-align: left;">Создание потоков данных</td>
<td style="text-align: left;">Автоматизированное конвейерное журналирование транзакций</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:admin/mapping/put</code></td>
<td style="text-align: left;">Обновление сопоставлений индекса</td>
<td style="text-align: left;">Изменение структуры данных (например, при обновлении версии Comindware Platform)</td>
</tr>
</tbody>
</table>
<h3 id="opensearch_permissions_read">Разрешения на чтение данных</h3>
<p>Обеспечивают доступ для чтения и поиска записей в журнале транзакций.</p>
<table style="width: 100%;">
<thead>
<tr>
<th style="text-align: left;">Разрешение</th>
<th style="text-align: left;">Описание</th>
<th style="text-align: left;">Применение в Comindware Platform</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>indices:data/read/get</code></td>
<td style="text-align: left;">Получение данных</td>
<td style="text-align: left;">Просмотр конкретной записи о транзакции</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:data/read/search</code></td>
<td style="text-align: left;">Поиск в индексах</td>
<td style="text-align: left;">Базовый поиск</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:data/read/search*</code></td>
<td style="text-align: left;">Все варианты поиска</td>
<td style="text-align: left;">Агрегации, сложные запросы для фильтрации и анализа</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:data/read/search/template</code></td>
<td style="text-align: left;">Использование сохранённых шаблонов</td>
<td style="text-align: left;">Повторные поисковые запросы</td>
</tr>
</tbody>
</table>
<h3 id="opensearch_permissions_pit">Разрешения Point-in-Time</h3>
<p>Обеспечивают создание консистентных снимков при обработке больших объёмов данных.</p>
<table style="width: 100%;">
<thead>
<tr>
<th style="text-align: left;">Разрешение</th>
<th style="text-align: left;">Описание</th>
<th style="text-align: left;">Применение в Comindware Platform</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>indices:data/read/point_in_time/create</code></td>
<td style="text-align: left;">Создание сеанса PIT</td>
<td style="text-align: left;">Для консистентной работы с большими наборами данных</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:data/read/point_in_time/readall</code></td>
<td style="text-align: left;">Чтение всех сеансов PIT</td>
<td style="text-align: left;">Управление активными сеансами Point-in-Time</td>
</tr>
</tbody>
</table>
<h3 id="opensearch_permissions_write">Разрешения на запись данных</h3>
<p>Обеспечивают запись и обновление записей о транзакциях в журнале.</p>
<table style="width: 100%;">
<thead>
<tr>
<th style="text-align: left;">Разрешение</th>
<th style="text-align: left;">Описание</th>
<th style="text-align: left;">Применение в Comindware Platform</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>indices:data/write/index</code></td>
<td style="text-align: left;">Индексирование транзакций</td>
<td style="text-align: left;">Основная операция записи транзакций в журнал</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:data/write/update</code></td>
<td style="text-align: left;">Обновление существующих транзакций</td>
<td style="text-align: left;">Коррекция ошибочных записей</td>
</tr>
<tr>
<td style="text-align: left;"><code>indices:data/write/update/byquery</code></td>
<td style="text-align: left;">Массовое обновление по условию</td>
<td style="text-align: left;">Батч-операции для исправления данных</td>
</tr>
</tbody>
</table>
<h3 id="opensearch_permissions_cluster">Глобальные разрешения кластера</h3>
<p>Обеспечивают базовые возможности работы с индексами на уровне кластера.</p>
<table style="width: 100%;">
<thead>
<tr>
<th style="text-align: left;">Разрешение</th>
<th style="text-align: left;">Описание</th>
<th style="text-align: left;">Применение в Comindware Platform</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>read</code></td>
<td style="text-align: left;">Глобальное чтение на уровне кластера</td>
<td style="text-align: left;">Базовый доступ ко всем операциям чтения</td>
</tr>
<tr>
<td style="text-align: left;"><code>write</code></td>
<td style="text-align: left;">Глобальная запись на уровне кластера</td>
<td style="text-align: left;">Базовый доступ ко всем операциям записи</td>
</tr>
</tbody>
</table>
<h2 id="opensearch_permissions_role_config">Настройка роли для Comindware Platform</h2>
<p>Для пользователя <strong>Comindware Platform</strong> рекомендуется создать отдельную роль с необходимыми разрешениями. Роль должна предоставлять доступ только к индексам с префиксом, указанным в параметре <code>journal.name</code> конфигурации экземпляра ПО.</p>
<h3 id="opensearch_permissions_role_config_api">Создание роли через REST API</h3>
<ol class="colored_numbers_list">
<li>
<p>Создайте роль с необходимыми разрешениями:</p>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--user<span class="w"> </span>&lt;cmwJournalUserName&gt;:&lt;safePassword&gt;<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--cacert<span class="w"> </span>/path/to/root.crt<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>-H<span class="w"> </span><span class="s2">"Content-Type: application/json"</span><span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>https://&lt;openSearchHost&gt;:&lt;port&gt;/_plugins/_security/api/roles/&lt;cmwJournalRole&gt;<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>-d<span class="w"> </span><span class="s1">'{</span></code> <br/><code><span class="s1">    "index_permissions": [{</span></code> <br/><code><span class="s1">      "index_patterns": ["&lt;prefix&gt;*"],</span></code> <br/><code><span class="s1">      "dls": "",</span></code> <br/><code><span class="s1">      "fls": [],</span></code> <br/><code><span class="s1">      "masked_fields": [],</span></code> <br/><code><span class="s1">      "allowed_actions": [</span></code> <br/><code><span class="s1">        "indices:admin/create",</span></code> <br/><code><span class="s1">        "indices:admin/data_stream/create",</span></code> <br/><code><span class="s1">        "indices:admin/mapping/put",</span></code> <br/><code><span class="s1">        "indices:data/read/get",</span></code> <br/><code><span class="s1">        "indices:data/read/search",</span></code> <br/><code><span class="s1">        "indices:data/read/search*",</span></code> <br/><code><span class="s1">        "indices:data/read/search/template",</span></code> <br/><code><span class="s1">        "indices:data/read/point_in_time/create",</span></code> <br/><code><span class="s1">        "indices:data/read/point_in_time/readall",</span></code> <br/><code><span class="s1">        "indices:data/write/index",</span></code> <br/><code><span class="s1">        "indices:data/write/update",</span></code> <br/><code><span class="s1">        "indices:data/write/update/byquery",</span></code> <br/><code><span class="s1">        "indices:data/write*"</span></code> <br/><code><span class="s1">      ]</span></code> <br/><code><span class="s1">    }],</span></code> <br/><code><span class="s1">    "cluster_permissions": [</span></code> <br/><code><span class="s1">      "read",</span></code> <br/><code><span class="s1">      "write"</span></code> <br/><code><span class="s1">    ]</span></code> <br/><code><span class="s1">  }'</span></code> <br/></pre></code></div>
<p>Здесь:</p>
<ul>
<li><code>&lt;prefix&gt;</code> — значение параметра <code>journal.name</code> из конфигурации экземпляра ПО (по умолчанию <code>cmw&lt;instanceName&gt;</code>, где <code>&lt;instanceName&gt;</code> — имя экземпляра ПО);</li>
<li><code>&lt;openSearchHost&gt;:&lt;port&gt;</code> — адрес сервера OpenSearch (Elasticsearch);</li>
<li><code>/path/to/root.crt</code> — путь к сертификату корневого центра сертификации (если используется TLS).</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Если используется несколько экземпляров <strong>Comindware Platform</strong> с разными префиксами индексов, создайте отдельную роль для каждого префикса или используйте шаблон индекса, охватывающий все необходимые префиксы.</p>
</div>
</li>
<li>
<p>Создайте пользователя и назначьте ему роль:</p>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--user<span class="w"> </span>&lt;cmwJournalUserName&gt;:&lt;safePassword&gt;<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--cacert<span class="w"> </span>/path/to/root.crt<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>-H<span class="w"> </span><span class="s2">"Content-Type: application/json"</span><span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>https://&lt;openSearchHost&gt;:&lt;port&gt;/_plugins/_security/api/internalusers/&lt;cmwJournalUserName&gt;<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>-d<span class="w"> </span><span class="s1">'{</span></code> <br/><code><span class="s1">    "password": "&lt;safePassword&gt;",</span></code> <br/><code><span class="s1">    "opendistro_security_roles": ["&lt;cmwJournalRole&gt;"],</span></code> <br/><code><span class="s1">    "backend_roles": [],</span></code> <br/><code><span class="s1">    "attributes": {}</span></code> <br/><code><span class="s1">  }'</span></code> <br/></pre></code></div>
</li>
<li>
<p>Укажите созданного пользователя в конфигурации экземпляра ПО:</p>
<div class="highlight"><span class="filename">Пример конфигурации подключения к OpenSearch (Elasticsearch)</span><code><pre><span></span><code><span class="c1"># Адрес службы журналирования OpenSearch (Elasticsearch).</span></code> <br/><code><span class="nt">journal.server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://&lt;openSearchHost&gt;:&lt;port&gt;</span></code> <br/><code><span class="c1"># Префикс индекса службы журналирования OpenSearch (Elasticsearch).</span></code> <br/><code><span class="c1"># Индекс службы журналирования OpenSearch (Elasticsearch).</span></code> <br/><code><span class="nt">journal.name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;prefix&gt;</span></code> <br/><code><span class="c1"># Имя пользователя службы журналирования</span></code> <br/><code><span class="nt">journal.username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;cmwJournalUserName&gt;</span></code> <br/><code><span class="c1"># Пароль службы журналирования</span></code> <br/><code><span class="nt">journal.password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;safePassword&gt;</span></code> <br/></pre></code></div>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Префикс индекса служит для идентификации записей в БД OpenSearch (Elasticsearch). Если к одному серверу OpenSearch (Elasticsearch) подключается несколько экземпляров Comindware Platform, их префиксы индексов должны отличаться. В противном случае будет нарушена целостность данных в БД OpenSearch (Elasticsearch).</p>
</div>
<div class="notice notice-warning">
<p class="admonition-title">Допустимый префикс индекса</p>
<p>В префиксе индекса допускается использовать только строчные латинские буквы и цифры.</p>
<p>Если в имени префикса будут прописные буквы или спецсимволы (например, дефис), служба журналирования автоматически преобразует их в строчные буквы и символы подчёркивания.</p>
</div>
</li>
</ol>
<h3 id="opensearch_permissions_role_config_dashboards">Создание роли через OpenSearch Dashboards</h3>
<ol class="colored_numbers_list">
<li>Откройте OpenSearch Dashboards и перейдите в раздел <strong>Security</strong> → <strong>Roles</strong>.</li>
<li>Нажмите <strong>Create role</strong>.</li>
<li>Укажите имя роли, например <code>cmwJournalRole</code>.</li>
<li>
<p>В разделе <strong>Index permissions</strong>:</p>
<ul>
<li>В поле <strong>Index</strong> укажите шаблон индекса: <code>&lt;prefix&gt;*</code> (например, <code>cmw&lt;instanceName&gt;*</code>).</li>
<li>В разделе <strong>Index permissions</strong> добавьте следующие разрешения:<ul>
<li><code>indices:admin/create</code></li>
<li><code>indices:admin/data_stream/create</code></li>
<li><code>indices:admin/mapping/put</code></li>
<li><code>indices:data/read/get</code></li>
<li><code>indices:data/read/search</code></li>
<li><code>indices:data/read/search*</code></li>
<li><code>indices:data/read/search/template</code></li>
<li><code>indices:data/read/point_in_time/create</code></li>
<li><code>indices:data/read/point_in_time/readall</code></li>
<li><code>indices:data/write/index</code></li>
<li><code>indices:data/write/update</code></li>
<li><code>indices:data/write/update/byquery</code></li>
<li><code>indices:data/write*</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>В разделе <strong>Cluster permissions</strong> добавьте:</p>
<ul>
<li><code>read</code></li>
<li><code>write</code></li>
</ul>
</li>
<li>
<p>Нажмите <strong>Create</strong>.</p>
</li>
<li>
<p>Перейдите в раздел <strong>Security</strong> → <strong>Internal Users</strong> и создайте пользователя или отредактируйте существующего.</p>
</li>
<li>
<p>В разделе <strong>Mapped users</strong> назначьте созданную роль пользователю.</p>
</li>
</ol>
<h2 id="opensearch_permissions_verification">Проверка конфигурации</h2>
<p>После настройки разрешений проверьте, что пользователь <strong>Comindware Platform</strong> может выполнять необходимые операции для работы журнала транзакций:</p>
<ol class="colored_numbers_list">
<li>
<p>Проверьте доступ к поиску в индексах:</p>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--user<span class="w"> </span>&lt;cmwJournalUserName&gt;:&lt;safePassword&gt;<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--cacert<span class="w"> </span>/path/to/root.crt<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>https://&lt;openSearchHost&gt;:&lt;port&gt;/&lt;prefix&gt;*/_search?size<span class="o">=</span><span class="m">10</span></code> <br/></pre></code></div>
</li>
<li>
<p>Проверьте возможность создания индекса:</p>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--user<span class="w"> </span>&lt;userName&gt;:&lt;safePassword&gt;<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--cacert<span class="w"> </span>/path/to/root.crt<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>https://&lt;openSearchHost&gt;:&lt;port&gt;/&lt;prefix_test_index&gt;</code> <br/></pre></code></div>
<div class="notice notice-info">
<p class="admonition-title">Очистка тестового индекса</p>
<p>Тестовый индекс <code>&lt;prefix_test_index&gt;</code> останется после проверки, так как удаление индексов требует разрешения <code>indices:admin/delete</code>, которое не входит в список необходимых разрешений для работы журнала транзакций.</p>
<p>Для удаления тестового индекса выполните команду <strong>от имени администратора OpenSearch (Elasticsearch)</strong>:</p>
<div class="highlight"><code><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--user<span class="w"> </span>&lt;adminUser&gt;:&lt;safePassword&gt;<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>--cacert<span class="w"> </span>/path/to/root.crt<span class="w"> </span><span class="se">\</span></code> <br/><code><span class="w">  </span>https://&lt;openSearchHost&gt;:&lt;port&gt;/&lt;prefix_test_index&gt;</code> <br/></pre></code></div>
</div>
</li>
</ol>
<div class="notice notice-warning">
<p class="admonition-title">Ошибки доступа</p>
<p>Если при проверке возникают ошибки доступа (например, <code>security_exception</code> или <code>403 Forbidden</code>), убедитесь, что:</p>
<ul>
<li>Роль назначена пользователю корректно.</li>
<li>Шаблон индекса в роли соответствует префиксу, указанному в <code>journal.name</code>.</li>
<li>Все необходимые разрешения добавлены в роль.</li>
<li>Пользователь имеет доступ к кластеру (разрешения <code>read</code> и <code>write</code> на уровне кластера).</li>
</ul>
</div>
<h2 id="opensearch_permissions_security">Рекомендации по безопасности</h2>
<h3 id="opensearch_permissions_security_least_privilege">Принцип наименьших привилегий</h3>
<p>Назначайте пользователю <strong>Comindware Platform</strong> только те разрешения, которые необходимы для журналирования транзакций:</p>
<ul>
<li>Ограничьте доступ только индексами с префиксом экземпляра ПО.</li>
<li>Не предоставляйте разрешения на удаление индексов (<code>indices:admin/delete</code>), если это не требуется.</li>
<li>Не используйте роль с полным доступом (<code>all_access</code>) для пользователя <strong>Comindware Platform</strong>, если это не требуется.</li>
</ul>
<h3 id="opensearch_permissions_security_index_pattern">Ограничение шаблона индексов</h3>
<p>Используйте конкретный префикс индекса в шаблоне роли вместо широкого шаблона (например, <code>*</code>):</p>
<ul>
<li>Правильно: <code>cmw&lt;instanceName&gt;*</code> — доступ только к индексам экземпляра <code>&lt;instanceName&gt;</code>.</li>
<li>Неправильно: <code>*</code> — доступ ко всем индексам.</li>
</ul>
<h3 id="opensearch_permissions_security_tls">Использование TLS</h3>
<p>Используйте HTTPS/TLS для подключения к OpenSearch (Elasticsearch):</p>
<ul>
<li>Настройте сертификаты в конфигурации экземпляра ПО.</li>
<li>Для проверки сертификатов временно установите параметр <code>journal.certificateSkipValidation: false</code>.</li>
</ul>
<div class="relatedTopics">
<h2 id="связанные-статьи">Связанные статьи</h2>
<ul>
<li><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4678">OpenSearch (Elasticsearch). Настройка подключения</a></li>
<li><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=5067">Конфигурация экземпляра ПО</a></li>
<li><a class="autorefs autorefs-internal mkdocs_imported_link" href="../../../../troubleshooting/history_not_logged.html#troubleshooting_history_not_written">Журнал изменений не записывается. Диагностика и исправление</a></li>
</ul>
</div>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></div>