<div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="" kb-tags="" kb-title="">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#1-хост_0-10101010">
<span class="md-ellipsis">
      1. хост_0 10.10.10.10:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#2-хост_1-10101011">
<span class="md-ellipsis">
      2. хост_1 10.10.10.11
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#3-хост_2-10101012">
<span class="md-ellipsis">
      3. хост_2 10.10.10.12
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#для-хост_0">
<span class="md-ellipsis">
      для хост_0
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#для-хост_1">
<span class="md-ellipsis">
      для хост_1
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#для-хост_2">
<span class="md-ellipsis">
      для хост_2
    </span>
</a>
<nav aria-label="для хост_2" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#при-подключении-клиентского-узла-приложения">
<span class="md-ellipsis">
      При подключении Клиентского узла Приложения
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#при-подключении-узла-приложения-тонким-клиентом">
<span class="md-ellipsis">
      При подключении узла Приложения ТОНКИМ КЛИЕНТОМ
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#на-всех-узлах-приложения">
<span class="md-ellipsis">
      На всех узлах Приложения!!!
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#на-хост_0">
<span class="md-ellipsis">
      На хост_0
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<p>Для примера описывается развёртывание кластера Приложения из четырёх узлов на трёх хостах, среди которых:</p>
<h5 id="1-хост_0-10101010">1. хост_0 <code>10.10.10.10</code>:</h5>
<ul>
<li>серверный узел Приложения </li>
<li>дополнительный свободный узел Ignite (ключ <code>-i</code> при установке пререквизитов распакует приложение в директорию <code>/usr/share/ignite</code>)</li>
<li>узел Kafka</li>
</ul>
<h5 id="2-хост_1-10101011">2. хост_1 <code>10.10.10.11</code></h5>
<ul>
<li>серверный узел Приложения</li>
</ul>
<h5 id="3-хост_2-10101012">3. хост_2 <code>10.10.10.12</code></h5>
<ul>
<li>клиентский узел Приложения</li>
</ul>
<p>После установки пререквизитов, сервисов и версии Приложения на хостах выполнить 
- настройку узлов ignite для узлов Приложения и узла Ignite
  Прописать директории и хосты:порты для узла Ignite (подробности есть в инструкциях "Кластер CBAP добавление узла Apache Ignite", "Кластер CBAP с тонким клиентом (ассиметричный)", "Кластер CBAP Отказоустойчивый с балансировщиком на одном хосте")</p>
<ul>
<li>аналогично выполнить настройку узлов Ignite для Узлов Приложения</li>
<li>указать в конфигурации Ignite для клиентского узла Приложения 
  <code>&lt;property name="clientMode" value="true" /&gt;</code></li>
</ul>
<h3 id="для-хост_0">для хост_0</h3>
<p>При установке Пререквизитов указать дополнительный ключ <code>-i</code>. 
Если установке Пререквизитов уже была выполнена перейти в директорию со скриптами пакета пререквизитолв и выполнить
<div class="highlight"><code><pre><span></span><code>bash<span class="w"> </span>prerequisites_install.sh<span class="w"> </span>-i</code> <br/></pre></code></div>
 При выполнении скрипта в директорию <code>/usr/share/ignite</code> будет установлен пакет <code>Apache Ignite</code>
 Для создания и настройки дополнительного узла Apache Ignite необходимо выполнить инструкцию  "Кластер CBAP добавление узла Apache Ignite".</p>
<p>Открыть для редактирования конфигурационный файл <code>Ignite.config</code> серверного узла Приложения и указать в блоке <code>"discoverySpi"</code> хосты и порты будущего кластера</p>
<div class="highlight"><code><pre><span></span><code><span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"discoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localAddress"</span><span class="w"> </span><span class="na">value=</span><span class="s">"10.10.10.10"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPort"</span><span class="w"> </span><span class="na">value=</span><span class="s">"47510"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPortRange"</span><span class="w"> </span><span class="na">value=</span><span class="s">"9"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"ipFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"addresses"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;list&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47520..47529<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.11:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.12:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;/list&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">    </span><span class="nt">&lt;/property&gt;</span></code> <br/></pre></code></div>
<p>Открыть для редактирования конфигурационный файл <code>Ignite.config</code> дополнительного узла <code>Apache Ignite</code> и указать в блоке <code>"discoverySpi"</code> хосты и порты будущего кластера</p>
<div class="highlight"><code><pre><span></span><code><span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"discoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localAddress"</span><span class="w"> </span><span class="na">value=</span><span class="s">"10.10.10.10"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPort"</span><span class="w"> </span><span class="na">value=</span><span class="s">"47520"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPortRange"</span><span class="w"> </span><span class="na">value=</span><span class="s">"9"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"ipFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"addresses"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;list&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47520..47529<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.11:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.12:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;/list&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">    </span><span class="nt">&lt;/property&gt;</span></code> <br/></pre></code></div>
<p>Обратить внимание на значения "localPort" в обоих конфигурационных файлах</p>
<h3 id="для-хост_1">для хост_1</h3>
<p>Открыть для редактирования конфигурационный файл <code>Ignite.config</code> серверного узла Приложения и указать в блоке <code>"discoverySpi"</code> хосты и порты будущего кластера</p>
<div class="highlight"><code><pre><span></span><code><span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"discoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localAddress"</span><span class="w"> </span><span class="na">value=</span><span class="s">"10.10.10.11"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPort"</span><span class="w"> </span><span class="na">value=</span><span class="s">"47510"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPortRange"</span><span class="w"> </span><span class="na">value=</span><span class="s">"9"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"ipFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"addresses"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;list&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47520..47529<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.11:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.12:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;/list&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">    </span><span class="nt">&lt;/property&gt;</span></code> <br/></pre></code></div>
<h3 id="для-хост_2">для хост_2</h3>
<h4 id="при-подключении-клиентского-узла-приложения">При подключении Клиентского узла Приложения</h4>
<p>Открыть для редактирования конфигурационный файл <code>Ignite.config</code> серверного узла Приложения и указать в блоке <code>"discoverySpi"</code> хосты и порты будущего кластера, а так-же указать клиентский режим работы</p>
<div class="highlight"><code><pre><span></span><code><span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"discoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localAddress"</span><span class="w"> </span><span class="na">value=</span><span class="s">"10.10.10.12"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPort"</span><span class="w"> </span><span class="na">value=</span><span class="s">"47510"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"localPortRange"</span><span class="w"> </span><span class="na">value=</span><span class="s">"9"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"ipFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">"org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"addresses"</span><span class="nt">&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;list&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.10:47520..47529<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.11:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">                </span><span class="nt">&lt;value&gt;</span>10.10.10.12:47510..47519<span class="nt">&lt;/value&gt;</span></code> <br/><code><span class="w">              </span><span class="nt">&lt;/list&gt;</span></code> <br/><code><span class="w">            </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">          </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">        </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">      </span><span class="nt">&lt;/bean&gt;</span></code> <br/><code><span class="w">    </span><span class="nt">&lt;/property&gt;</span></code> <br/><code><span class="w">    </span>...</code> <br/><code><span class="w">    </span>...</code> <br/><code><span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"clientMode"</span><span class="w"> </span><span class="na">value=</span><span class="s">"true"</span><span class="w"> </span><span class="nt">/&gt;</span></code> <br/></pre></code></div>
<h4 id="при-подключении-узла-приложения-тонким-клиентом">При подключении узла Приложения ТОНКИМ КЛИЕНТОМ</h4>
<p>Для работы экземпляра Приложения на <code>хост_2</code> в режиме тонкого клиента необходимо дописать в конфигурацию окружения сервиса Приложения соответствующие строки.
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/etc/sysconfig/comindware&lt;instanceName&gt;-env</code> <br/></pre></code></div></p>
<p>добавить:
<div class="highlight"><code><pre><span></span><code><span class="n">PLATFORM_USE_THIN_CLIENT</span><span class="o">=</span><span class="n">y</span></code> <br/><code><span class="n">PLATFORM_THIN_CLIENT_ENDPOINTS</span><span class="o">=&lt;</span><span class="n">host1</span><span class="o">&gt;:</span><span class="m">10800</span><span class="p">,</span><span class="o">&lt;</span><span class="n">host2</span><span class="o">&gt;:</span><span class="m">10800</span></code> <br/></pre></code></div></p>
<p>Где <code>&lt;host1&gt;</code> и <code>&lt;host2&gt;</code> -  имена хостов или IP узлов 1 и 2</p>
<h3 id="на-всех-узлах-приложения">На всех узлах Приложения!!!</h3>
<ul>
<li>в <code>.yml</code> файлах конфигурации узлов Приложения удалить/закомментировать следующие строки
<div class="highlight"><code><pre><span></span><code>isContainerEnvironment:</code> <br/><code>clusterNodes:</code> <br/><code>db.holdLock: true</code> <br/></pre></code></div></li>
</ul>
<h3 id="на-хост_0">На хост_0</h3>
<p>Распаковать и перенести в целевые директории на первом серверном узле Приложения Резервную копию Приложения, 
Запустить Первый узел 
<div class="highlight"><code><pre><span></span><code>systemctl<span class="w"> </span>stop<span class="w"> </span>apigateway&lt;instanceName&gt;<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>comindware&lt;instanceName&gt;<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>adapterhost&lt;instanceName&gt;</code> <br/></pre></code></div>
После обновления запустится экземпляр Приложения</p>
<p>Проверить статус сервисов
<div class="highlight"><code><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>apigateway&lt;instanceName&gt;<span class="w"> </span>comindware&lt;instanceName&gt;<span class="w"> </span>adapterhost&lt;instanceName&gt;</code> <br/></pre></code></div></p>
<p>В директории базы данных первого узла создать файл <code>hold.lock</code> для запуска ребалансировки</p>
<p>Переключиться на вывод лога <code>igniteClient*.log</code></p>
<p>Дождаться сообщения об окончании ребалансировки кластера
<div class="highlight"><code><pre><span></span><code> ... INFO      Skipping rebalancing (nothing scheduled) ...</code> <br/></pre></code></div>
После чего удалить из директории базы данных файл <code>hold.lock</code> и снова открыть на вывод журнал состояния экземпляра</p>
<div class="highlight"><code><pre><span></span><code>rm<span class="w"> </span>/var/lib/comindware/&lt;instanceName&gt;/Database/hold.lock</code> <br/></pre></code></div>
<p>Дождаться загрузки страницы входа в веб-браузере, выполнить вход в систему</p>
<p>Убедиться в работоспособности узла.</p>
<p>Повторить для второго серверного узла Приложения</p>
<p>Запустить дополнительный узел Ignite</p>
<p>Проверить состояние топологии кластера Ignite при  помощи <code>bash /usr/share/ignite/bin/control.sh --baseline</code>
```</p>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>