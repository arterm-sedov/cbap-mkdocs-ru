---
title: Кнопки
kbId: 4790
tags:
    - кнопки
    - настройка кнопки
    - операции
hide: tags
---

# Кнопки. Определение, настройка, удаление  {: #buttons}

<div class="admonition question" markdown="block">

## Определения {: .admonition-title #definitions}

- **Кнопка** представляет собой визуальный элемент на форме, при нажатии которого выполняется предварительно настроенная операция.
- Для каждого шаблона предусмотрен отдельный набор кнопок.
- Названия, цвета и значки кнопок [настраиваются в **области кнопок**][button_area].
- Для каждой формы или таблицы можно настроить особые названия, значки и цвета кнопок.

</div>

## Настройка кнопки {: #button_configure}

Конструктор кнопки позволяет настроить её внешний вид, поведение и операцию, выполняющуюся при её нажатии.

Цвет и значок кнопки [настраиваются в **области кнопок**][button_area].

1. Откройте шаблон.
2. Выберите вкладку «**Кнопки**».
3. Отобразится список кнопок в составе шаблона.
4. Нажмите кнопку «**Создать**» или дважды нажмите кнопку в списке.
5. Отобразится конструктор кнопки.
6. Настройте параметры кнопки на следующих вкладках:

    - [**Свойства**](#свойства)
    - [**Скрипт**](#скрипт)
    - [**Условие отображения**](#условие-отображения)
    - [**Локальные переменные**](#button_local_variables)
    - [**Связи**](#связи)

7. Нажмите кнопку «**Сохранить**».

_![Список кнопок в составе шаблона](img/button_list.png)_

### Свойства

На вкладке «**Свойства**» можно настроить основные параметры кнопки.

_![Конструктор кнопки — вкладка «Свойства»](img/button_designer.png)_

- **Отображаемое название** — подпись, которая будет отображаться на кнопке. Изменение отображаемого названия кнопки в [области кнопок][button_area], на форме или в таблице не повлияет на название исходной кнопки в шаблоне.
- **Системное имя** — уникальное имя кнопки для использования в сценариях, выражениях и скриптах.
- **Описание** — наглядное описание назначения кнопки. Описание кнопки отображается как подсказка при наведении указателя мыши на кнопку. Изменение описания кнопки в [области кнопок][button_area], на форме или в таблице не повлияет на описание исходной кнопки в шаблоне.
- **Контекст операции** — определяет набор доступных операций, контекст выполнения операции и возможность использования кнопки на соответствующих формах и таблицах.
{: #operationContext}
    - **Аккаунт** — запись в **[шаблоне аккаунта][account_templates]**.
    - **Диаграмма** — диаграмма процесса.
    - **Запись** в **шаблоне [записи][record_templates]**, **[аккаунта][account_templates]**, **[роли][role_templates]** или **[организационной единицы][organizational_unit_templates]**.
    - **Пользовательская задача** — элемент диаграммы процесса.
    - **Процесс** — экземпляр или **[шаблон процесса][process_templates]**.
- **Операция** — набор доступных операций зависит от выбранного [**контекста операции**](#operationContext). Операции выполняются с **записями** в **шаблонах [записей][process_templates]**. Предусмотрены следующие операции:
    - **Архивировать** — архивирование выбранных записей или экземпляров процесса: установка для системного атрибута **\_isDisabled**значения `true`.
    - **Вызвать событие «Нажата кнопка»** — при нажатии кнопки сработает событие «**Нажата кнопка**», по которому может быть запущен сценарий в приложении.
    - **Запустить процесс** — запуск экземпляра выбранного шаблона процесса по текущей записи или по новой записи.
    {: #launchProcess}
    - **Запустить процесс по связанному шаблону** — запуск экземпляра процесса по выбранному шаблону записи, связанному с текущим шаблоном записи посредством атрибута типа «**Запись**». В отличие от операции «**Запустить процесс**», после запуска процесса в указанный атрибут будет помещена ссылка на созданную запись. После выбора шаблона становится доступно поле выбора формы для создания записи.
    {: #launchLinkedProcess}
    - **Мигрировать** — обновление экземпляра процесса до последней версии диаграммы процесса. (Эта операция работает не во всех версиях **{{ productName }}**.)
    - **Скрипт C#** — выполнение скрипта C#. Скрипт может выполнять любые действия с использованием API и библиотек, доступных в **{{ productName }}**. См. [_«Написание скриптов на языке C#. Скрипт операции»_][csharp_guide].
    {: #csharpScript}
    - **Создать** — создание записи в выбранном шаблоне. После выбора шаблона становится доступно поле выбора формы для создания записи.
    {: #createRecord}
    - **Создать связанную запись** — создание записи в шаблоне записи, связанном с текущим шаблоном посредством атрибута типа «**Запись**». В отличие от операции «**Создать**», после создания записи ссылка в указанный атрибут будет помещена ссылка на созданную запись. После выбора шаблона становится доступно поле выбора формы для создания записи.
    {: #createLinkedRecord}
    - **Создать токен** — создание нового токена на выбранном элементе диаграммы экземпляра процесса.
    - **Сохранить** — сохранение текущей записи.
    - **Остановить процесс** — остановка текущего экземпляра процесса.
    - **Открыть заново** — назначение задаче статуса «**Выполняется**».
    - **Завершить задачу** — завершение текущей задачи бизнес-процесса.
    - **Отвязать от шаблона** — исключение выбранного аккаунта из текущего шаблона аккаунта.
    - **Отложить выполнение** — эта операция будет реализована в последующих версиях продукта.
    - **Привязать к шаблону** — добавление выбранных аккаунтов в текущий шаблон аккаунта.
    - **Принять** — назначение текущего аккаунта исполнителем задачи.
    - **Разархивировать** — разархивирование выбранных записей или экземпляров процесса: установка для системного атрибута **\_isDisabled**значения `false`.
    - **Редактировать** — изменение диаграммы процесса.
    - **Удалить** — безвозвратное удаление записи или экземпляра процесса.
    - **Экспорт записи** — экспорт записи посредством [шаблона экспорта][export_templates] в формате DOCX, XLSX или PDF.
    {: #exportRecord}
    - **Экспорт таблицы** — экспорт данных из таблицы в формате XLSX с использованием текущих параметров фильтрации, сортировки, группировки и агрегации.
    {: #exportTable}

- **Сохранять запись после выполнения** — установите этот флажок, чтобы сохранять текущую запись после выполнения операции по нажатию кнопки.
- **Пропускать проверки** — установите этот флажок, чтобы вводе и сохранении данных записи не выполнялись проверки данных и не выводились сообщения об ошибках проверки.
- **Результат выполнения** — выберите действие, которое необходимо осуществить после выполнения операции:
    - **Обновить данные** — перезагрузка данных формы или таблицы.
    - **Скачать документ** — браузер загрузит файл, сформированный операцией «[**Экспорт записи**](#exportRecord)», «[**Экспорт таблицы**](#exportTable)» или «[**Скрипт C#**](#csharpScript)».

    !!! note "Примечание"

        Для операции «**Скрипт C#**» скачиваемый файл задаётся выходным параметром `File` скрипта. См. *«[Написание скриптов на языке C#. Скрипт операции][csharp_guide]»*.

    - **Навигация** — переход к объекту, указанному в поле «**Переход к**»:
        - **Диаграмма** — переход к диаграмме экземпляра процесса.
        - **Задача запущенного процесса** — переход к текущей **[пользовательской задаче][process_diagram_elements_user_task].
        - **Предыдущая страница** — переход к предыдущей странице, открытой в браузере.
        - **Рабочий стол**— переход **[рабочему столу][desktop_setup]** для текущего аккаунта.
        - **Связанная запись** — переход к созданной записи (для операций «[**Создать запись**](#createRecord)» и «[**Создать связанную запись**](#createLinkedRecord)»).
        - **Следующая задача в списке** — переход к следующей (по ID) **[пользовательской задаче][process_diagram_elements_user_task]**экземпляра процесса, назначенной текущему аккаунту.
        - **Список задач** — переход к странице «**[Мои задачи][my_tasks_page_configure]**» для текущего аккаунта.
        - **Таблица** — переход к таблице с записями шаблона или экземплярами процесса.
        - **Экземпляр процесса** — переход к [диаграмме экземпляра процесса][process_diagram_view_instance].

    !!! note "Примечание"

        Для операции «[**Скрипт C#**](#csharpScript)» объект навигации задаётся выходным параметром `NavigationResult` скрипта. См. *«[Написание скриптов на языке C#. Скрипт операции][csharp_guide]»*.

- **Установить режим доступа к форме** — задайте режим доступа
{: #setAccessMode}
    - **Чтение** — при нажатии кнопки форма станет доступна только для чтения. При этом на форме обязательно должна быть кнопка, устанавливающая режим доступа к форме «**Редактирование**», в противном случае переключение режима переходить не будет. Кроме того, при такой настройке форма по умолчанию будет отображаться в режиме «**Чтение**».
    - **Редактирование** — нажав кнопку, пользователь сможет вводить данные в форму (при наличии соответствующих разрешений).
    - **Не изменять** — использование исходного режима доступа к форме.
- **Показывать кнопку** — задайте видимость кнопки на форме (этот пункт следует использовать в сочетании с пунктом «[**Установить режим доступа к форме**](#setAccessMode)»).
    - **В режиме редактирования** — кнопка будет отображаться только в режиме ввода данных в форму.
    - **В режиме чтения** — кнопка будет отображаться, когда форма доступна только для чтения (в том числе, запрещено одновременное редактирование формы несколькими пользователями).
    - **Всегда** — кнопка будет отображаться в режиме ввода данных и только чтения.
- **Отображать диалоговое окно** — если установлен этот флажок, при нажатии кнопки откроется предварительно настроенное окно подтверждения операции.
    - **Настроить диалоговое окно** — переход к [**конструктору формы**][buttons] операции, на которое можно перетащить локальные переменные.

_![Конструктор диалогового окна операции с локальной переменной](img/button_designer_dialogue_designer.png)_

### Скрипт {: .pageBreakBefore }

На вкладке «**Скрипт**» можно ввести скрипт на языке C#, который будет выполняться при нажатии кнопки.

Скрипт на C# может выполнять любые действия для контроля, чтения, изменения и удаления данных внутри системы, а также для вызова внешних сервисов в ограниченном пространстве подключаемых библиотек.

Скрипт на С# можно использовать для операции «**Экспорт записи**» с целью подготовки данных для шаблона экспорта. Cм. [_«Настройка шаблона экспорта с использованием C#»_][export_template_csharp_configure] и [_«Подготовка файла шаблона экспорта»_][export_template_file_configure].

Чтобы сформировать заготовку скрипта C# нажмите кнопку «**Сформировать шаблон C#**».

#### Заготовка скрипта

``` cs
public class Script {
  public static UserCommandResult Main (UserCommandContext userCommandContext, Comindware.Entities entities) {
    // Тело скрипта
  }
}
```

#### Входные данные

Скрипт получает на вход в данные контекста в объектах `userCommandContext` и `entities`:

``` cs
UserCommandContext userCommandContext {
  string[] ObjectIds, // массив ID выбранных записей в списке
           // (пустой массив, если записи не выбраны)
           // или массив из одного элемента с ID записи на форме
  string[] SelectedIds, // массив ID записей, выбранных в таблице на форме
           // (пустой массив, если записи не выбраны)
  string CurrentUserId, // ID аккаунта текущего пользователя
  string DocumentTemplateId, // ID шаблона, к которому относится команда
  dateTime CurrentRequestTime, // дата и время текущего запроса
  bool ExportAsPdf, // флаг экспорта в PDF
  string FileName, // имя файла при выгрузке данных по шаблону экспорта
  DatasetQuery Query // список, с которого произошел запуск операции
},
Comindware.Entities entities // используется для доступа к данным шаблонов записей
```

#### Выходные данные {: .pageBreakBefore }

Метод `Main` должен возвращать объект `UserCommandResult`:

``` cs
UserCommandResult {
  bool Success, // флаг успешного завершения операции
  bool Commited, // флаг необходимости сохранения результатов работы операции
  enum UserCommandResultType ResultType, // тип возвращаемого результата.
  // В зависимости от значения производятся действия:
      // DataChange — обновление данных
      // Notificate — сообщение пользователю
      // Navigate — переход на страницу
      // File — скачивание файла

  // набор данных для перехода на другую страницу
  UserCommandNavigationResult NavigationResult {
    string Title, // заголовок
    string ObjectId, // ID объекта
    string ContainerId, // ID контейнера
    ContextType Context // тип отображения
      // Undefined, Void, Any, Task, Case, Record, Process, List, Form, Page, Container
  },

  // объект выгружаемого файла
  UserCommandFileResult File {
    string Name, // имя файла
    string Type,
    byte[] Content // тело файла
  },

  // сообщение для пользователя об окончании операции
  UserCommandMessage[] Messages {
    enum Severity, // уровень важности сообщения
      // SeverityLevel (Critical, Fatal, Low, Major, None, Normal)
    string Text
  }
}
```

_![Конструктор кнопки — вкладка «Скрипт» с заготовкой скрипта C#](https://kb.comindware.ru/assets/button_designer_script_copy1.png)_

### Условие отображения {: .pageBreakBefore }

На вкладке «**Условие отображения**» можно задать формулу или выражение на N3. Кнопка будет отображаться, если формула или выражение на N3 вернёт `true`. В противном случае кнопка будет скрыта.

Если задано **условие отображения**, то для отображения кнопки в таблице должна быть выбрана хотя бы одна запись и **условие отображения** должно возвращать `true` для всех выбранных записей. То есть кнопка не будет отображаться в таблице, если в ней не выбрана ни одна запись или для любой из выбранных записей **условие отображения** возвращает `false`.

_![Конструктор кнопки — вкладка «Условие отображение» с формулой](img/button_designer_display_condition.png)_

#### Примеры условий отображения кнопки

Ниже представлены примеры условий отображения кнопки на [языке формул Comindware][formula_introduction].

!!! note "Примечание"

    При составлении выражений учитывайте [контекст][formula_context] их вычисления.

1. Формула для отображения кнопки на форме или в таблице шаблона записи при условии, что [логический атрибут][attribute_boolean] имеет значение `true`:

    ``` cs
    $LogicAttributeSystemName == true
    ```

    **Здесь:** `LogicAttributeSystemName` — системное имя логического атрибута.

2. Формула для отображения кнопки в таблице любого шаблона при условии, что в таблице выбрана хотя бы одна запись (то есть установлены флажки выбора в первом столбце таблицы):

    ``` cs
    true
    ```

3. Формула для отображения кнопки на [стартовой форме или форме пользовательской задачи][process_diagram_forms] при условии, что логический атрибут записи, связанной с экземпляром процесса, имеет значение `true`:

    ``` cs
    $cmw.task.objectId -> op.1 == true
    ```

    **Здесь:**

    - `$cmw.task.objectId` — идентификатор связанной с экземпляром процессом записи, где хранится логический атрибут;
    - `op.1` — идентификатор логического атрибута в шаблоне записи, связанном с шаблоном процесса.

### Локальные переменные {: #button_local_variables .pageBreakBefore }

На вкладке «**Локальные переменные**» можно создать переменные для использования в скрипте C# или сценарии, выполняемом при нажатии кнопки.

В сценарии по нажатию кнопки локальные переменные будут доступны в объекте `dialogVariables`. См. _«[Переменные в сценарии][scenario_variables]»_.

Локальные переменные представляют собой [атрибуты][attributes].

Пример использования локальной переменной см. в статье _«[Использование локальной переменной для массовой обработки записей][example_n3_button_local_variable]»_.

Для каждой переменной можно задать:

- **Отображаемое название** — наглядное название переменной;
- **Тип данных** — для переменных предусмотрены [такие же типы, как для атрибутов][attributes];
- **Формат отображения** — для переменных предусмотрены [такие же форматы отображения, как для атрибутов][attributes];
- **Системное имя** — уникальное имя переменной для использования в сценариях, выражениях и скриптах;
- **Описание** — наглядное описание назначения переменной;
- **Шаблон** — можно задать для переменных следующих типов: «**[Запись][attribute_record]**», «**[Аккаунт][attribute_account]**», «**[Роль][attribute_role]**», «**[Организационная единица][attribute_organizational_unit]**»;
- **Хранить несколько значений** — этот флажок можно установить для переменных следующих типов: «**Файл**» (см. типы атрибутов «**[Документ][attribute_document]**» и «**[Изображение][attribute_image]**»), «**[Запись][attribute_record]**», «**[Аккаунт][attribute_account]**», «**[Роль][attribute_role]**», «**[Организационная единица][attribute_organizational_unit]**».

_![Конструктор кнопки — вкладка «Локальные переменные»](img/button_designer_local_variables.png)_

### Связи {: .pageBreakBefore }

На вкладке «**Связи**» отображается список всех объектов и ресурсов приложения, связанных с кнопкой.

_![Конструктор кнопки — вкладка «Связи»](img/button_designer_relations.png)_

## Удаление кнопки

1. Откройте шаблон.
2. Выберите вкладку «**Кнопки**».
3. Отобразится список кнопок в составе шаблона.
4. Выберите одну кнопку, установив для неё флажок в первом столбце списка.
5. Нажмите кнопку «**Удалить**».
6. Подтвердите удаление.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Области кнопок. Определение, настройка, клонирование, удаление][button_area]_ 

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
