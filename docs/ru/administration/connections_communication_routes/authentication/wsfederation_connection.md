---
title: Аутентификация через WS-Federation
kbTitle: Аутентификация через WS-Federation. Настройка подключения, федеративного сервера и глобальной конфигурации
kbId: 4686
---

# Аутентификация через WS-Federation. Настройка ПО и федеративного сервера {: #wsfederation_connection }

!!! warning "Внимание!"

    Представленные здесь инструкции зависят от конфигурации сторонних систем и окружения, в котором развёрнут экземпляр ПО **{{ productName }}**.

    Описать все возможные варианты и сочетания конфигураций сторонних систем не представляется возможным, поэтому данные инструкции могут не подойти для вашего случая.

    Для корректной настройки конфигурации контроллера домена, экземпляра ПО и компьютеров конечных пользователей следует обратиться за консультацией в службу поддержки **Comindware** по адресу:

    [https://www.comindware.ru/company/contact-us/#tab_support](https://www.comindware.ru/company/contact-us/#tab_support)

## Введение

Здесь представлены инструкции по настройке подключения и экземпляра ПО **{{ productName }}** для использования федеративной аутентификации посредством службы Active Directory Federation Services (ADFS).

Чтобы включить федеративную аутентификацию, необходимо настроить отношение доверия с проверяющей стороной _на стороне федеративного сервера_ (далее — ADFS), настроить подключение к серверу ADFS и установить для соответствующих аккаунтов **способ аутентификации** « **Федеративная аутентификация**».

## Порядок настройки {: .pageBreakBefore }

1. На сервере ADFS настройте отношение доверия с проверяющей стороной:

    - идентификатор проверяющей стороны (relying party identifier): URL-адрес экземпляра ПО **{{ productName }}**;
    - адрес пассивной конечной точки WS-Federation (ws-federation passive endpoint): URL-адрес экземпляра ПО (точка по умолчанию);
    - пользователь утверждений (claims): имя пользователя и (или) почтовый ящик.
    См. статью _«[Создание отношений доверия с проверяющей стороной](https://learn.microsoft.com/ru-ru/windows-server/identity/ad-fs/operations/create-a-relying-party-trust)»_ (документация Microsoft).

2. В конфигурации экземпляра ПО включите федеративную аутентификацию (`<instanceName>` — имя экземпляра ПО):

    **Linux**

    В файле `/usr/share/comindware/configs/instance/<instanceName>.yml` измените директиву `IsFederationAuthEnabled: 0` на `IsFederationAuthEnabled: 1   `

    **Windows**

    В файле `C:\ProgramData\Comindware\Instances\<instanceName>\Config\<instanceName>.yml` измените директиву `IsFederationAuthEnabled: 0` на `IsFederationAuthEnabled: 1   `

3. В экземпляре ПО откройте раздел [«**Администрирование**» — «**Подключения**»][administration] и создайте подключение типа «**Аутентификация через WS-Federation**».

    _![Создание подключения к службе федеративной аутентификации](wsfederation_connection_creation.png)_

4. Настройте свойства нового подключения:

    - **Отключить аутентификацию** — установите этот флажок, если требуется временно деактивировать вход в Систему посредством службы федеративной аутентификации.
    - **Название** — укажите наглядное название подключения.
    - **Поставщик удостоверений** — выберите пункт «**AD FS**».
    - **URL метаданных федерации** — укажите URL метаданных службы федерации, например: `https://adfs.corp,mycompany.ru/federationmetadata/FederationMetadata.xml`
    - **Идентификатор проверяющей стороны** — укажите URL-адрес сервера **{{ productName }}** (такой же идентификатор, как на [шаге 1](#порядок-настройки)).
    - **Домены электронной почты** — список доменов, аккаунтам в которых разрешена аутентификация через данное подключение. Домены можно разделять пробелами, запятыми или точками с запятой.
    - **Группа** — выберите группу, для аккаунтов в которой будет действовать аутентификация через WS-Federation.

    _![Создание канала связи для федеративной аутентификации](wsfederation_connection_new_channel.png)_

5. На странице «[**Администрирование**][administration]» в разделе — «**Администрирование аккаунтов**» выберите пункт «**Аккаунты**» <i class="fa-light  fa-address-card">‌</i>.
6. Установите для соответствующих аккаунтов способ аутентификации «**Федеративная аутентификация**».

    _![Установка метода проверки подлинности «Федеративная аутентификация» в настройках пользователя](wsfederation_connection_account_settings.png)_

7. На странице [«**Администрирование**» — «**Глобальная конфигурация**»][administration] установите «**URL-адрес сервера**», совпадающий с идентификатор проверяющей стороны, см. [пункт 1](#порядок-настройки).

    _![Установка внешнего адреса сервера в глобальной конфигурации](wsfederation_connection_external_server.png)_

8. Перезагрузите экземпляр ПО для инициализации подключения к службе федеративной аутентификации.
9. Если настроено подключение к службе федеративной аутентификации и включена федеративная аутентификация, на странице входа появится кнопка «**Войти с помощью AD FS**».

    _![Страница входа в систему с кнопкой «Войти с помощью AD FS» при настроенной федеративной аутентификации](wsfederation_connection_entry_page.png)_

10. При нажатии кнопки «**Войти с помощью AD FS**» откроется страница входа на сервер ADFS.
11. После успешной аутентификации откроется начальная страница экземпляра ПО.

!!! warning "Внимание!"

    Если пользователь, у которого в аккаунте выбрана федеративная аутентификация, введёт свои учётные данные на исходной странице входа в **{{ productName }}**, а не на странице входа на сервер ADFS, произойдёт ошибка.

!!! note "Примечание"

    Основные шаги аутентификации регистрируются в [журнале аудита][logging_engine_audit_log].

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Глобальная конфигурация][global_configuration]_
- _[Пути и содержимое папок экземпляра ПО][paths]_
- _[Подсистема журналирования][logging_engine]_
- _[Создание отношений доверия с проверяющей стороной](https://learn.microsoft.com/ru-ru/windows-server/identity/ad-fs/operations/create-a-relying-party-trust)_ (документация Microsoft)

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
