---
title: Хранилище S3
tags:
  - подключение
  - подключения
  - AD
  - Active Directory
hide:
  - tags
kbId: 4677
---

# Хранилище S3. Настройка экземпляра ПО и подключения {: #s3_connection}

## Введение

ПО **{{ productName }}** может хранить загруженные пользователями и сформированные системой файлы в хранилище S3:

- файлы, прикреплённые к атрибутам типа «Документ» и «Изображение»;
- файлы, загруженные на странице «Темы»;
- файлы шаблонов экспорта;
- файлы с исходным кодом адаптеров;
- резервные копии экземпляра ПО;
- загруженные файлы изображений для баннеров;
- изображения профилей аккаунтов;
- загруженные изображения фона страниц входа и регистрации;
- временные файлы экземпляра ПО.

Здесь представлены инструкции по настройке конфигурации экземпляра ПО под управлением Linux для подключения к хранилищу S3 с целью хранения файлов в контейнерах (корзинах) S3.

После настройки экземпляра ПО и подключения к хранилищу S3 файлы, загруженные пользователями и сформированные системой будут отправляться в хранилище S3, а в конфигурации резервного копирования можно будет указать контейнер S3 вместо пути на сервере с экземпляром ПО.

## Настройка конфигурации экземпляра ПО {: .pageBreakBefore }

1. Перейдите в режим суперпользователя:

    ```
    sudo -i
    ```

2. Откройте для редактирования файл конфигурации экземпляра ПО:

    ```
    vim /usr/share/comindware/configs/instance/instancename.yml
    ```

    Здесь  `instanceName` — имя экземпляра ПО.

    См. также статью _«[Пути и содержимое папок экземпляра ПО][paths]»._

3.  Добавьте в файл `instanceName.yml` следующие директивы:

    ``` ini
    # Адрес сервера S3 с указанием порта, идентификатор ключа доступа и секретный ключ
    s3Connection.default.endpointURL: http://s3.example.com:9000
    s3Connection.default.accessKey: xxxxx
    s3Connection.default.secretKey: xxxxx
    # Установите значение true, если сервер принимает только запросы path-style вида:
    # https://s3.region-code.amazonaws.com/bucket-name/key-name
    s3Connection.default.pathStyle: true
    s3Connection.default.description: Подключение к S3

    # Параметры контейнера загруженных файлов
    userStorage.type: S3
    userStorage.s3.bucket: user-files-bucket
    userStorage.s3.connection: default

    # Параметры контейнера временных файлов
    tempStorage.type: S3
    tempStorage.s3.bucket: temp-files-bucket
    tempStorage.s3.connection: default
    ```

    !!! warning "Внимание!"

        - Необходимо указать разные контейнеры (корзины) для загруженных файлов и для временных файлов.
        - Имена корзин не должны содержать прописных (заглавных) букв.

4. Перезагрузите экземпляр ПО:

    ```
    systemctl restart comindwareinstancename
    ```

5. Проверьте подключение хранилищу S3 в экземпляре ПО.

## Проверка подключения к хранилищу S3 {: .pageBreakBefore }

1. Перейдите в [список подключений][connections].
2. Дважды нажмите в списке подключение типа «**S3**» (название подключения задаётся директивой `s3Connection.default.description` в [файле конфигурации](#настройка-конфигурации-экземпляра-по)).
3. Просмотрите свойства подключения:
    - **Отключить** — этот флажок установлен, если подключение неактивно;
    - **Название** — наглядное наименование подключения;
    - **Адрес конечной точки** — адрес сервера S3;
    - **Ключ доступа** — идентификатор секретного ключа доступа к серверу S3;
    - **Секретный ключ** — ключ для доступа к серверу S3;
    - **Запросы типа path-style** — флажок установлен, если сервер принимает только запросы path-style вида:

        ```
        https://s3.region-code.amazonaws.com/bucket-name/key-name
        ```

4. Нажмите кнопку «**Проверить соединение**».
    - Должно отобразиться сообщение «**Соединение установлено**».

!!! warning "Внимание!"

    Не вносите изменения в окне свойств подключения к хранилищу S3, заданному в [файле конфигурации](#настройка-конфигурации-экземпляра-по) экземпляра ПО (`/usr/share/comindware/configs/instance/instanceName.yml`) с помощью директивы `s3Connection.default`. Они не будут применены к конфигурации экземпляра ПО и при перезапуске сервера будут заменены на значения из файла конфигурации `instanceName.yml`

    Настраивать подключение к хранилищу S3 следует только в файле `/usr/share/comindware/configs/instance/instanceName.yml`

**![Настройка подключения к хранилищу S3](https://kb.comindware.ru/assets/img_65e9b87a6e895.png)**

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Пути и содержимое папок экземпляра ПО][paths]_

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
