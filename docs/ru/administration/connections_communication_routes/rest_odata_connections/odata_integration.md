---
title: Синхронизация с веб-сервисом. Интеграция по OData
tags:
  - приложение
  - интеграции
  - интеграция по OData
  - OData
  - подключения
  - подключение
  - синхронизация
hide:
  - tags
kbId: 4697
---

# Синхронизация с веб-сервисом. Интеграция по OData {: #odata_integration}

## Введение

**{{ productName }}** поддерживает автоматический и ручной импорт и экспорт данных посредством подключения к внешнему OData-сервису.

Подробные сведения о формате данных OData см. в статье «[**URI Conventions (OData Version 2.0)**](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/)» (официальное руководство по OData, английский язык).

--8<-- "odata_public_server_tip.md"

## Порядок настройки и использования интеграции с внешним сервисом посредством OData

1. [Настройте подключение][odata_connection] типа «**Подключения REST и OData**» — «**Синхронизация с веб-сервисом**».
2. [Настройте конфигурацию](#настройка-конфигурации-интеграции-по-odata) интеграции для импорта или экспорта данных по OData.
3. [Запустите синхронизацию](#запуск-синхронизации-посредством-интеграции) с OData-сервисом.
4. Проверьте результат синхронизации и [журналы интеграции](#журналирование-интеграции).

## Настройка конфигурации интеграции по OData

1. Настройте [подключение к OData-сервису][odata_connection].
2. Откройте приложение из списка [приложений][apps].
3. На странице «**Администрирование**» приложения нажмите пункт «**Интеграции**» <i class="fa-light  fa-sync-alt"></i>.
4. В списке интеграций создайте или откройте имеющуюся интеграцию.
5. Настройте конфигурацию интеграции:

    - [Параметры синхронизации](#настройка-синхронизации)
    - [Параметры импорта данных](#настройка-импорта-данных)
        - [Постпроцессинг](#настройка-постпроцессинга)
    - [Параметры экспорта данных](#настройка-экспорта-данных)

### Настройка синхронизации {: .pageBreakBefore }

Настройте параметры на вкладке «**Основные свойства**».

- **Включить** — установите этот флажок, чтобы задействовать данную конфигурацию интеграции.
- **Название** — введите наглядное название конфигурации интеграции.
- **Подключение по OData** — выберите ранее созданное подключение к OData-сервису.
- **Тип** — выберите направление синхронизации данных:
    - **Импорт** — передача данных из OData-сервиса в приложение;
    - **Экспорт** — передача данных из приложения в OData-сервис.
- **Шаблон записи** — выберите шаблон, с которым будут синхронизироваться данные.
- **Внешняя сущность** — укажите таблицу (набор данных) в OData-сервисе, с которой будут синхронизироваться данные.
- **Синхронизируемые объекты** — выберите, следует ли импортировать все данные или только изменённые:
    - **Все**;
    - **По изменению полей объекта**.
- **Режим запуска** — выберите способ запуска синхронизации:
    - **Вручную** — для [запуска синхронизации](#запуск-синхронизации-посредством-интеграции) потребуется выбрать интеграцию в списке и нажать кнопку «**Запустить синхронизацию**».
    - **По расписанию** — настройте расписание автоматической синхронизации:
        - **Первый запуск**;
        - **Периодичность**;
        - **Дни запуска**;
        - **Интервал запуска**.
        {% include-markdown ".snippets/pdfPageBreakHard.md" %}
- **Сопоставление данных** — задайте соответствие атрибутов **внешней сущности** и атрибутов **шаблона записи** и  укажите **ключевой атрибут**.

    !!! warning "Принцип сопоставления записей по ключевым атрибутам"

        Для синхронизации необходимо выбрать пару ключевых атрибутов, содержащих уникальные значения, по которым будут сопоставляться синхронизируемые записи.

        Если при синхронизации совпадут значения ключевых атрибутов в записи в выбранном шаблоне и во внешней сущности, то:

        - при импорте запись в шаблоне будет обновлена данными из внешней сущности;
        - при экспорте запись во внешней сущности будет обновлена данными из шаблона;

        Если при синхронизации значения ключевых атрибутов не совпадут, будет создана новая запись:

        - в выбранном шаблоне — при импорте;
        - во внешней сущности — при экспорте.

    - В столбце «**Внешний атрибут**» квадратных скобках указаны свойства атрибутов:
        - **[Primary key]** — первичный ключ, по умолчанию выбран в качестве **ключевого атрибута**;
        - **[Not null]** — атрибуты, которые не могут быть пустыми (при экспорте данных необходимо установить соответствие всех внешних и внутренних атрибутов с данным свойством).

_![Настройка свойств интеграции](integrations_configuration_properties.png)_

### Настройка импорта данных {: .pageBreakBefore }

Если на вкладке «**Основные свойства**» выбран импорт данных, настройте параметры на вкладке «**Настройки импорта**»:

- **Зависит от** — укажите интеграцию, синхронизацию по которой необходимо запускать перед запуском синхронизации по данной интеграции. Это может быть необходимо, например, для того, чтобы предварительно обновить данные в связанных шаблонах, к которым требуется привязать синхронизируемые записи.
- **Фильтр** — задайте фильтр данных посредством выражений OData. Синтаксис фильтров см. в статье _«[Использование выражений фильтров в URI для OData][odata-filter-syntax]» (учебник Microsoft, английский язык)_.

    Например, следующий фильтр выбирает записи с порядковым номером (`SequenceNumber`) от `11` до `14`:

    ``` sql
    SequenceNumber gt 10 and SequenceNumber lt 15
    ```

- **Количество объектов в одном запросе** — укажите максимальное количество данных, передаваемых в одном запросе. При превышении этого количества будет формироваться новый запрос к внешнему сервису.
- **Сортировка** — укажите атрибуты и порядок сортировки записей по ним. Выборка импортируемых записей будет выполняться в указанном порядке.
- **Динамический фильтр** — настройте фильтрацию данных по дате и времени. Для этого укажите атрибут типа «**Дата и время**». Значение этого атрибута в импортируемых записях будет сравниваться с датой и временем отправки запроса на синхронизацию за вычетом **интервала фильтра**.
    - **Интервал фильтра** — интервал времени для динамической фильтрации. При выборке записей значение **интервала фильтра** вычитается из даты и времени отправки запроса на синхронизацию (в часовом поясе `UTC+0`).

    !!! warning "Логика работы динамического фильтра"
        - **Динамический фильтр** позволяет импортировать только записи, относящиеся ко времени после определённой даты.
        - **Пример**
            - Для **динамического фильтра** выбран атрибут _«Дата создания»_.
            - **Интервал фильтра** равен `1 д`.
            - Синхронизация началась `05.01.2025` (в часовом поясе `UTC+0`).
            - Импортированы будут записи, у которых _Дата создания_ больше или равна `04.01.2025`.

- **Удалить несуществующие записи** — установите этот флажок, чтобы при синхронизации удалять записи, которые отсутствуют на внешнем сервере.
- **Удалить по условию** — укажите атрибуты и значения, чтобы при синхронизации удалять записи, соответствующие заданным условиям.

_![Настройки импорта данных из OData-сервиса](img/integrations_configuration_import.png)_

#### Настройка постпроцессинга {: .pageBreakBefore }

!!! warning "Логика постпроцессинга"

    Постпроцессинг позволяет привязать импортируемые записи к имеющимся записям в связанном шаблоне.

    В таблице «**Преобразование атрибутов**» необходимо выбрать ключевые атрибуты связанных шаблонов записи, содержащие уникальные идентификаторы записей, которые требуется связать между собой посредством **целевого атрибута**.

    Эти значения будут сравниваться при импорте записей. Если значения ключевых атрибутов в импортируемой записи и в имеющейся записи связанного шаблона совпадут, то эти записи будут связаны посредством выбранного **целевого атрибута**.

1. Нажмите кнопку «**Добавить новую настройку постпроцессинга**».
2. Настройте сопоставление атрибутов между шаблоном записи и OData-сервисом:

    - **Целевой атрибут** — выберите атрибут типа «**Запись**», связанный с **шаблоном записи**, выбранным на вкладке «**Основные свойства**».
    - **Атрибут в выбранном шаблоне** — выберите ключевой атрибут в **шаблоне записи**, выбранным на вкладке «**Основные свойства**» для синхронизации.
    - **Атрибут в связанном шаблоне** — выберите ключевой атрибут шаблона, связанного с **целевым атрибутом**.

_![Настройка постпроцессинга](integrations_configuration_postprocessing.png)_

### Настройка экспорта данных {: .pageBreakBefore }

Если на вкладке «**Основные свойства**» выбран экспорт данных, настройте параметры на вкладке «**Настройки экспорта**»:

- **Удалить записи после экспорта** — установите этот флажок, чтобы при синхронизации удалять экспортированные записи.
- **Экспортировать архивные записи** — установите этот флажок, чтобы при синхронизации экспортировать архивные записи.
- **Фильтр** — укажите атрибуты и значения, чтобы при синхронизации экспортировать только записи, соответствующие заданному фильтру.

_![Настройка экспорта](integrations_configuration_export.png)_

## Запуск синхронизации посредством интеграции

1. Установите один или несколько флажков в списке интеграций.
2. Нажмите кнопку «**Запустить синхронизацию**».
3. Будет запущена синхронизация посредством выбранных интеграций.
4. Результаты синхронизации можно просмотреть в журналах интеграции.

_![Запуск синхронизации](integrations_synchronization_start.png)_

## Журналирование интеграции {: .pageBreakBefore }

### Журнал событий

Журнал сеансов синхронизации посредством интеграций отображается на вкладке «**Интеграция по OData**» в разделе «**Администрирование**» — «**Инфраструктура**» — «**Журналы событий**».

_![Журнал сеансов синхронизации данных по OData](integrations_log.png)_

### Сведения в журнале «Интеграция по OData»

- **Без ошибок** — в этом столбце отображается флажок, если синхронизация выполнена без ошибок.
- **Сеанс** — идентификатор сеанса синхронизации.
- **Событие** — описание события синхронизации. Для просмотра цепочки событий, приведших к событию в журнале, дважды нажмите строку в журнале.
- **Дата** — дата запуска синхронизации.
- **Подключение** — подключение, использованное для синхронизации. Перейдите по этой гиперссылке для просмотра свойств подключения.
- **Конфигурация** — идентификатор конфигурации интеграции. Перейдите по этой гиперссылке для просмотра свойств интеграции.
- **Инициатор** — аккаунт, запустивший синхронизацию. Перейдите по этой гиперссылке для просмотра свойств аккаунта.

### Файловый журнал {: .pageBreakBefore }

При синхронизации посредством интеграции соответствующие события записываются в файл журнала с именем вида: `integration_raw_ГГГГ-ММ-ЧЧ.log`.

_![Файл integration_raw_ГГГГ-ММ-ЧЧ.log в папке журналов](integrations_log_file.png)_

При успешной синхронизации в этом файле будут указаны все синхронизированные объекты. При сбое синхронизации в файл записывается ИД записи, на которой была обнаружена ошибка, и описание ошибки.

_![Содержимое файла integration_raw.log](integrations_log_content.png)_

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Синхронизация с веб-сервисом. Настройка подключения][odata_connection]_
- _[Журнал сеансов синхронизации по OData][logs_odata_inegration]_
- _[Интеграция с 1С по OData. Настройка для импорта данных][1c_integrations]_
- _[Использование выражений фильтров в URI для OData][odata-filter-syntax] (учебник Microsoft, английский язык)_

</div>

{%
include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md"
%}
