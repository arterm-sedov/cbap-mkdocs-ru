---
title: Синхронизация с сервером каталогов (Active Directory)
kbId: 4655
tags:
    - Active Directory
    - LDAP
    - Аккаунты
    - Администрирование
    - Каталоги
    - Сервер каталогов
    - Синхронизация
hide: tags
---

# Синхронизация с сервером каталогов (Active Directory) {: #accounts_dc_sync }

## Механизм синхронизации с сервером каталогов (Active Directory) {: #accounts_dc_sync_mechanism }

Для подключения к серверу каталогов (например, Active Directory (AD)) используется заданное имя или IP адрес сервера.

При необходимости возможно указать номер порта через двоеточие в строке адреса сервера. **{{ productName }}** задаёт авторизованные (IANA) порты для безопасного и небезопасного соединения.

Если сервер поддерживает безопасную передачу данных, укажите LDAPS (LDAP с шифрованием по SSL или TLS) порт 636 для установления данного соединения, в противном случае сервером будет выбран LDAP порт 389.

Так же необходимо указать базовое имя (DN) – запись в директории, из которой будут выполняться поисковые запросы. Базовое DN LDAP похоже на путь в файловой системе, но указывается в следующем порядке: первым – относительное отличительное имя (RDN) и далее поднимается по дереву слева направо. Например, базовое имя (DN) может выглядеть следующим образом: `CN=Иван Иванов, OU=Users, DC=example, DC=com`. Базовое имя ограничивает доступ к серверу каталогов.

**Режимы синхронизации:**

- принудительный — режим, при котором краткосрочные соединения создаются пользователем при нажатии кнопок «**Проверить соединение**», «**Синхронизировать**», «**Получить перечень групп из AD**»;
- событийный — режим, при котором фоновое соединение создаётся один раз при нажатии кнопки «**Сохранить**» и остаётся открытым до следующего изменения настроек. Любое изменение группы на сервере AD (то есть событие) приводит к синхронизации с Системой.
- по расписанию — режим, при котором соединение создаётся каждый раз согласно указанному расписанию.

Все изменения пользователей на сервере AD синхронизируются с Системой только принудительно или по расписанию.

!!! Примечание

    - После смены домена Active Directory во время синхронизации обновятся данные аккаунтов, при этом сохранится привязка аккаунтов к [ролям в приложении][roles] и [системным ролям][system_roles].
    - Если на стороне Active Directory у аккаунта сменилось имя пользователя, в Системе будет создан новый аккаунт.

Система хранит данные о версии загружаемого объекта. При создании повторного соединения, система запрашивает данные, проверяет версию каждого объекта, если она изменилась, то данные синхронизируются.

**Типы синхронизации:**

- синхронизация всех пользователей — в Системе создаются все пользователи, которые состоят в RDN;
- выбор групп для синхронизации — можно выбрать группы, которые состоят в RDN; в Системе создаются группы, подгруппы и аккаунты, состоящие в выбранных группах; в Системе не отображается, что подгруппа состоит в группе.

## Сопоставление атрибутов {{ productName }} и Сервера каталогов {: #accounts_dc_sync_attributes .pageBreakBefore }

!!! warning "Обязательные атрибуты"

    Для корректной синхронизации аккаунтов с **{{ productName }}** на стороне сервера каталогов должны быть обязательно заданы значения следующих атрибутов (они не должны быть пустыми и не должны иметь значение `Null`):
    
    - `sAMAccountName` (Имя пользователя)
    - `userAccountControl` (Включён)
    - `mail` (Адрес эл. почты)
    - `objectSid` (SID)
    - `uSNChanged` (Версия объекта)
    - `distinguishedName` (Уникальное имя)

<table markdown>
<thead>
<tr markdown>
<th>{{ productName }}</th>
<th>Active Directory</th>
</tr>
<tr markdown>
<th>Название</th>
<th>Системное имя</th>
</tr>
</thead>
<tbody markdown>
<tr markdown>
<td markdown>**Имя пользователя**</td>
<td markdown>**sAMAccountName**</td>
</tr>
<tr markdown>
<td markdown>**Включён**</td>
<td markdown>**userAccountControl**</td>
</tr>
<tr markdown>
<td markdown>**Адрес эл.&nbsp;почты**</td>
<td markdown>**mail**</td>
</tr>
<tr markdown>
<td markdown>**SID**</td>
<td markdown>**objectSid**</td>
</tr>
<tr markdown>
<td markdown>**Версия объекта**</td>
<td markdown>**uSNChanged**</td>
</tr>
<tr markdown>
<td markdown>**Уникальное имя**</td>
<td markdown>**distinguishedName**</td>
</tr>
<tr markdown>
<td markdown>Ф.&nbsp;И.&nbsp;О.</td>
<td markdown>displayName</td>
</tr>
<tr markdown>
<td markdown>Имя</td>
<td markdown>givenName</td>
</tr>
<tr markdown>
<td markdown>Должность</td>
<td markdown>title</td>
</tr>
<tr markdown>
<td markdown>Отдел</td>
<td markdown>department</td>
</tr>
<tr markdown>
<td markdown>Офис</td>
<td markdown>physicalDeliveryOfficeName</td>
</tr>
<tr markdown>
<td markdown>Skype</td>
<td markdown>pager</td>
</tr>
<tr markdown>
<td markdown>Руководитель</td>
<td markdown>manager</td>
</tr>
<tr markdown>
<td markdown>Телефон</td>
<td markdown>telephoneNumber</td>
</tr>
<tr markdown>
<td markdown>Фото профиля</td>
<td markdown>thumbnailPhoto</td>
</tr>
<tr markdown>
<td markdown>Язык</td>
<td markdown>preferredLanguage</td>
</tr>
</tbody>
</table>

## Механизм авторизации через сервер каталогов (Active Directory) {: #accounts_dc_sync_authorization .pageBreakBefore }

После ввода адреса эл.&nbsp;почты или имени пользователя и пароля на начальной странице Система идентифицирует аккаунт в собственной базе данных. Если аккаунт существует в базе данных Системы и у него указана проверка подлинности по LDAP или по федеративной аутентификации, то Система посылает запрос в Active Directory или Active Directory Federation Services для аутентификации имени пользователя и пароля. В случае успеха создаётся токен сеанса, который при последующих веб-запросах автоматически передаётся в Систему и позволяет ей получить информацию о текущем пользователе для авторизации запроса. В собственной базе данных Система пароль не хранит.

Если в свойствах аккаунта изменить **Способ аутентификации** на **Локальную аутентификацию**, то авторизация пользователя будет проходить локально. Администратор может сменить пароль аккаунта непосредственно в Системе, в таком случае при последующей синхронизации с Active Directory пароль не будет перезаписан. Пароль хранится в базе данных Системы.

## Настройка подключения к серверу каталогов (Active Directory) {: #accounts_dc_sync_setup }

Инструкции по настройке подключения к серверу каталогов см. в следующих статьях:

<div class="relatedTopics" markdown="block">

{% if completeGuide or userGuide or kbExport %}

**{{ productName }}**

- [Сервер каталогов. Настройка подключения][ad_connection]

**Linux**

- [Аутентификация через Active Directory. Настройка контроллера домена и экземпляра ПО][ad_authentication_configure_dc_instance]
- [Аутентификация через единый вход (SSO). Настройка контроллера домена, экземпляра ПО и компьютера конечного пользователя][sso_authentication_configure]

**Windows**

- [Настройка единого входа (SSO-аутентификации) в ОС Windows][sso_authentication_configure_windows]

{% elif adminGuideLinux %}

- [Сервер каталогов. Настройка подключения][ad_connection]
- [Аутентификация через Active Directory. Настройка контроллера домена и экземпляра ПО][ad_authentication_configure]
- [Аутентификация через единый вход (SSO). Настройка контроллера домена, экземпляра ПО и компьютера конечного пользователя][sso_authentication_configure]

{% elif adminGuideWindows %}

- [Сервер каталогов. Настройка подключения][ad_connection]
- [Настройка единого входа (SSO-аутентификации) в ОС Windows][sso_authentication_configure_windows]

{% endif %}

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
