Презентация "N-Triples EDITED by ARTEM SEDOV 24.07.2023" представляет собой обзорный курс по N-Triples и его использованию в платформе Comindware. Курс состоит из шести уроков, охватывающих концепции онтологий, графов, N-Triples, работу с данными Comindware Elastic Data, запросы N-Triples и их применение в платформе.

### Урок 1. Онтологии в реальном мире

**Онтология** определяется как учение о сущем, бытии и связях между ними, раздел философии, изучающий фундаментальные принципы бытия. В контексте информационных технологий, онтология — это описание множества объектов, их свойств и связей между собой. Окружающий мир состоит из объектов, которые имеют различные характеристики и взаимодействуют между собой.

**Основные принципы онтологического представления:**
*   Объекты представляются **классами**.
*   Классы имеют **свойства**.
*   Классы **взаимодействуют** между собой.
*   Классы имеют **экземпляры**.

В качестве примера приводится человек, владеющий автомобилем. Другой пример – **яблоко** как класс со свойствами "цвет" и "вкус". Человек может "любить" или "иметь" яблоки, что демонстрирует взаимодействие классов. Конкретные яблоки (Яблоко 1, Яблоко 2) и люди (Иван Иванович) являются экземплярами классов.

**Задание 1** предлагает разложить предметы реального мира ("карандаши в пенале") на классы и их свойства. В ходе обсуждения были определены классы "Пенал" и "Карандаш". Свойства для "Пенала" — "материал", "вместимость", "ёмкость"; для "Карандаша" — "цвет", "состояние" (например, острый/тупой), "твёрдость". Определена связь "содержит", где пенал может содержать карандаши, а карандаш принадлежит одному пеналу.

### Урок 2. Введение в графы

**Граф** — это абстрактная фигура, состоящая из **вершин** и **рёбер**, связывающих вершины. Существует множество разновидностей графов: связанные, изолированные, направленные, ненаправленные, полные, неполные, древовидные (планарные). Графы помогают описывать онтологические модели реального мира, разбивая их на парные рёбра, содержащие пару вершин и ребро.

Пример с человеком и автомобилем используется для демонстрации графа:
*   Человек владеет автомобилем (класс).
*   Иван Иванович является Человеком.
*   Volvo является Автомобилем.
*   Иван Иванович владеет Volvo (конкретный экземпляр).
На этом примере **подчеркивается роль направления связи** (например, "владеет" от человека к автомобилю, а не наоборот). Также отмечается, что вершины графа могут представлять как классы, так и конкретные экземпляры, и с точки зрения базы данных, они лежат на одном уровне.

**Задание 2** предлагает создать граф по предметам из предыдущего задания ("карандаши в пенале"). В графе "Пенал" содержит "Карандаш", а конкретный "Синий карандаш" является "Карандашом", и "Пластмассовый пенал" является "Пеналом". Связь "содержится" устанавливается от пенала к карандашу, а также от конкретного пластмассового пенала к конкретному синему карандашу, при этом указывается, что экземпляры "являются" классами.

### Урок 3. N-Triples — что это такое?

**N-Triples** — это **упрощенное текстовое представление графов** в модели **RDF (Resource Description Framework)**. RDF рекомендована Консорциумом всемирной паутины (W3C) для описания данных и метаданных и является частью концепции Семантической паутины, предназначенной для машинной обработки. N-Triples является упрощенным подмножеством нотаций Turtle и Notation3, представляющих модели RDF в компактном и удобном для чтения виде.

Любой триплет представляет собой **тройку: Субъект, Предикат, Объект**. Эта тройка выражает любой блок графа, ограниченный двумя вершинами и направленным ребром.

**Пример преобразования графа в триплеты:**
Граф "Человек владеет Автомобилем" и "Иван Иванович владеет Volvo" преобразуется в N-Triples:
*   `<http://uri/#Человек> <http://uri/#владеет> <http://uri/#Автомобиль>`
*   `<Иван Иванович> <http://uri/#является> <http://uri/#Человек>`
*   `<Вольво> <http://uri/#является> <http://uri/#Автомобиль>`
*   `<Иван Иванович> <http://uri/#владеет> <Вольво>`
Здесь `http://uri/#` используется как универсальный идентификатор ресурса (URI/IRI), а "Иван Иванович" и "Вольво" представлены как литералы или конкретные экземпляры. **Направленность предиката критически важна**: он определяет, кто является субъектом, а кто — объектом.

**Задание 3** предлагает преобразовать граф "карандаши в пенале" в набор триплетов:
*   `пенал содержит карандаш`
*   `синий карандаш является карандаш`
*   `пластмассовый пенал является пенал`
*   `пластмассовый пенал содержит синий карандаш`

### Урок 4. Comindware Elastic Data

База данных Comindware представляет собой **RDF-граф в нотации N-Triple**. Все данные Comindware Elastic Data хранятся в виде **набора триплетов**. Системные метаданные (определения системных классов) хранятся в виде файлов с расширением **.n3**. Прикладные метаданные (ваши шаблоны записей, процессов) и данные (экземпляры) хранятся в единой базе данных в виде набора файлов. Все ссылочные данные проиндексированы для выполнения быстрого поиска.

Презентация приводит примеры внутренних описаний классов Comindware, таких как `UserTask` и `Account`. Эти описания, написанные в N-Triples, показывают, как определяются классы, их свойства (`objectProperty`, `cmw:property`), системные алиасы и методы (функторы), которые вычисляются на лету.

### Урок 5. Запросы N-Triples и как они работают

Запросы N-Triples пишутся аналогично фактам в виде набора триплетов. У запроса есть входные и выходные данные. Запрос выполняется **последовательно сверху вниз по каждому триплету, в итеративном порядке**. Если запрос ничего не вернул, это считается пустым результатом (null). **Ризонер (Reasoner)** — это специальный механизм, выполняющий запросы.

**Основные элементы синтаксиса запросов:**
*   **`#`** — комментарий.
*   **`a`** — принадлежность субъекта к объекту (зарезервированный предикат).
*   **`->`** — присваивание значения.
*   **`@prefix`** — объявление префиксов для длинных URI, делая запросы более читаемыми.
*   **`?`** — объявление переменных.
*   **`.`** — терминатор триплета (каждый триплет должен заканчиваться точкой).
*   **`{}`** — объявление формулы (группирует триплеты, которые выполняются как единое целое и выдают один результат).
*   **`()`** — объявление списка/массива.
*   **`[]`** — неявное использование субъекта.

**Четыре вида запросов:**
1.  `субъект предикат ?` — поиск объекта по заданному предикату и субъекту.
2.  `? предикат объект` — поиск субъекта по заданному предикату и объекту.
3.  `субъект предикат объект` — проверка наличия факта по заданным аргументам (возвращает true/false).
4.  `? предикат ?` — поиск субъекта и объекта по заданному предикату.

**Механизм выполнения запросов:**
Исполнение запроса происходит построчно, сверху вниз. Переменные, определенные в предыдущих строках, принимают значения из **итератора**. Если итератор содержит несколько значений, каждая последующая строка запроса будет выполняться для каждого значения из итератора по очереди. Это напоминает **Loop Join** в реляционных базах данных. **Оптимизация запросов** предполагает начинать с наиболее ограничивающих условий, чтобы минимизировать размер итераторов на ранних этапах выполнения скрипта.

**Полезные конструкции и встроенные функции:**
*   `("tempAlias" "attrAlias") object:findProperty ?p` — возвращает ID атрибута.
*   `once {}` — выходит после первой успешной итерации. Если обернуть весь запрос, он вернет результат, как только будет найден один удовлетворяющий условию.
*   `or {} or {}` — логический оператор ИЛИ. Выполняет выражения последовательно, переключаясь на следующее, если предыдущее не вернуло результат, и выходит после первого успешного выполнения.
*   `if {} then {} else {}` — условный оператор. Важно, что если блок `if` не выполнился, и нет блока `else`, запрос прерывается, и результат будет null.
*   `from {} select ?v -> ?VList` — получение типа Список (собирает значения в массив, который обрабатывается как единое целое, а не итератор).
*   `?list math:sum ?sum` — получение суммы.
*   `assert:count ?c` — выводит количество записей.
*   `{...} assert:union true` — объединение итераторов в один. Если `true` (или любое другое значение кроме `false`) используется как объект, это аналог `UNION ALL`. Для получения уникальных значений используется `assert:distinct`.
*   Функции для работы со строками, такие как `stringComparer sort:stringComparer` для сортировки и `cmwstring:join` для объединения списка в строку, также доступны.

**Примеры запросов:**
*   Получение всех задач на исполнение и сравнение их с искомым литералом (`ivanov_ii`).
*   Использование `once` для нахождения первого магазина в регионе.
*   Использование `or` для получения задач, где пользователь является возможным или назначенным исполнителем.
*   Использование `if` для проверки просроченных задач.
*   Расчёт суммы позиций накладной с помощью `from` и `sum`.
*   Подсчёт уникальных продуктов в позициях накладной с помощью `distinct` и `count`.
*   Объединение контрагентов (грузоотправителя и грузополучателя) с помощью `union`.

**Задание 4** демонстрирует сравнение двух атрибутов с множественными данными. Решение предполагает получение значений каждого атрибута, преобразование их в отсортированные строки и затем сравнение этих строк для определения совпадения всех значений.

**Задание 5** — написать запрос, который показывает количество уникальных контрагентов, указанных в накладной. Решение предполагает объединение всех атрибутов-контрагентов (Плательщик, Грузополучатель, Заказчик) с помощью `union`, затем применение `distinct` для получения уникальных значений и `count` для их подсчета.

### Урок 6. Использование N-Triples в платформе

Запросы N-Triples широко используются в различных разделах платформы Comindware для определения логики и поведения. Входные (`?item`) и выходные (`?value`) параметры запросов меняются в зависимости от контекста использования:
*   **Вычисляемый атрибут:** Вход `?item` (ID текущей записи), выход `?value` (значение атрибута).
*   **Системный фильтр таблицы:** Выход `?item` (ID записей для вывода в таблицу).
*   **Условие отображения кнопки:** Вход `?item` (ID текущей записи), выход `?value` (true/false).
*   **Фильтр на поле формы:** Вход `?item` (ID текущей записи), выход `?value` (искомые записи ID).
*   **Условие применения роли/разрешения:** Вход `?item` (ID текущей записи), выход `?value` (true/false).
*   **Фильтр аккаунтов для переназначения:** Вход `?value` (ID текущего аккаунта), выход `?item` (список ID аккаунтов).
*   **Вычисляемое значение для действия по правилу формы:** Вход `?item`, выход `?value`.
*   **Условие выполнения правила/действия формы:** Вход `?item`, выход `?value` (true/false, или пусто).
*   **Сценарии (изменение контекста, дублирование записей, проверка выражений, изменение значений атрибутов/переменных, повторы):** Вход `?item`, выход `?value` (записи для перехода/дублирования, true/false, значение атрибута/переменной, количество итераций, список объектов).

**Обсуждаемые возможности и ограничения:**
*   **Глобальные функции:** Возможно вызывать из N-Triples для выполнения сложных вычислений (например, преобразование числа в пропись) или интеграции с внешними сервисами. Такие функции могут принимать параметры и возвращать значения, при этом их внутренняя реализация (например, на C#) не важна для N-Triples.
*   **Вычисляемые атрибуты:** **Не хранятся в базе данных**. Их значения вычисляются динамически в момент обращения к ним. На изменения вычисляемых атрибутов нельзя подписаться напрямую; подписываться следует на изменения исходных хранимых атрибутов, от которых они зависят.
*   **Экспортные шаблоны:** Есть два механизма: лоукодный (использующий фигурные скобки как теги) и через C#. При использовании C# необходимо определить структуру класса, который будет передаваться в шаблон, и наполнить его данными с помощью API.
*   **Будущее развитие платформы:**
    *   Планируется внедрение **DMN-таблиц (Decision Model and Notation)**, которые появятся во всех точках применения выражений.
    *   Ведётся работа над улучшением **визуализации процессов (BPMN-редактор)**.
    *   В перспективе рассматривается функционал по **статистике процессов и дашбордам**.
    *   Актуализируется и дополняется **документация**.

В целом, презентация и сопутствующие обсуждения детально раскрывают, как Comindware Elastic Data использует N-Triples как основу для своей графовой базы данных, как строить запросы на этом языке, и где эти запросы применяются в различных компонентах платформы, а также обсуждаются текущие возможности и планы по развитию.