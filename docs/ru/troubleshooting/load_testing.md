---
title: 'Нагрузочное тестирование'
kbTitle: 'Нагрузочное тестирование Comindware Platform'
kbId: 
tags:
  - Apache JMeter
  - load testing
  - нагрузочное тестирование
  - оптимизация
  - производительность
  - тестирование
hide: tags
---

# Нагрузочное тестирование {{ productName }} {: #load_testing }

## Введение {: #load_testing_intro }

Нагрузочное тестирование — это критически важный этап подготовки приложений к промышленной эксплуатации. Оно позволяет заблаговременно выявить узкие места системы и обеспечить надёжную работу приложений под нагрузкой.

## Цели тестирования {: #load_testing_goals }

### Технические цели {: #load_testing_goals_technical }

- Определить максимальную пропускную способность системы и количество одновременных пользователей, которое она может обрабатывать без нарушения требований к производительности.
- Выявить узкие места в архитектуре приложения, конфигурации серверов и инфраструктурных службах.
- Проверить корректность работы системы при пиковых нагрузках и стрессовых сценариях.
- Измерить время отклика ключевых операций и убедиться, что оно соответствует установленным нормам.
- Оценить потребление системных ресурсов (процессор, память, сеть, диск) под нагрузкой.

### Бизнес-цели {: #load_testing_goals_business }

- Обеспечить бесперебойную работу критически важных бизнес-процессов в пиковые периоды.
- Подтвердить готовность системы к промышленной эксплуатации и определить оптимальную конфигурацию оборудования.
- Минимизировать риски простоев и потери данных.
- Получить количественные метрики для планирования ресурсов и масштабирования системы.

## Ожидаемые результаты {: #load_testing_outcomes }

### Технические результаты {: #load_testing_outcomes_technical }

- Значения ключевых метрик производительности системы:
  - **время отклика** — время выполнения типовых операций (открытие таблицы, сохранение формы, запуск процесса);
  - **пропускная способность** — количество запросов в секунду, которое система обрабатывает без перебоев;
  - **процент ошибок** — доля неуспешных запросов при заданной нагрузке;
  - **загрузка ресурсов** — потребление ресурсов ЦП, оперативной памяти, операций дискового ввода-вывода, сетевого трафика.
- Выявленные узкие места и рекомендации по их устранению.
- Рекомендуемые значения параметров конфигурации для достижения целевой производительности.

### Бизнес-результаты {: #load_testing_outcomes_business }

- Обоснование выбора конфигурации оборудования для промышленной эксплуатации.
- Подтверждение соответствия системы требованиям к производительности и масштабируемости.
- Базовые показатели для последующего мониторинга и сравнения при изменениях в системе.
- Уверенность в стабильной работе системы при ожидаемой и пиковой нагрузке.

## Порядок нагрузочного тестирования {: #load_testing_sequence }

- [Развернуть](#load_testing_deployment) **{{ productName }}** в конфигурации, близкой к продуктовой (согласно рассчитанному сайзингу).
- [Установить](#load_testing_jmeter_install) Java 8+ и Apache JMeter.
- [Скачать и настроить](#load_testing_jmeter_config) файл конфигурации JMeter: указать параметры подключения, количество пользователей, интервал запуска, количество итераций.
- [Создать тестовые сценарии](#load_testing_jmeter_scenarios): добавить контроллеры транзакций и HTTP-запросы для типовых операций.
- [Получить пути и тела тестовых запросов](#load_testing_jmeter_get_request) из браузера (с помощью инструментов разработчика).
- [Настроить тестовую среду](#load_testing_execution): добавить параметр `isTestEnvironment: true` в файл конфигурации системы.
- [Запустить нагрузочное тестирование](#load_testing_execution) и собрать результаты.
- [Проанализировать метрики](#load_testing_outcomes): время отклика, пропускную способность, процент ошибок, загрузку ресурсов.
- Выгрузить и проанализировать журналы системы.
- [Удалить параметр тестовой среды](#load_testing_execution) после завершения тестирования.

## Развертывание {{ productName }} {: #load_testing_deployment }

Перед нагрузочным тестированием разверните **{{ productName }}**.

Конфигурация системы должна быть продуктовой или близка к ней (согласно [рассчитанному сайзингу][system_requirements]).
Это позволит получить более точные результаты и провести дальнейшую аналитику журналов.

См.:

<div class="relatedTopics" markdown="block">

- [Установка, запуск, инициализация и остановка ПО в Linux][deploy_guide_linux]
- [Установка, запуск, инициализация и остановка ПО в Windows][deploy_guide_windows]
- [Системные требования {{ productName }}][system_requirements]
- [Факторы, влияющие на производительность. Рекомендации по оптимизации][performance_optimize]

</div>

## Установка и настройка Apache JMeter {: #load_testing_jmeter_setup }

1. Установите ПО Java 8+.
2. Скачайте и распакуйте в любую папку архив Apache JMeter [с официального сайта][jmeter_download].
3. Скачайте готовый файл конфигурации Apache JMeter: [`jmeter-example-settings.jmx`](assets/jmeter-example-settings.jmx).
4. Запустите JMeter и откройте файл `jmeter-example-settings.jmx` с помощью меню **File** — **Open**.
5. В разделе **Test Plan** укажите свои параметры:

    - `SRV_HOST` — адрес экземпляра **{{ productName }}**;
    - `SOTRUDNIK_LOGIN` — имя пользователя **{{ productName }}**;
    - `SOTRUDNIK_PASSWORD` — пароль;
    - `AccountsCount` и `ReadAcc` — количество пользовательских сеансов, которое требуется запустить;
    - `ramp_up` — интервал в миллисекундах между запуском сеансов;
    - `iterations` — количество итераций прогона теста.

## Настройка тестовых сценариев в Apache JMeter {: #load_testing_jmeter_scenarios }

Готовый файл конфигурации `jmeter-example-settings.jmx` содержит примеры следующих сценариев тестирования:

- открыть таблицу (список);
- сохранить форму с заполненными данными;
- нажатие кнопки для выбранных записей в таблице.

По образцу этих примеров настройте собственные сценарии:

1. В разделе **Test Plan** создайте копию группы тестов (**Thread Group**): нажмите группу правой кнопкой мыши и выберите пункт **Duplicate**.
2. Создайте контроллер транзакций:

    - нажмите группу тестов правой кнопкой мыши;
    - выберите пункты **Add** — **Logic Controller** — «**Transaction Controller**;

    _![Добавление контроллера транзакций](img/jmeter_transaction_controller.png)_

3. Создайте HTTP-запрос:

    - нажмите любое действие сценария правой кнопкой мыши;
    - выберите пункты **Add** — **Sampler** — **HTTP Request**.

    _![Добавление HTTP-запроса](img/jmeter_interface.png)_

4. Настройте HTTP-запрос по аналогии с примерами из файла `jmeter-example-settings.jmx`:

    - заполните поля в разделе **Web Server**:
        - **Protocol** — **http** или `https`;
        - **Server Name or IP** и **Port Number** — адрес и порт **{{ productName }}**;
    - [получите путь и тело тестового запроса](#load_testing_jmeter_get_request);
    - Заполните поля в разделе **HTTP Request**:
        - **`POST`** — метод запроса;
        - **Path** — укажите путь в поле;
        - **Body Data** — тело запроса.

    _![Настройка HTTP-запроса](img/jmeter_http_request_config.png)_

5. Чтобы выключить или включить любой элемент сценария без удаления нажмите его правой кнопкой мыши и выберите пункт **Disable** или **Enable**. Выключенные элементы отображаются серым цветом и пропускаются при выполнении теста.

    _![Отключение элемента в JMeter](img/jmeter_disable_element.png)_

    _![Выключенный элемент в JMeter](img/jmeter_disabled_element.png)_

## Получение пути и тела тестового запроса {: #load_testing_jmeter_get_request }

1. Откройте в **{{ productName }}** страницу с формой или таблицей, которую требуется протестировать.
2. В браузере включите режим разработки DevTools: нажмите клавишу ++F12++ или выберите в меню настроек пункты «**Дополнительные инструменты**» — «**Инструменты разработчика**».
3. Выберите вкладку **Network**.
4. Соберите сетевой трафик: нажмите в **{{ productName }}** любую кнопку, перезагрузите страницу, выберите значение в раскрывающемся списке или заполните поле.
5. В таблице **Name** найдите элемент, который требуется протестировать: **Query** (таблица), **QueryForm** (форма), **Execute** (кнопка), **QueryData** (заполнение поля).
6. Путь HTTP-запроса будет указан на вкладке **Headers** в строке **Request URL** после адреса **{{ productName }}**.

    _![Просмотр пути HTTP-запроса на вкладке Network в браузере](img/browser_network_tab.png)_

7. Тело запроса будет отображаться на вкладке **Payload**.
8. Скопируйте тело запроса: нажмите правой кнопкой мыши первую строку под заголовком **Request Payload** и выберите пункт **Copy value** или **Copy object**.

    _![Копирование тела запроса с вкладки Payload в браузере](img/browser_payload_tab.png)_

!!! tip "Подстановка ID записей в теле запроса"

    Поле `objId` в теле запроса — это ID записи, для которой выполняется запрос.
    
    Значение `objId` можно менять для выполнения операций с разными записями.
    
    Если запускаете сценарий создания новой записи, не меняйте скопированное тело запроса.
    
    Так же сценарий создания новой записи выполняется при нажатии кнопки «**Сохранить**» на форме новой записи.

## Выполнение тестовых сценариев под разными пользовательскими ролями {: #load_testing_different_roles }

Чтобы запускать сценарии одновременно от аккаунтов с разными ролями, создайте группу тестов с данными для авторизации пользователя под каждой требуемой ролью:

1. В **Test Plan** создайте новую группу тестов (**Thread Group**): нажмите имеющуюся группу правой кнопкой мыши и выберите пункт **Duplicate**.
2. Выберите раздел **HTTP Authorization Manager**.
2. В таблице **Authorizations stored in the Authorization Manager** укажите учётные данные тестового аккаунта в **{{ productName }}** в полях **Username** и **Password**.
3. Настройте остальные элементы тестовой группы согласно требуемой логике тестирования.

    _![HTTP Authorization Manager](img/jmeter_http_auth_manager.png)_

## Проведение нагрузочного тестирования {: #load_testing_execution }

1. Перед началом тестирования измените конфигурацию системы: 

    - откройте для редактирования файл конфигурации **{{ productName }}** (например, `/usr/share/comindware/configs/<instanceName>/cmwdata.yml`, где `<instanceName>` — имя экземпляра);
    - в любую строку файла конфигурации (например, после номера версии ПО), добавьте директиву:

    ``` yaml
    isTestEnvironment: true
    ```

    См. _«[Конфигурация экземпляра, компонентов ПО и служб. Настройка][configuration_files_linux]»_.

2. Перезагрузите **{{ productName }}**.
3. Для запуска теста в JMeter нажмите кнопку **Start**.

    _![Кнопка Start в JMeter](img/jmeter_start_button.png)_

4. По окончании тестирования отчеты появятся в разделах **View Result Tree** и **Summary Report**.

    _![Просмотр результатов тестирования](img/jmeter_view_results.png)_

    _![Сводный отчёт по тестированию](img/jmeter_summary_report.png)_

5. Скачайте журналы из **{{ productName }}** и загрузите их в JMeter для анализа.
6. После проведения всех работ:

    - удалите директиву `isTestEnvironment: true` из файла конфигурации **{{ productName }}**;
    - перезагрузите **{{ productName }}**.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Страница загрузки Apache JMeter][jmeter_download]
- [Установка, запуск, инициализация и остановка ПО в Linux][deploy_guide_linux]
- [Установка, запуск, инициализация и остановка ПО в Windows][deploy_guide_windows]
- [Системные требования {{ productName }}][system_requirements]
- [Факторы, влияющие на производительность. Рекомендации по оптимизации][performance_optimize]
- [Пути и содержимое директорий экземпляра ПО][paths]
- [Конфигурация экземпляра, компонентов ПО и служб. Настройка][configuration_files_linux]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
