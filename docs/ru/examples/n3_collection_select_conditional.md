---
title: 'Выборка определённых элементов из списка с помощью N3'
tags:
    - процессы
    - N3
    - тройки
    - тройка
    - триплеты
    - коллекции
    - выборка
    - фильтрация
hide:
    - tags
kbId: 
---

# Выборка определённых элементов из списка с помощью N3 {: #n3_collection_select_conditional }

## Введение {: #n3_collection_select_conditional_intro }

**{{ productName }}** позволяет осуществлять выборку из списков (коллекций) по определённым условиям.

Это может быть полезно, когда требуется выбрать из набора данных элементы, соответствующие заданным критериям.

Здесь приведён пример вычисления списка позиций заказа, которые ещё не поступили на склад.

## Прикладная задача {: #n3_collection_select_conditional_use_case }

В бизнес-процессе обработки заказов необходимо реализовать следующий сценарий:

- В каждом заказе есть список позиций (например, товары, услуги).
- Часть позиций уже поступила на склад.
- Требуется показать пользователю только, позиции ещё не поступившие на склад.

## Исходные данные {: #n3_collection_select_conditional_initial_data }

- В шаблоне заказа присутствуют два атрибута:
    - **Все позиции** (например, `Всепозиции`) — коллекция всех возможных значений.
    - **Поступившие на склад позиции** (например, `Позициинаскладе`) — коллекция позиций, которые уже поступили на склад.
- Необходимо реализовать вычисление, которое будет возвращать только позиции, ещё не поступившие на склад.

## Настройка вычислений {: #n3_collection_select_conditional_configure }

1. Убедитесь, что в шаблоне заказа есть два атрибута:
    - `Всепозиции` — коллекция всех возможных позиций заказа.
    - `Позициинаскладе` — коллекция позиций, уже поступивших на склад.
2. В нужном месте (например, в фильтре поля или вычисляемом атрибуте) используйте следующее выражение N3:

```turtle
@prefix object: <http://comindware.com/ontology/object#>.
@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix assert: <http://comindware.com/logics/assert#>.

{
  # Получаем атрибут, содержащий все позиции заказа.
  ("Заказ" "Всепозиции") object:findProperty ?allItemsAttribute.
  # Получаем атрибут, содержащий позиции, поступившие на склад.
  ("Заказ" "Позициинаскладе") object:findProperty ?arrivedItemsAttribute.

  from {
      # Для каждого значения из всех позиций проверяем,
      # встречается ли оно среди поступивших на склад.
      ?Item ?allItemsAttribute ?positionValue.

      {
          ?Item ?arrivedItemsAttribute ?arrivedPositionValue.
          ?arrivedPositionValue == ?positionValue.
      }
      assert:count ?arrivedCount.

      # Если позиция не встречается среди поступивших на склад (?arrivedCount == 0), она считается ещё не поступившей.
      ?arrivedCount == 0.
  } select ?positionValue -> ?notArrivedItemsList.

  # Все такие позиции собираются в список ?notArrivedItemsList, из которого выбираются отдельные значения для дальнейшего использования.
  ?notArrivedItemsList list:member ?value.
}
```

## Тестирование {: #n3_collection_select_conditional_test }

1. Создайте тестовый заказ с заполненными атрибутами **Все позиции** и **Поступившие на склад позиции**.
2. Примените выражение N3 в фильтре поля или вычисляемом атрибуте.
3. Откройте форму выбора позиций — должны отображаться только те позиции, которые ещё не поступили на склад.
4. Добавьте новую поступившую позицию и убедитесь, что она исчезла из доступных для выбора.
5. Проверьте работу сценария на разных данных и убедитесь, что логика работает корректно.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Вычисление пользователей, у которых есть активные задачи][n3_calculate_active_task_accounts]
- [Фильтр списка по активным задачам текущего пользователя][n3_filter_active_tasks]
- [Периодические напоминания об открытых задачах][n3_periodic_task_notifications]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
