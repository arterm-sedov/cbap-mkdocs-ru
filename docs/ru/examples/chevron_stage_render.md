---
title: Шевроны. Визуализация этапов процесса. Пример настройки
kbId: 4915
---

# Шевроны. Визуализация этапов процесса. Пример настройки {: example_chevron_stage_render }

## Введение {: #example_chevron_stage_render_introduction }

В **{{ productName }}** можно настроить визуальное отображение этапов процесса с помощью шевронов.

В этой статье представлен пример настройки приложения для отображения прогресса открытия магазина в виде цветных шевронов пройденных этапов.

<div class="admonition question" markdown="block">

## Определения {: .admonition-title #definitions}

- **Шевроны** — это представление атрибута типа «**Запись**», хранящего несколько значений, в виде последовательности цветных плашек с заголовками записей связанного шаблона.
- Каждый шеврон содержит заголовок связанной с ним записи в виде гиперссылки на запись.
- Конечный пользователь может нажимать шевроны для просмотра связанных с ними записей во всплывающем окне.
- Цвет шеврона можно задать двумя способами:
    - с помощью системного атрибута «**Цвет**» связанной записи;
    - с помощью **правил окраски** шевронов.
- Подробные сведения о настройке шевронов см. в параграфе _«[Динамические элементы формы. Настройка шевронов][form_dynamic_elements]»_.

</div>

_![Пример отображения шевронов](https://kb.comindware.ru/assets/img_6606b8aa257d2.png)_

## Прикладная задача {: #example_chevron_stage_render_task }

Имеется процесс открытия магазина, состоящий из семи этапов.

Требуется настроить на форме магазина отображение прогресса пройденных этапов открытия в виде цветных шевронов.

Цвет шевронов должен зависеть от статуса прохождения этапа:

- этап пройден с задержкой — красный;
- этап пройден вовремя — зелёный;
- этап начат — оранжевый;
- этап не начат — серый.

### Логика работы приложения {: #example_chevron_stage_render_logic }

- Для реализации прикладной задачи мы создадим следующие сущности (см. «[Исходные данные](#example_chevron_stage_render_initial_data)»):
    - шаблон записи _«Магазины»_, в котором будут храниться сведения о магазинах;
    - справочник этапов открытия магазинов — шаблон записи, который будет хранить записи с названиями и номерами этапов;
    - шаблон записи _«Этапы»_, в котором будут храниться данные о прогрессе открытия каждого магазина:
        - при запуске процесса _«Открытие магазина»_магазина стандартный набор этапов открытия магазина заполняется автоматически с помощью процесса _«Копирование этапов из справочника»_;
        - этапы открытия конкретного магазина можно переименовать, добавить или удалить.
    - шаблон процесса _«Копирование этапов из справочника»_, который будет создавать запись в шаблоне _«Этапы»_ и копировать в неё название и номер этапа из справочника этапов;
    - шаблон процесса _«Открытие магазина»_, который будет вызывать процесс _«Копирование этапов из справочника»_ для каждого этапа из справочника, чтобы скопировать названия и номера этапов в список этапов открытия конкретного магазина_._ Кроме того, в каждый этап открытия магазина процесс поместит ссылку на соответствующий этап в справочнике.
- На форме _«Прогресс открытия магазина»_ в шаблоне _«Магазины»_ мы разместим шевроны, связанные с шаблоном записи _«Этапы»_.
- Пользователь может указать прогресс выполнения каждого этапа с помощью формы _«Прогресс открытия магазина»_.
- Шевроны на форме _«Прогресс открытия магазина»_ будут окрашиваться в соответствии с прогрессом выполнения соответствующих этапов.

## Исходные данные {: #example_chevron_stage_render_initial_data }

Создайте приложение _«Управление магазинами»_ и настройте перечисленные ниже шаблоны.

### Справочник этапов {: #example_chevron_stage_render_stages_reference }

1. Создайте **шаблон записи** _«Справочник этапов»_ с **системным именем** `Справочникэтапов`.
2. Создайте следующие атрибуты в этом шаблоне:

    | Название атрибута | Свойства |
    | --- | --- |
    | _Название этапа_ | **Тип данных: текст**<br>**Формат отображения:** **обычный текст**<br>**Использовать как заголовок записей:** флажок установлен |
    | _Номер этапа_ | **Тип данных: число**<br>**Количество знаков после запятой: 0** |

3. В шаблоне создайте записи со следующими данными:

    | Название этапа             | Номер этапа |
    | -------------------------- | ----------- |
    | _Оценка_                   | _1_         |
    | _ИК 1_                     | _2_         |
    | _ИК 2_                     | _3_         |
    | _Договор_                  | _4_         |
    | _УФРС_                     | _5_         |
    | _Предв. подготов. к откр._ | _6_         |
    | _АПП_                      | _7_         |

### Шаблон записи «Этапы» {: #example_chevron_stage_render_stages_template }

В этом вспомогательном шаблоне будут хранится скопированные из [_Справочника этапов_](#example_chevron_stage_render_stages_reference) данные об этапах для каждой записи в шаблоне _«[Магазины](#example_chevron_stage_render_stores_template)»_.

1. Создайте **шаблон записи** _«Этапы»_.
2. Создайте в шаблоне _«Этапы»_следующие атрибуты:

    | Название атрибута | Свойства |
    | --- | --- |
    | _Название этапа_ | **Тип данных: текст**<br>**Формат отображения: обычный текст**<br>**Использовать как заголовок записей:** флажок установлен |
    | _Номер этапа_ | **Тип данных: число**<br>**Количество знаков после запятой: 0** |
    | _Этап начат_ | **Тип данных: логический**<br>**Системное имя:** `Этапначат` |
    | _Этап пройден_ | **Тип данных: логический**<br>**Системное имя:** `Этаппройден` |
    | _Этап пройден вовремя_ | **Тип данных: логический**<br>**Системное имя:** `Этаппройденвовремя` |
    | _Этап из справочника_ | **Тип данных: запись**<br>**Формат отображения:** **гиперссылка**<br>**Связанный шаблон:***Справочник этапов*<br>**Хранить несколько значений:** флажок снят<br>**Взаимная связь с атрибутом:** **не используется** |

### Шаблон процесса «Копирование этапов из справочника» {: #example_chevron_stage_render_copy_process }

Этот вспомогательный шаблон будет служить для передачи данных из шаблона _«[Этапы](#example_chevron_stage_render_stages_template)»_ в процесс _«[Открытие магазина](#example_chevron_stage_render_store_opening_process)»._

1. Создайте **шаблон процесса** со следующими свойствами:

    - **Название:** _Копирование этапов из справочника_
    - **Связь с шаблоном записи**: **с имеющимся**
    - **Связанный шаблон:** _Этапы_

2. Откройте вкладку «**Диаграмма**»
3. Постройте простой процесс, состоящий из двух элементов: **начального события** и **конечного события**.
4. В меню элемента начального события выберите пункт «**Сценарий на выходе**».

    _![Создание сценария на выходе из начального события процесса «Копирование этапов из справочника»](https://kb.comindware.ru/assets/img_65f469f19c250.png)_

5. Отобразится конструктор сценария.
6. Внутри действия «**Сменить контекст**» добавьте действие «**Изменить значения атрибутов**». См. _«[Сценарии. Создание вложенных действий](https://kb.comindware.ru/article.php?id=2153)»._
7. В  свойствах действия «**Изменить значения атрибутов**» настройте таблицу изменения значений атрибутов следующим образом:

    | Атрибут          | Операция со значениями | Значение                 |
    | ---------------- | ---------------------- | ------------------------ |
    | _Название этапа_ | **Заменить**           | _Этапы → Название этапа_ |
    | _Номер этапа_    | **Заменить**           | _Этапы → Номер этапа_    |

8. Должен получиться сценарий, показанный на следующей иллюстрации:

    _![Сценарий для изменения значений атрибутов на выходе из начального события процесса «Копирование этапов из справочника»](https://kb.comindware.ru/assets/img_65f46a2d2135e.png)_

9. Чтобы вернуться из конструктора сценария к конструктору диаграммы процесса, нажмите кнопку «**Назад**» в браузере.
10. Проверьте и опубликуйте диаграмму процесса _«Копирование этапов из справочника»._

### Шаблон записи «Магазины» {: #example_chevron_stage_render_stores_template }

1. Создайте **шаблон записи** _«Магазины»_.
2. Создайте в шаблоне _«Магазины»_ следующие атрибуты:

    | Название атрибута | Свойства |
    | --- | --- |
    | _Название магазина_ | **Тип данных: текст**<br>**Формат отображения:** **обычный текст** |
    | **Этапы открытия магазина** | **Тип данных: запись**<br>**Формат отображения:** **гиперссылка**<br>**Связанный шаблон:**_Этапы_<br>**Хранить несколько значений:** флажок установлен<br>**Взаимная связь с атрибутом:** **с новым**<br>**Свойства нового атрибута:**<br>- **Название**: _Магазин_<br>- **Хранить несколько значений**: флажок снят |

### Шаблон процесса «Открытие магазина» {: #example_chevron_stage_render_store_opening_process }

1. Создайте **шаблон процесса** со следующими свойствами:

    - **Название:** _Открытие магазина_
    - **Связь с шаблоном записи: Связать с существующим**
    - **Связанный шаблон:** _Магазины_

## Настройка шаблона процесса «Открытие магазина» {: #example_chevron_stage_render_process_setup }

Мы настроили заполнение данных по этапам, и теперь необходимо настроить вызов нашего процесса копирования

1. Откройте шаблон процесса _«Открытие магазина_».
2. Откройте вкладку «**Диаграмма**».
3. Перетащите на диаграмму элемент «**Вызов процесса**» (рекомендуется сразу после начального события).
4. В меню элемента выберите пункт «**Свойства**» <i class="fa-light fa-gear">‌</i>.
5. Отобразится окно «**Свойства вызова процесса**»
6. На вкладке «**Основные**» настройте параметры следующим образом:

    - **Экспертные настройки:** установите флажок
    - **Шаблон для выборки объектов:** _Справочник этапов_
    - **Выражение для выборки объектов:** `from a in db->Справочникэтапов select a->id` (выражение вернёт **ID** записей в [справочнике этапов](#example_chevron_stage_render_stages_reference), по количеству которых будет запущен подпроцесс)
    - **Режим выполнения**: **параллельный**
    - **Связь шаблона записи с процессом:** **через атрибут**
    - **Шаблон процесса:** _Копирование этапов из справочника_
    - **Записи, связанные с процессом: создавать новые**
    - **Атрибут связи:** _Этапы открытия магазина → Этап из справочника_ (в этот атрибут будет записываться **ID** [этапа из справочника](#example_chevron_stage_render_stages_reference), возвращённый **выражением для выборки объектов**, для каждой созданной записи в шаблоне _«[Этапы](#example_chevron_stage_render_stages_template)»)_.

    _![Настройка вызова процесса «Копирование этапов из справочника»](https://kb.comindware.ru/assets/img_660a6ed14aa42.png)_

7. Выберите вкладку «**Данные на входе**».
8. Нажмите на кнопку «**Добавить**» и настройте сопоставление атрибутов подпроцесса и текущего процесса:

    - **Атрибут шаблона записи подпроцесса:** _Магазин_
    - **Значение:** _ID_

    В результате каждая запись, созданная процессом _«Копирование этапов из справочника»_ будет связана с записью в шаблоне _«[Магазин](#example_chevron_stage_render_stores_template)»_, и благодаря взаимной связи в атрибуте _«Этапы открытия магазина»_   будет записан набор идентификаторов записей из шаблона «[_Этапы_](#example_chevron_stage_render_stages_template)».

9. Сохраните свойства элемента «**Вызов процесса**».
10. Проверьте и опубликуйте диаграмму процесса.

## Настройка шевронов на форме «Прогресс открытия магазина» {: #example_chevron_stage_render_chevrons_setup }

1. Откройте шаблон _«[Магазины](#example_chevron_stage_render_stores_template)»_.
2. Выберите вкладку «**Формы**».
3. Откройте основную форму шаблона.
4. Присвойте области на форме название _«Прогресс открытия магазина»._
5. Перетащите атрибут «_Этапы открытия магазина_» в область _«Прогресс открытия магазина»._
6. На панели «**Свойства поля**» выберите **представление** «**Шевроны**».
7. Настройте свойства шевронов:

    - **Упорядочивание:** _Номер этапа_
    - **Правила окраски записей:** нажимайте **«Создать»**  и настройте следующие правила:

    | Цвет | Условие: формула |
    | --- | --- |
    | <span style="background-color: #31ff00; color: #000000;">Зелёный #31ff00</span> | `AND($Этапначат, $Этаппройденвовремя)` |
    | <span style="background-color: #ff0000; color: #ffffff;">Красный #ff0000</span> | `NOT($Этаппройденвовремя)` |
    | <span style="background-color: #c0c0c0; color: #000000;">Серый #c0c0c0</span> | `NOT($Этапначат)AND($Этапначат, $Этаппройденвовремя)` |
    | <span style="background-color: #ff9800; color: #ffffff;">Оранжевый #ff9800</span> | `AND($Этапначат, NOT($Этаппройден))` |

    !!! note "Примечание"

        - Если для одной записи одновременно сработают несколько правил, возвращающих разные цвета, то шеврон будет окрашен в цвет, заданный последним сработавшим правилом.
        - Правил окраски шевронов может быть неограниченное количество, но для оптимальной работы платформы рекомендуется задавать не более 8 условий.
        - Следует помнить, что условие окрашивания шеврона вычисляется в контексте шаблона, связанного с текущим шаблоном посредством с атрибута типа «**Запись**». Поэтому обратиться к атрибутам текущего шаблона, на форме которого размещены шевроны, можно только посредством обратной ссылки. Например, к атрибуту _«Название магазина»_ можно обратиться посредством атрибута _«Магазин»_ из шаблона _«[Этапы](#example_chevron_stage_render_stages_template)»:_

            ``` sql
            $Magazin->Nazvaniemagazina
            ```

8. Снова перетащите атрибут «_Этапы открытия магазина_» в область _«Прогресс открытия магазина»._
9. На панели «**Свойства поля**» выберите **представление** «**Таблица**».
10. В поле «**Сортировка**» на панели «**Свойства таблицы**» выберите атрибут _«Номер этапа»_.
11. Вынесите в таблицу «_Этапы открытия магазина_» следующие атрибуты шаблона  _«[Этапы](#example_chevron_stage_render_stages_template)»_  в качестве столбцов:

    - _Магазин_
    - _Номер этапа_
    - _Название этапа_
    - _Этап начат_
    - _Этап пройден_
    - _Этап вовремя_

12. Сохраните форму.

_![Настроенная форма «Прогресс открытия магазина»](https://kb.comindware.ru/assets/img_6606b0a3e5043.png)_

## Проверка работы приложения {: #example_chevron_stage_render_verification }

1. Откройте шаблон процесса _«Открытие магазина»_.
2. Нажмите кнопку «**Перейти к экземплярам**».
3. Отобразится таблица «**Все записи**» со списком экземпляров процесса.
4. Создайте новый экземпляр процесса.
5. Подождите некоторое время, чтобы процесс выполнился.
6. Обновите список экземпляров, нажав кнопку «**Обновить список**» _‌_.
7. Статус процесса должен смениться на «**Завершен**».
8. Из списка экземпляров процесса перейдите к связанной записи шаблона _«Магазины»_ по ссылке в столбце «**Запись**».
9. Отобразится настроенная форма _«Прогресс открытия магазина»_.
10. Расставьте флажки в таблице «Этапы _открытия магазина»_.
11. Цвета шевронов должны меняться в зависимости от состояния флажков _«Этап начат», «Этап пройден», «Этап пройден вовремя»:_

    - серый цвет — установлен флажок _«Этап начат»;_
    - зелёный цвет — установлены все три флажка;
    - красный цвет — установлены флажки _«Этап начат»_ и _«Этап пройден»._

_![Проверка отображения шевронов на форме](https://kb.comindware.ru/assets/img_6606b888ea7b7.png)_

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Динамические элементы формы. Настройка шевронов][form_dynamic_elements]
- [Шевроны. Правила окрашивания. Пример настройки][chevron_color_rules]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
