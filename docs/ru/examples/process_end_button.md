---
title: Отмена процесса по кнопке. Настройка шаблонов, процессов и кнопки
kbId: 4911
---

# Отмена процесса по кнопке. Настройка шаблонов, процессов и кнопки

## Введение

**{{ productName}}** позволяет гибко управлять процессами, в том числе даёт возможность останавливать и отменять их. При этом ролевая модель даёт возможность ограничить права пользователей на редактирование и изменение процессов.

Чтобы разрешить пользователям отменять экземпляр процесса без доступа к его редактированию, можно создать специальную кнопку отмены процесса. Кнопка имеет следующие преимущества:

- может быть доступна пользователям, которые не имеют права на редактирование процессов;
- отмена выполняется в один клик без необходимости перехода к диаграмме экземпляра процесса или списку экземпляров.

Здесь представлены настройки шаблонов процесса и кнопки для быстрой отмены процессов.

## Исходные данные

Имеется шаблон записи _«Договоры»_. В нём имеется текстовый атрибут _«ID процесса»_ (системное имя — `processID`).

Имеется шаблон процесса _«Согласование договора»_, который связан с шаблоном _«Договоры»_.

## Прикладная задача

Требуется настроить кнопку на форме, которая позволит участникам процесса отменять и останавливать его без доступа к списку процессов.

## Настройка отмены процесса по кнопке

### Настройка процесса «Согласование договора»

1. Перейдите к настройкам сценария на выходе для **стартового события** диаграммы процесса _«Согласование договора»_.
2. Добавьте действие «**Изменить значения атрибутов**» со следующими свойствами:

    - **Атрибут:** _ID процесса_
    - **Действие: заменить**
    - **Значение: формула**

        ``` cs
        FORMAT("{0}", LIST($$ProcessObject))
        ```

3. На диаграмме процесса _«Согласование договора»_ добавьте развилку «**и**» сразу после стартового события.
4. Соедините развилку «**и**» с настроенным процессом.
5. Добавьте **промежуточное событие–получение сообщения** со следующими настройками:

    - **Имя сообщения:** _ProcessCancelMessage_

6. Соедините **промежуточное событие–получение сообщения** с развилкой «**и**».
7. Добавьте **конечное событие-остановку процесса** и соедините его с **промежуточным событием–получением сообщения**.
8. Добавьте **конечное событие-остановку процесса** и соедините его с последним элементом настроенного процесса.

    !!! warning "Внимание"

        Все конечные события процесса обязательно должны быть типа **конечное событие-остановка процесса**. Это требуется, чтобы останавливался весь процесс, а не только одна его часть.
        
        Таким образом, при запуске процесса будут активны оба потока и процесс завершится либо по завершении основного потока, либо с получением сообщения об отмене.

_![Настройка процесса «Согласование договора»](https://kb.comindware.ru/assets/cancel101.png)_

### Настройка процесса «Отмена договора»

1. Создайте шаблон записи _«Отмены по договорам»_ со следующим атрибутом:

    - **Название:** _Договор_
    - **Системное имя:** _Contract_
    - **Тип: запись**
    - **Связанный шаблон:** _Договоры_

2. Создайте процесс _«Отмена договора»_, связанный с шаблоном _«Отмены по договорам»_.
3. Добавьте **промежуточное событие-отправка сообщения** со следующими свойствами:

    - **Место назначения: промежуточное событие**
    - **Имя сообщения:** _ProcessCancelMessage_
    - **Экземпляр процесса: формула**

        ``` cs
        $Contract->processID
        ```

    !!! warning "Внимание!"

        Имя сообщения в **промежуточном событии-отправке сообщения** должно обязательно совпадать с именем сообщения в **промежуточном событии–получении сообщения** другого процесса.

_![Настройка процесса «Отмена договора»](https://kb.comindware.ru/assets/cancel2.png)_

### Настройка кнопки отмены процесса

1. В шаблоне _«Договоры»_ создайте кнопку _«Отменить согласование договора»_:

    - **Контекст операции: запись**
    - **Операция: запустить процесс по связанному шаблону**
    - **Сохранять запись после выполнения:** флажок установлен
    - **Результат выполнения: обновить данные**
    - **Шаблон:** _Отмены по договорам_

2. Добавьте кнопку _«Отменить согласование договора»_ на основную форму шаблона _«Договоры»_.

## Тестирование

1. Создайте экземпляр процесса _«Согласование договора»_.
2. Перейдите к записи шаблона _«Договоры»_, с которой связан экземпляр процесса.
3. Нажмите кнопку _«Отменить согласование договора»_.
4. Перейдите к списку экземпляров процесса _«Согласование договора»_.
5. Экземпляр процесса _«Согласование договора»_ будет в статусе «**Отменён**».

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Диаграмма процесса. Определения, просмотр, редактирование, публикация][process_diagram]
- [Промежуточное событие-получение сообщения][process_diagram_elements_receive_message_intermediate_event]
- [Промежуточное событие-отправка сообщения][process_diagram_elements_send_message_intermediate_event]
- [Конечное событие-остановка процесса][process_diagram_elements_stop_process_end_event]
- [Кнопки. Определение, настройка, удаление][buttons]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
