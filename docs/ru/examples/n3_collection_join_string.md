---
title: 'Записи и коллекции. Объединение значений из коллекции в строку'
kbTitle: 'Записи и коллекции. Объединение значений из коллекции в строку'
kbId: 5107
tags:
  - N3
  - Notation 3
  - Notation3
  - RDF
  - атрибут типа «Запись»
  - объединение
  - вычисление
  - коллекция
  - конкатенация
  - пример
  - склейка
  - список
  - строка
  - таблица
  - текст
  - триплеты
  - тройка
  - тройки
  - форматирование
  - запись
  - join
hide: tags
---

# Записи и коллекции. Объединение значений из коллекции в строку с помощью N3 {: #example_n3_collection_join_string }

## Введение {: #example_n3_collection_join_string_intro }

Атрибут типа «**Запись**» может хранить ссылки на несколько записей в связанном шаблоне (то есть коллекцию или список ссылок).

Для реализации бизнес-требований может потребоваться объединить значения атрибутов связанного шаблона в одну строку. Например, так это позволяет собрать список из гиперссылок, номеров телефонов или артикулов.

При объединении элементов списка в строку можно задать произвольный текстовый разделитель.

Здесь представлен пример вывода значений атрибута из нескольких записей в виде списка с разделителем.

## Прикладная задача {: #example_n3_collection_join_string_use_case }

Требуется сформировать список артикулов товаров, на которые оформлен заказ.

Список артикулов необходимо вывести в виде строки, разделённой запятыми.

## Исходные данные {: #example_n3_collection_join_string_initial_data }

Имеются шаблон записи _«Заказы»_ и _«Товары»_.

Шаблон _«Заказы»_ связан с атрибутом _«Товары»_ посредством атрибута _«Позиции заказа»_ типа **запись**, в котором **хранится несколько записей**.

В шаблоне _«Товары»_ имеется **текстовый** атрибут _«Артикул»_.

## Настройка вычисления {: #example_n3_collection_join_string_calculation .pageBreakBefore }

1. В шаблоне _«Заказы»_ создайте атрибут:

    - **Название:** _Перечень артикулов_
    - **Тип данных: текст**
    - **Формат отображения: обычный**
    - **Вычислять автоматически**
    - **Вычисляемое значение: N3**

    ``` turtle
    # Импортируем функции для работы с объектами и строками
    @prefix object: <http://comindware.com/ontology/object#>.
    @prefix cmwstring: <http://comindware.com/logics/string#>.
    {
        # Находим атрибуты «Позиции заказа» и «Артикул» 
        # в соответствующих шаблонах.
        ("Заказы" "Позициизаказа") object:findProperty ?collectionAttribute.
        ("Товары" "Артикул") object:findProperty ?referencedAttribute.
        # Собираем список товаров, связанных с текущей записью.
        from {
            ?item ?collectionAttribute ?collectionAttributeVal.
            ?collectionAttributeVal ?referencedAttribute ?referencedAttributeVal.
        } select ?referencedAttributeVal -> ?PartNumber.
        # Объединяем значения атрибута «Артикул» в строку,
        # разделённую запятыми.
        (", " ?PartNumber) cmwstring:join ?concatenatedString.
        # Возвращаем результирующую строку.
        ?concatenatedString -> ?value.
    }
    ```

2. Поместите атрибут _«Позиции заказа»_ и _«Перечень артикулов»_ на форму заказа.
3. Для поля _«Позиции заказа»_ выберите представление в виде **таблицы**.
4. В таблицу _«Позиции заказа»_ добавьте атрибут _«Артикул»_ и кнопку «**Создать**», чтобы создавать и добавлять товары в заказ.

## Тестирование {: #example_n3_collection_join_string_test .pageBreakBefore }

1. Создайте запись в шаблоне _«Заказы»_.
2. Создайте несколько _позиций заказа_ и заполните _артикулы_.
3. Сохраните заказ.
4. В _перечне артикулов_ должен отобразиться список артикулов, разделённых запятыми.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Таблицы на форме. Настройка][form_dynamic_elements_table]
- [Атрибут типа «Запись»][attribute_record]
- [Атрибут типа «Текст»][attribute_text]
- [Язык N3][n3_guide_cat]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
