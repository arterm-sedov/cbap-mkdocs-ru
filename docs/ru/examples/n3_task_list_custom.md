---
title: 'Список задач всех пользователей со статусом и длительностью просрочки. Настройка на N3'
kbTitle: 'Список задач всех пользователей со статусом и длительностью просрочки. Настройка с помощью N3'
kbId: 5154
tags:
    - N3
    - Notation 3
    - RDF
    - дата и время
    - длительность
    - задачи
    - вычисление
    - список задач
    - пример
    - просрочка
    - срок выполнения
    - триплеты
    - тройка
    - тройки
hide:
    - tags
---

# Список задач всех пользователей со статусом и длительностью просрочки. Настройка на N3 {: #example_n3_task_list_custom }

## Введение {: #example_n3_task_list_custom_intro }

**{{ productName }}** предусмотрена стандартная страница «**Мои задачи**, которая показывает список задач для текущего пользователя с заранее заданными столбцами.

Чтобы вывести список задач определённых пользователей, с дополнительными бизнес-данными и т.&nbsp;п, можно настроить таблицу с требуемыми вычисляемыми атрибутами и особыми параметрами фильтрации, группировки и сортировки.

Здесь приведён пример вычисления с помощью языка **N3** дополнительных атрибутов задач и настройки списка всех задач для всех пользователей с этими атрибутами (например, статуса и длительности просрочки).

Если вам требуется отфильтровать список задач, см. также _«[Фильтр списка по активным задачам текущего пользователя: по всем процессам, по конкретному процессу][n3_filter_active_tasks]»_.
.

## Прикладная задача {: #example_n3_task_list_custom_use_case }

Требуется настроить таблицу _«Статус просрочки задач»_ со следующими параметрами:

- выводить задачи всех пользователей: как активные, так и завершённые;
- выводить только задачи, у которых **задан крайний срок** (задачи без крайнего срока, не должны отображаться в таблице).

    !!! question "Настройка крайнего срока задачи"

        Крайний срок задачи вычисляется автоматически по заданной **продолжительности выполнения** задачи.
        
        **Продолжительность выполнения** можно установить в свойствах **пользовательской задачи** на вкладке «**Дополнительные**».

        См. _«[Пользовательская задача][process_diagram_elements_user_task]»_.

- столбцы **Название**, **Исполнитель**, **Дата создания**, **Крайний срок**, **Дата завершения**;
- столбец _«Просрочена»_ с **логическим** (булевым) значением в **текстовом** виде:
    - _Да_ — если задача активна и **крайний срок** уже наступил, либо задача завершена, но **дата завершения** позже **крайнего срока**;
    - _Нет_ — в остальных случаях.
- столбец _«Длительность просрочки»_ (_0_, если задача не просрочена).

## Пример настройки {: #example_n3_task_list_custom_configure .pageBreakBefore }

Решим задачу следующим образом:

- Создадим служебный шаблон записей _«Задачи»_.
- В шаблоне записей _«Задачи»_ [создадим вычисляемые атрибуты для контроля просрочки](#example_n3_task_list_custom_attributes):
    - атрибут _«Длительность просрочки»_ типа «**Дата и время**» с выражением на **N3** для определения длительности просрочки:
        - для активных просроченных задач — разность между **текущим временем** и **крайним сроком**;
        - для закрытых просроченных задач — разность между **фактической датой завершения** и **крайним сроком**;
        - для задач без просрочки — `0`;
    - **текстовый** атрибут _«Просрочена»_ с **формулой** для определения признака просрочки:
        - _Да_ — если длительность просрочки больше `0`;
        - _Нет_ — если длительность просрочки `0`;
- В шаблоне _«Задачи»_ создадим **вычисляемые** атрибуты с выражениями на **N3** для вывода стандартных атрибутов задач:

    | Название          | Тип данных       |
    | ----------------- | ---------------- |
    | _Название_        | **текст**        |
    | _Исполнитель_     | **Аккаунт**      |
    | _Крайний срок_    | **Дата и время** |
    | _Дата завершения_ | **Дата и время** |

- В шаблоне _«Задачи»_ [создадим таблицу _«Статус просрочки задач»_](#example_n3_task_list_custom_table) со специальным **системным фильтром** на **N3** и поместим в неё требуемые атрибуты.
- Добавим таблицу _«Статус просрочки задач»_ на информационную страницу.

!!! warning "Внимание!"

    Для корректного вычисления выражений указывайте в них те системные имена шаблонов и атрибутов, которые используются в вашем приложении. Они могут отличаться от указанных в примере.

### Настройка атрибутов шаблона записи _«Задачи»_ {: #example_n3_task_list_custom_attributes }

Для формирования требуемых атрибутов задач создадим служебный шаблон записи.

1. Создайте шаблон записи _«Задачи»_.
2. В шаблоне _«Задачи»_ создайте атрибут для вычисления длительности просрочки:

   - **Название:** `Длительность просрочки`
   - **Системное имя:** `Длительностьпросрочки`
   - **Тип данных: длительность**
   - **Описание:** _Длительность просрочки задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: N3**

    ``` turtle
    # Импортируем функции для работы с объектами, статусами задач,
    # сеансами, временем и сравнения величин
    @prefix cmw: <http://comindware.com/logics#>.
    @prefix taskStatus: <http://comindware.com/ontology/taskStatus#>.
    @prefix session: <http://comindware.com/ontology/session#>.
    @prefix cmwtime: <http://comindware.com/logics/time#>.
    @prefix w3math: <http://www.w3.org/2000/10/swap/math#>.
    {
        # Получим текущее время (UTC) для сравнения со сроками
        # в переменную ?nowUTC.
        session:context session:requestTime ?nowUTC.
        # Получим крайние сроки всех задач в переменную ?dueDates
        # Предикат cmw:dueDate возвращает крайний срок задачи 
        ?item cmw:dueDate ?dueDates.
        if {
            # Активная задача с истёкшим сроком — просрочена.
            # Получим активные задачи
            ?item cmw:taskStatus taskStatus:inProgress.
            # Получим задачи, у которых крайний срок
            # предшествует текущей дате.
            ?dueDates w3math:lessThan ?nowUTC.
            # Вычисляем разность между текущим временем и крайним сроком. 
            (?nowUTC ?dueDates) cmwtime:getSpan ?overdueDuration.
        }
        # Возвращаем длительность просрочки
        then {?overdueDuration -> ?value. }
        else {
            # Завершённая задача: просрочена, 
            # если завершена после крайнего срока.
            if {
                # Получаем завершённые задачи.
                ?item cmw:taskStatus taskStatus:completed.
                # Получим задачи, у которых дата завершения
                # cmw:completionDate больше крайнего срока.
                ?item cmw:completionDate ?endDates.
                ?dueDates w3math:lessThan ?endDates.
                # Вычисляем разность
                # между датой завершения временем и крайним сроком.
                (?endDates ?dueDates) cmwtime:getSpan ?overdueDuration.
            }
            # Возвращаем длительность просрочки
            then {?overdueDuration -> ?value. }
            # Возвращаем 0, если задача не просрочена
            else {0 -> ?value. }.
        }.
    }
    ```

3. Создайте атрибут для вычисления статуса просрочки:

   - **Название:** `Просрочена`
   - **Системное имя:** `Просрочена`
   - **Тип данных: текстовый**
   - **Описание:** _Текстовый статус просрочки задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: формула**

    ``` sql
    IF(GREATER("Длительностьпросрочки", 0), "Да", "Нет")
    ```

4. Создайте атрибут для вычисления названия задачи:

   - **Название:** `Название`
   - **Системное имя:** `Название`
   - **Тип данных: текст**
   - **Описание:** _Заголовок задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: N3**

    ``` turtle
    @prefix cmw: <http://comindware.com/logics#>.
    {
        ?item cmw:title ?value.
    }
    ```

5. Создайте атрибут для вычисления исполнителя:

   - **Название:** `Исполнитель`
   - **Системное имя:** `Исполнитель`
   - **Тип данных: аккаунт**
   - **Описание:** _Аккаунт исполнителя задачи_
   - **Хранить несколько значений:** флажок установлен
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: N3**

    ``` turtle
    @prefix cmw: <http://comindware.com/logics#>.
    @prefix assert: <http://comindware.com/logics/assert#>.
    {
        # Собираем список всех исполнителей, назначенных задаче.
        ?item a cmw:UserTask.
        (
            {?item cmw:assignee ?.
            ?item cmw:assignee ?users.}
            {?item cmw:possibleAssignee ?.
            ?item cmw:possibleAssignee ?users}
        )assert:union true.
        ?users -> ?value.
    }
    ```

6. Создайте атрибут для вычисления даты создания:

   - **Название:** `Дата создания`
   - **Системное имя:** `Датасоздания`
   - **Тип данных: дата и время**
   - **Описание:** _Дата создания задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: N3**

    ``` turtle
    @prefix cmw: <http://comindware.com/logics#>.
    {
        ?item cmw:dueDate ?value.
    }
    ```

7. Создайте атрибут для вычисления фактической даты завершения:

   - **Название:** `Дата завершения`
   - **Системное имя:** `Датазавершения`
   - **Тип данных: дата и время**
   - **Описание:** _Фактическая дата завершения задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: N3**

    ``` turtle
    @prefix cmw: <http://comindware.com/logics#>.
    {
        ?item cmw:completionDate ?value.
    }
    ```

### Настройка таблицы _«Статус просрочки задач»_ {: #example_n3_task_list_custom_table .pageBreakBefore }

1. В шаблоне _«Задачи»_ создайте **таблицу** _«Статус просрочки задач»_.
2. В конструкторе таблицы на вкладке «**Основные**» задайте **системный фильтр** на **N3**:

    ``` turtle
    # Импортируем функции для работы с объектами
    @prefix cmw: <http://comindware.com/logics#>.

    # Получаем все пользовательские задачи,
    # у которых задан крайний срок cmw:dueDate
    {
        ?item a cmw:UserTask.
        ?item cmw:dueDate ?.
    }
    ```

    С таким фильтром в таблице будут отображаться задачи всех пользователей у которых задан **крайний срок**, с любым статусом: активные и завершённые.

    !!! warning "Фильтрация задач без крайнего срока"

        Если крайний срок не задан, задачи попадать не будут попадать в таблицу.

3. Добавьте в столбцы таблицы атрибуты:

    - **ID**
    - **Название**
    - **Просрочена**
    - **Длительность просрочки**
    - **Исполнитель**
    - **Дата создания**
    - **Крайний срок**
    - **Дата завершения**

4. Добавьте таблицу _«Статус просрочки задач»_ на требуемую информационную страницу приложения. Например, _[на страницу «Мои задачи»][table_configure_add_to_my_tasks]_.
5. Откройте результирующую таблицу и проверьте её состав.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Пользовательская задача][process_diagram_elements_user_task]
- [Создание таблицы со списком задач][table_configure_tasks_view]
- [Добавление таблицы на страницу «Мои задачи»][table_configure_add_to_my_tasks]
- [Справочник по языку N3][n3_guide_reference]
- [Справочник по формулам][formula_reference]
- [Фильтр списка по активным задачам текущего пользователя: по всем процессам, по конкретному процессу][n3_filter_active_tasks]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
