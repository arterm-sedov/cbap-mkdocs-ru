---
title: 'Список задач всех пользователей со статусом и длительностью просрочки. Настройка на N3'
kbTitle: 'Список задач всех пользователей со статусом и длительностью просрочки. Настройка с помощью N3'
tags:
    - N3
    - Notation 3
    - RDF
    - дата и время
    - длительность
    - задачи
    - вычисление
    - список задач
    - пример
    - просрочка
    - срок выполнения
    - триплеты
    - тройка
    - тройки
hide:
    - tags
kbId: 5154
---

# Список задач всех пользователей со статусом и длительностью просрочки. Настройка на N3 {: #example_n3_task_list_custom }

## Введение {: #example_n3_task_list_custom_intro }

**{{ productName }}** предусмотрена стандартная страница «**Мои задачи**» с заранее заданными столбцами, которая показывает список задач для текущего пользователя.

Чтобы вывести список задач определённых пользователей, с дополнительными бизнес-данными и т.&nbsp;п, можно настроить таблицу с требуемыми вычисляемыми атрибутами и особыми параметрами фильтрации, группировки и сортировки.

Здесь приведён пример вычисления с помощью языка **N3** атрибутов просрочки для задач и настройки списка всех задач для всех пользователей со отображением этих атрибутов.

Если вам требуется отфильтровать список задач, см. также _«[Фильтр списка по активным задачам текущего пользователя: по всем процессам, по конкретному процессу][n3_filter_active_tasks]»_.
.

## Прикладная задача {: #example_n3_task_list_custom_use_case }

Имеется шаблон записей _«Задачи пользователей»_.

Требуется настроить таблицу _«Все задачи»_ со следующими параметрами:

- выводить задачи всех пользователей: как активные, так и завершённые;
- столбцы **Задача**, **Исполнитель**, **Дата создания**, **Плановая дата завершения**, **Дата завершения**;
- столбец _«Просрочена»_ с булевым (логическим) значением:
    - _Да_ — если задача активна и плановая дата завершения уже наступила, либо задача завершена, но дата завершения позже плановой даты завершения;
    - _Нет_ — в остальных случаях.
- столбец _«Длительность просрочки»_ (_0_, если задача не просрочена).

## Пример настройки {: #example_n3_task_list_custom_configure .pageBreakBefore }

Решим задачу следующим образом:

- В шаблоне записей _«Задачи пользователей»_ [создадим атрибуты для контроля просрочки](#example_n3_task_list_custom_attributes):
    - **вычисляемый логический** атрибут _«Статус просрочки»_ с выражением на **N3** для определения признака просрочки;
    - **вычисляемый текстовый** атрибут _«Просрочена»_ с **формулой** для отображения в таблице статуса просрочки в виде _«Да»_ и _«Нет»_;
    - **вычисляемый** атрибут _«Длительность просрочки»_ типа «**дата и время**» с выражением на **N3** для определения длительности просрочки.
    - Статус и длительность просрочки вычислим с помощью **N3** по разности между текущим временем (для активных задач) или фактической датой завершения (для закрытых задач) и плановой датой завершения.

!!! warning "Внимание!"

    Для корректного вычисления выражений указывайте в них те системные имена шаблонов и атрибутов, которые используются в вашем приложении. Они могут отличаться от указанных в примере.

### Настройка атрибутов {: #example_n3_task_list_custom_attributes }

1. В шаблоне записи _«Задачи пользователей»_ создайте атрибут для вычисления признака просрочки:

   - **Название:** `Статус просрочки`
   - **Системное имя:** `СтатусПросрочки`
   - **Тип данных: логический**
   - **Описание:** _Логический признак просрочки задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: N3**

    ``` turtle
    # Импортируем функции для работы с объектами, статусами задач,
    # сеансом (текущим временем) и сравнения величин
    @prefix cmw: <http://comindware.com/logics#>.
    @prefix taskStatus: <http://comindware.com/ontology/taskStatus#>.
    @prefix session: <http://comindware.com/ontology/session#>.
    @prefix w3math: <http://www.w3.org/2000/10/swap/math#>.
    {
        # Текущее время (UTC) для сравнения со сроками.
        session:context session:requestTime ?nowUTC.
        # Активная задача с истёкшим сроком — просрочена.
        if {
            ?item cmw:taskStatus taskStatus:inProgress.
            ?item cmw:dueDate ?dueDates.
            ?dueDates w3math:lessThan ?nowUTC.
        }
        then {True -> ?value }
        else {
            # Завершённая задача: просрочена, если завершена после срока.
            if {
                ?item cmw:taskStatus taskStatus:completed.
                ?item cmw:dueDate ?dueDates.
                ?item cmw:scheduledEndDate ?endDates.
                ?dueDates w3math:lessThan ?endDates.
            }
            then {True -> ?value }
            else {False -> ?value }.
        }.
    }
    ```

2. В шаблоне _«Задачи пользователей»_ создайте атрибут для отображения признака просрочки:

   - **Название:** `Просрочена`
   - **Системное имя:** `Просрочена`
   - **Тип данных: текстовый**
   - **Описание:** _Текстовый статус просрочки задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: формула**

    ``` sql
    IF("СтатусПросрочки", "Да", "Нет")
    ```

3. В шаблоне записи _«Задачи пользователей»_ создайте атрибут для вычисления длительности просрочки:

   - **Название:** `Длительность просрочки`
   - **Системное имя:** `ДлительностьПросрочки`
   - **Тип данных: длительность**
   - **Описание:** _Длительность просрочки задачи_
   - **Вычислять автоматически:** флажок установлен
   - **Вычисляемое значение: N3**

    ``` turtle
    # Импортируем функции для работы с объектами, статусами задач,
    # сеансом, временем и сравнения величин
    @prefix cmw: <http://comindware.com/logics#>.
    @prefix taskStatus: <http://comindware.com/ontology/taskStatus#>.
    @prefix session: <http://comindware.com/ontology/session#>.
    @prefix w3math: <http://www.w3.org/2000/10/swap/math#>.
    @prefix cmwtime: <http://comindware.com/logics/time#>
    {
        # Текущее время (UTC) для сравнения со сроками.
        session:context session:requestTime ?nowUTC.
        # Активная задача с истёкшим сроком — просрочена.
        if {
            ?item cmw:taskStatus taskStatus:inProgress.
            ?item cmw:dueDate ?dueDates.
            ?dueDates w3math:lessThan ?nowUTC.
            (?nowUTC ?dueDates) cmwtime:getSpan ?overdueDuration.
        }
        then {overdueDuration -> ?value }
        
        else {
            # Завершённая задача: просрочена, если завершена после срока.
            if {
                ?item cmw:taskStatus taskStatus:completed.
                ?item cmw:dueDate ?dueDates.
                ?item cmw:scheduledEndDate ?endDates.
                ?dueDates w3math:lessThan ?endDates.
                (?endDates ?dueDates) cmwtime:getSpan ?overdueDuration.
            }
            then {overdueDuration -> ?value }
            else {0 -> ?value }.
        }.
    }
    ```

### Настройка таблицы задач {: #example_n3_task_list_custom_table .pageBreakBefore }

1. В шаблоне _«Задачи пользователей»_ создайте **таблицу** _«Все задачи»_.
2. В конструкторе таблицы на вкладке «**Основные**» следующий **системный фильтр** на **N3**:

    ``` turtle
    # Импортируем функции для работы с объектами
    @prefix cmw: <http://comindware.com/logics#>.

    # Получаем все пользовательские задачи
    {?item a cmw:UserTask.}
    ```

    С таким фильтром в таблице будут отображаться задачи всех пользователей и с любым статусом: активные и завершённые.

3. Добавьте в столбцы таблицы атрибуты:

    - _ID_
    - _Просрочена_
    - _Длительность просрочки_

4. Добавьте таблицу _«Все задачи»_ на требуемую информационную страницу приложения. Например, см. _«[Добавление таблицы на страницу «Мои задачи»][table_configure_add_to_my_tasks]»_.
5. Откройте результирующую таблицу и проверьте её состав.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Создание таблицы со списком задач][table_configure_tasks_view]
- [Добавление таблицы на страницу «Мои задачи»][table_configure_add_to_my_tasks]
- [Справочник по языку N3][n3_guide_reference]
- [Справочник по формулам][formula_guide_reference]
- [Фильтр списка по активным задачам текущего пользователя: по всем процессам, по конкретному процессу][n3_filter_active_tasks]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
