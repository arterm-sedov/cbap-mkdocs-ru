Вывод объединнего списка значений в выпадающий список связанного атрибута записи (поиск по всем записям ШЗ)

## ПОЛУЧЕНИЕ ОБЪЕДИНЁННОГО СПИСКА

``` turtle
@prefix object: <http://comindware.com/ontology/object#>.
@prefix list: <http://www.w3.org/2000/10/swap/list#>.


{
    ("LegalEntities" "ProductCategories") object:findProperty ?ProductCategoriesProperty.

    ("Quotas" "ProductCategorieslevel3") object:findProperty ?ProductCategorieslevel3Property.
    ("Quotas" "ProductCategorieslevel2") object:findProperty ?ProductCategorieslevel2Property.
    ("Quotas" "ProductCategorieslevel1") object:findProperty ?ProductCategorieslevel1Property.

    ("ProductCategories" "CommonCategory") object:findProperty ?CommonCategoryProperty.


    from {
        ?item ?ProductCategorieslevel3Property ?ProductCategorieslevel3. # достаем из текущей записи категорию 3 уровня
        ?ProductCategorieslevel3 ?CommonCategoryProperty ?CommonCategory3. # у данной категории берем общую категорию
        ?LegalEntities3 ?ProductCategoriesProperty ?CommonCategory3. # ищем компании, у которых категория товара равна общей категории найденой выше
    }
    select ?LegalEntities3 -> ?LegalEntities3List. #Помещаем найденные компании в список


    from {
        ?item ?ProductCategorieslevel2Property ?ProductCategorieslevel2.
        ?ProductCategorieslevel2 ?CommonCategoryProperty ?CommonCategory2.
        ?LegalEntities2 ?ProductCategoriesProperty ?CommonCategory2.
    }
    select ?LegalEntities2 -> ?LegalEntities2List. #Помещаем найденные компании по категории 2 уровня 


    (?LegalEntities3List ?LegalEntities2List) list:append ?LegalEntities32List. # Объединяем список компаний по 3 уровню и по 2-му


    from {
        ?item ?ProductCategorieslevel1Property ?ProductCategorieslevel1.
        ?ProductCategorieslevel1 ?CommonCategoryProperty ?CommonCategory1.
        ?LegalEntities1 ?ProductCategoriesProperty ?CommonCategory1.
    }
    select ?LegalEntities1 -> ?LegalEntities1List. #Помещаем найденные компании по категории 1 уровня


    (?LegalEntities32List ?LegalEntities1List) list:append ?LegalEntitiesList. # Объединяем список компаний по 1 уровню и объединенному списку 2-3 уровня


    ?LegalEntitiesList list:member ?value. #Достаем из списка значения
}
```

## ФИЛЬТРАЦИЯ ДЛЯ ФИЛЬТРА В РОЛЯХ

``` turtle 

(?LegalEntities32List ?LegalEntities1List) list:append ?LegalEntitiesList.
?LegalEntitiesList list:member ?LegalEntitiesMembers.
# Достаем из значений объед списка отношения
?LegalEntitiesMembers ?RelationsProperty ?Relations. 
# берем только те, у которых галочка true
?Relations ?ActiveProperty true. 
 # достаем из отношений физ лицо
?Relations ?IndividualProperty ?Individual.

# достаем тек юзера
cmw:securityContext cmw:currentUser ?user.
 #проверяем является ли тек юзер физ лицом в данной компании
?Individual ?AccountProperty ?user.
#выводим для тек. юзера
?user -> ?value.
```