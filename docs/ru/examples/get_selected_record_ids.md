---
title: Атрибут типа «Запись». Получение ID выбранных записей
kbId: 5100
hide: tags
---

# Атрибут типа «Запись». Получение ID выбранных записей {: #example_attribute_record_get_selected_ids }

## Введение {: #example_attribute_record_get_selected_ids_intro }

Здесь представлен пример получения ID записей, выбранных в таблице, и передачи полученных ID в сценарий.

## Прикладная задача {: example_attribute_record_get_selected_ids_use_case .pageBreakBefore }

Имеются шаблоны записей: _«Заказы»_ и _«Товары»_.

Шаблон _«Заказы»_ связан с шаблонами _«Товары»_.

На форме заказа имеются таблицы _«Избранные товары» и _«Отложенные товары»_.

Требуется:

- **На форме заказа:**
    - получить ID _избранных_ и _отложенных товаров_, выбранных в заказе;
    - сохранить полученные ID в атрибут _«Выбранные товары»_ в заказе;
    - сохранить заказ на выбранные товары.
- **В списке всех товаров:**
    - получить ID выбранных товаров;
    - оформить заказ на выбранные товары.

## Настройка приложения {: #example_attribute_record_get_selected_ids_app_configure .pageBreakBefore }

### Настройка сохранения выбранных товаров в форме заказа {: #example_attribute_record_get_selected_ids_order_configure }

1. Создайте шаблоны записей _«Заказы»_ и _«Товары»_.
2. В шаблоне _«Заказы»_ создайте атрибуты _«Избранные товары», _«Отложенные товары»_ и _«Выбранные товары»_ со следующими свойствами:

    - **Тип данных: запись**
    - **Связанный шаблон:** _Товары_
    - **Хранить несколько значений: флажок установлен**

3. Откройте конструктор основной формы шаблона _«Заказы»_.
4. Поместите на форму атрибут _«Выбранные товары»_.
5. Для поля _«Выбранные товары»_ на форме установите **доступ** **«Только чтение»** и **представление «Раскрывающийся список»**.
6. Создайте на форме вкладки  _«Избранное»_ и _«Отложенное»_.
7. Поместите атрибут _«Избранные товары»_ на вкладку  _«Избранное»_, а атрибут _«Отложенные товары»_ — на вкладку _«Отложенное»_.
8. Для полей _«Избранные товары»_ и _«Отложенные товары»_ на форме выберите **представление «Таблица»**.
9. Добавьте на области кнопок таблиц _«Избранные товары»_ и _«Отложенные товары»_ кнопку «**Создать**» <i class="fa-light fa-plus"></i>.
 <!-- и «**Добавить**» <i class="fa-light fa-plus-square"></i>. -->
10. Сохраните форму.
11. Перейдите к правилам для формы.
12. Добавьте **правило** со следующим **действием**:

    - **Элемент формы:** _Выбранные товары_
    - **Действие: установить значение**
    - **Новое значение: N3**

    ``` turtle
    # Импортируем библиотеки для работы с текущим контекстом
    @prefix session: <http://comindware.com/ontology/session#>.
    @prefix context: <http://comindware.com/ontology/session/context#>.
    {
        # Получаем ID всех записей, 
        # выбранных во всех таблицах на форме
        session:context context:selectedIds ?value.
    }
    ```

13. Сохраните правила для формы.

### Настройка заказа выбранных товаров из списка всех товаров {: #example_attribute_record_get_selected_ids_scenario_configure .pageBreakBefore }

1. В шаблоне _«Товары»_ создайте кнопку _«Оформить заказ»_ со следующими свойствами:

    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**
    - **Отображать диалоговое окно:** флажок установлен
    - **Контекст операции: запись**

2. На вкладке «**Локальные переменные**» добавьте переменную:

    - **Отображаемое название:** _Выбранные товары_
    - **Тип данных: запись**
    - **Системное имя:** `ВыбранныеТовары`
    - **Шаблон:** _Товары_

3. Сохраните кнопку.
4. Нажмите кнопку «**Отображать диалоговое окно**».
5. Сохраните кнопку.
6. Поместите в диалоговое окно переменную _«Выбранные товары»_.
7. Установите для поля _«Выбранные товары»_ **доступ** **«Только чтение»** и **представление «Раскрывающийся список»**.
8. Сохраните диалоговое окно.
9. Перейдите к правилам для диалогового окна.
10. Добавьте **правило** со следующим **действием**:

    - **Элемент формы:** _Выбранные товары_
    - **Действие: установить значение**
    - **Новое значение: N3**

    ``` turtle
    # Импортируем библиотеки для работы с текущим контекстом
    @prefix session: <http://comindware.com/ontology/session#>.
    @prefix context: <http://comindware.com/ontology/session/context#>.
    {
        # Получаем ID всех записей, 
        # выбранных во всех таблицах на форме
        session:context context:selectedIds ?value.
    }
    ```

11. Сохраните правила для формы.
12. Вернитесь к свойствам кнопки и сохраните её.
13. Поместите кнопку _«Заказать»_ на **область кнопок для таблицы «Все записи»** шаблона _«Товары»_.
14. В текущем приложении создайте сценарий _«Заказ выбранных товаров»_.
15. Настройте событие «**Нажатие кнопки**»:

    - **Контекстный шаблон:** _Товары_
    - **Кнопка:** _Заказать_

16. Добавьте действие «**Создать запись**» со следующими свойствами:

    - **Целевой шаблон записи**: _Заказы_

17. Добавьте действие «**Изменить значения атрибутов**» со следующими свойствами:

    - **Атрибут:** _Выбранные товары_
    - **Операция со значениями: заменить**
    - **Значение: формула**

    ``` cs
    # Получаем значение локальной переменной кнопки,
    # которая вызвала сценарий
    $$dialogVariables->ВыбранныеТовары
    ```

## Тестирование {: #example_attribute_record_get_selected_ids_testing .pageBreakBefore }

1. Создайте запись в шаблоне _«Заказы»_.
2. На форме заказа создайте несколько записей в таблицах _«Избранные товары»_ и атрибут _«Отложенные товары»_.
3. Сохраните заказ.
4. Выберите некоторые избранные и отложенные товары с помощью флажков в таблице.
5. Сохраните заказ.
6. В поле _«Выбранные товары»_ должны отобразиться ID выбранных товаров.
7. Откройте таблицу «**Все записи**» шаблона _«Товары»_.
8. Выберите несколько товаров с помощью флажков в таблице.
9. Нажмите кнопку _«Заказать»_.
10. Должно отобразиться диалоговое окно со списком ID _выбранных товаров_.
11. Нажмите кнопку _«Заказать»_.
12. В таблице «**Все записи**» шаблона _«Заказы»_ должен появиться новый заказ.
13. Откройте новый заказ и удостоверьтесь, что в нем правильно указаны ID _выбранных товаров_.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Атрибут типа «Запись»][attribute_record]
- [Формы][forms]
- [Правила для формы][form_rules]
- [Кнопки][buttons]
- [Сценарии][scenarios]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
