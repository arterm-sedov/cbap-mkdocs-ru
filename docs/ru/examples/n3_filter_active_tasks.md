---
title: 'Фильтр списка по активным задачам'
kbTitle: 'Фильтрация списка по активным задачам текущего пользователя с помощью N3: по всем процессам, по конкретному процессу'
tags:
    - процессы
    - задачи
    - N3
    - тройки
    - тройка
    - фильтры
    - таблицы
    - вычисление
    - аккаунты
    - список задач
    - мои задачи
    - таблицы
hide:
    - tags
kbId: 4935
---

# Фильтрация списка по активным задачам с помощью N3 {: #n3_filter_active_tasks }

## Введение {: #n3_filter_active_tasks_intro }

В **{{ productName }}** можно настроить фильтрацию списка задач, чтобы отображать только активные задачи текущего пользователя. Это может быть полезно для создания персональных представлений задач или для мониторинга текущих задач пользователя. Например, можно создать список задач с особыми столбцами на странице «**Мои задачи**» в дополнение к системным спискам задач, которые нельзя настроить.

Здесь представлены примеры настройки системного фильтра для таблицы со списком задач текущего пользователя по всем процессам и по определённому процессу.

См. также _«[Создание таблицы со списком задач][table_configure_tasks_view]»_.

## Прикладная задача {: #n3_filter_active_tasks_use_case .pageBreakBefore }

Имеется два бизнес-процесса: _«Оформление заявок»_ и _«Ведение проектов»_.

В обоих процессах имеются пользовательские задачи, назначенные разным исполнителям.

Требуется добавить на страницу «**Мои задачи**» две таблицы для отображения:

- [всех активных задач](#n3_filter_active_tasks_all) текущего пользователя по всем процессам;
- активных задач текущего пользователя [в рамках конкретного процесса](#n3_filter_active_tasks_process).

В таблицах должны быть столбцы с данными заявок и проектов, связанных с задачами, а также не требуется отображать стандартный столбец _«Исполнитель»_, так как он всегда указывает текущего пользователя. Этого нельзя достичь с помощью системных списков активных и завершённых задач.

## Настройка таблиц {: #n3_filter_active_tasks_configure .pageBreakBefore }

### Таблица со списком всех активных задач пользователя {: #n3_filter_active_tasks_all }

1. В любом из шаблонов процессов создайте **таблицу задач** _«Задачи по всем процессам»_.
2. Добавьте в таблицу необходимые столбцы.
3. В свойствах таблицы установите следующий **системный фильтр** на языке **N3**:

    ``` turtle
    # Импортируем функции для работы
    # с логикой, статусами задач, аккаунтами и ролями
    @prefix cmw: <http://comindware.com/logics#>.
    @prefix taskStatus: <http://comindware.com/ontology/taskStatus#>.
    @prefix account: <http://comindware.com/ontology/account#>
    @prefix role: <http://comindware.com/ontology/role#>.
    {
        # Получаем аккаунт текущего пользователя из контекста безопасности.
        cmw:securityContext cmw:currentUser ?currentUser.
        # Помещаем массив всех задач в переменную ?item
        # Если выражение используется в таблице задач процесса, 
        # то эта строка не требуется, т. к. контекст уже будет задачами.
        ?item a cmw:UserTask.
        # Начинаем цикл по массиву задач.
        # Получаем активные задачи.
        ?item cmw:taskStatus taskStatus:inProgress.
        # Получаем роли текущего пользователя.
        ?roles role:roleMembers ?currentUser.
        # Получаем группы, в которые входит пользователь.
        ?currentUser account:userGroupMembership ?groups.
        # Получаем роли, в которые входят группы пользователя.
        ?roleGroups role:roleMembers ?groups.
        # Проверяем, является ли текущий пользователь
        # фактическим или возможным исполнителем задачи.
        # Проверяем различные варианты назначения задачи.
        or {
            # Проверяем, назначена ли задача на текущего пользователя.
            ?item cmw:assignee ?currentUser.
        }
        or {
            # Проверяем, является ли пользователь возможным исполнителем.
            ?item cmw:possibleAssignee ?currentUser.
        }
        or {
            # Проверяем, назначена ли задача на роль пользователя.
            ?item cmw:assignee ?roles.
        }
        or {
            # Проверяем, является ли роль возможным исполнителем.
            ?item cmw:possibleAssignee ?roles.
        }
        or {
            # Проверяем, назначена ли задача на группу пользователя.
            ?item cmw:assignee ?roleGroups.
        }
        or {
            # Проверяем, является ли группа возможным исполнителем.
            ?item cmw:possibleAssignee ?roleGroups.
        }.
    }
    ```

4. Добавьте таблицу _«Задачи по всем процессам»_ на страницу «**Мои задачи**». См. _«[Создание таблицы со списком задач][table_configure_tasks_view]»_.

### Фильтр по задачам конкретного процесса {: #n3_filter_active_tasks_process .pageBreakBefore }

Чтобы получить в таблице список всех активных задач, где текущий пользователь является исполнителем (а также возможным исполнителем, если задача назначена на нескольких пользователей) по конкретному процессу, используйте следующее выражение в [**системном фильтре таблицы**][table_configure_template]:

1. В шаблоне процесса _«Ведение проектов»_ создайте **таблицу задач** _«Задачи по проектам»_.
2. Добавьте в таблицу необходимые столбцы.
3. В свойствах таблицы установите следующий **системный фильтр** на языке **N3**:

    ``` turtle
    # Импортируем функции для работы с логикой, задачами,
    # статусами задач, объектами, аккаунтами и ролями
    @prefix cmw: <http://comindware.com/logics#>.
    @prefix taskStatus: <http://comindware.com/ontology/taskStatus#>.
    @prefix object: <http://comindware.com/ontology/object#>.
    @prefix account: <http://comindware.com/ontology/account#>
    @prefix role: <http://comindware.com/ontology/role#>.
    {
        # Получаем шаблон процесса по его системному имени
        ?process object:alias "СистемноеИмяШаблонаПроцесса".
        # Получаем аккаунт текущего пользователя из контекста безопасности.
        cmw:securityContext cmw:currentUser ?currentUser.
        # Помещаем массив всех задач в переменную ?item
        # Если выражение используется в таблице задач процесса, 
        # то эта строка не требуется, т. к. контекст уже будет задачей.
        ?item a cmw:UserTask.
        # Начинаем цикл по массиву задач
        # Фильтруем задачи по конкретному процессу.
        ?item cmw:container ?process.
        # Получаем активные задачи.
        ?item cmw:taskStatus taskStatus:inProgress.
        # Получаем роли текущего пользователя.
        ?roles role:roleMembers ?currentUser.
        # Получаем группы, в которые входит пользователь.
        ?currentUser account:userGroupMembership ?groups.
        # Получаем роли, в которые входят группы пользователя.
        ?roleGroups role:roleMembers ?groups.
        # Проверяем, является ли текущий пользователь
        # фактическим или возможным исполнителем задачи.
        # Проверяем различные варианты назначения задачи.
        or {
            # Проверяем, назначена ли задача на текущего пользователя.
            ?item cmw:assignee ?currentUser.
        }
        or {
            # Проверяем, является ли пользователь возможным исполнителем.
            ?item cmw:possibleAssignee ?currentUser.
        }
        or {
            # Проверяем, назначена ли задача на роль пользователя.
            ?item cmw:assignee ?roles.
        }
        or {
            # Проверяем, является ли роль возможным исполнителем.
            ?item cmw:possibleAssignee ?roles.
        }
        or {
            # Проверяем, назначена ли задача на группу пользователя.
            ?item cmw:assignee ?roleGroups.
        }
        or {
            # Проверяем, является ли группа возможным исполнителем.
            ?item cmw:possibleAssignee ?roleGroups.
        }.
    }
    ```

4. Добавьте таблицу _«Задачи по проектам»_ на страницу «**Мои задачи**».

## Тестирование {: #n3_filter_active_tasks_test }

1. Запустите процессы _«Оформление заявок»_ и _«Ведение проектов»_.
2. Откройте страницу «**Мои задачи**».
3. Рядом со вкладками _«Активные»_ и _«Завершённые»_ должны отображаться вкладки _«Задачи по всем процессам»_ и _«Задачи по проектам»_.
4. Проверьте, что в таблицах отображаются соответствующие задачи.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Таблицы. Определения, настройка, клонирование, удаление][table_configure]
- [Создание таблицы со списком задач][table_configure_tasks_view]
- [Вычисление пользователей с активными задачами][n3_calculate_active_task_accounts]
- [Вычисление исполнителя активной задачи][n3_calculate_active_task_assignee]
- [Периодические напоминания об открытых задачах][n3_periodic_task_notifications]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
